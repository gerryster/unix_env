<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script type="text/javascript">
//<![CDATA[
var version = {major: 2, minor: 1, revision: 3, date: new Date("Nov 3, 2006"), extensions: {}};
//]]>
</script>
<!--
TiddlyWiki 2.1.3 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Osmosoft Limited 2004-2006

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>
<!--}}}-->
<!--PRE-HEAD-END-->
<title> Ryan's Wiki - my notebook for all things computer and internetAbout This Wiki </title>
<script type="text/javascript">
//<![CDATA[
// ---------------------------------------------------------------------------------
// Configuration repository
// ---------------------------------------------------------------------------------

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animFast: 0.12, // Speed for animations (lower == slower)
	animSlow: 0.01, // Speed for EasterEgg animations
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	displayStartupTime: false // Whether to display startup time
	};

// Messages
config.messages = {
	messageClose: {},
	dates: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	txtBackupFolder: "",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30"
	};
	
// List of notification functions to be called when certain tiddlers are changed or deleted
config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
	];

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
	};

// More messages (rather a legacy layout that shouldn't really be like this)
config.views = {
	wikified: {
		tag: {}
		},
	editor: {
		tagChooser: {}
		}
	};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {}
		},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	newTiddler: {},
	newJournal: {},
	sparkline: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {},
	edit: {},
	tagChooser: {},
	toolbar: {},
	br: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {}
	};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {},
	jump: {}
	};

// Browser detection... In a very few places, there's nothing else for it but to
// know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /Gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
	};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
	};
if(config.browser.isBadSafari)
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
		}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.urlPattern = "[a-z]{3,8}:[^\\s:'\"][^\\s'\"]*(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
												config.textPrimitives.lowerLetter + "+" +
												config.textPrimitives.upperLetter +
												config.textPrimitives.anyLetter + "*)|(?:" +
												config.textPrimitives.upperLetter + "{2,}" +
												config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" + 
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

// ---------------------------------------------------------------------------------
// Shadow tiddlers
// ---------------------------------------------------------------------------------

config.shadowTiddlers = {
	ColorPalette: "Background: #fff\n" + 
				  "Foreground: #000\n" +
				  "PrimaryPale: #8cf\n" +
				  "PrimaryLight: #18f\n" +
				  "PrimaryMid: #04b\n" +
				  "PrimaryDark: #014\n" +
				  "SecondaryPale: #ffc\n" +
				  "SecondaryLight: #fe8\n" +
				  "SecondaryMid: #db4\n" +
				  "SecondaryDark: #841\n" +
				  "TertiaryPale: #eee\n" +
				  "TertiaryLight: #ccc\n" +
				  "TertiaryMid: #999\n" +
				  "TertiaryDark: #666\n" +
				  "Error: #f88\n",
	StyleSheet: "",
	StyleSheetColors: "/*{{{*/\nbody {\n	background: [[ColorPalette::Background]];\n	color: [[ColorPalette::Foreground]];\n}\n\na{\n	color: [[ColorPalette::PrimaryMid]];\n}\n\na:hover{\n	background: [[ColorPalette::PrimaryMid]];\n	color: [[ColorPalette::Background]];\n}\n\na img{\n	border: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	color: [[ColorPalette::SecondaryDark]];\n	background: [[ColorPalette::PrimaryPale]];\n}\n\n.button {\n	color: [[ColorPalette::PrimaryDark]];\n	border: 1px solid [[ColorPalette::Background]];\n}\n\n.button:hover {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::SecondaryLight]];\n	border-color: [[ColorPalette::SecondaryMid]];\n}\n\n.button:active {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::SecondaryMid]];\n	border: 1px solid [[ColorPalette::SecondaryDark]];\n}\n\n.header {\n	background: [[ColorPalette::PrimaryMid]];\n}\n\n.headerShadow {\n	color: [[ColorPalette::Foreground]];\n}\n\n.headerShadow a {\n	font-weight: normal;\n	color: [[ColorPalette::Foreground]];\n}\n\n.headerForeground {\n	color: [[ColorPalette::Background]];\n}\n\n.headerForeground a {\n	font-weight: normal;\n	color: [[ColorPalette::PrimaryPale]];\n}\n\n.tabSelected{\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::TertiaryPale]];\n	border-left: 1px solid [[ColorPalette::TertiaryLight]];\n	border-top: 1px solid [[ColorPalette::TertiaryLight]];\n	border-right: 1px solid [[ColorPalette::TertiaryLight]];\n}\n\n.tabUnselected {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::TertiaryMid]];\n}\n\n.tabContents {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::TertiaryPale]];\n	border: 1px solid [[ColorPalette::TertiaryLight]];\n}\n\n.tabContents .button {\n	 border: 0;}\n\n#sidebar {\n}\n\n#sidebarOptions input {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel {\n	background: [[ColorPalette::PrimaryPale]];\n}\n\n#sidebarOptions .sliderPanel a {\n	border: none;\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel a:hover {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel a:active {\n	color: [[ColorPalette::PrimaryMid]];\n	background: [[ColorPalette::Background]];\n}\n\n.wizard {\n	background: [[ColorPalette::SecondaryLight]];\n	border-top: 1px solid [[ColorPalette::SecondaryMid]];\n	border-left: 1px solid [[ColorPalette::SecondaryMid]];\n}\n\n.wizard h1 {\n	color: [[ColorPalette::SecondaryDark]];\n}\n\n.wizard h2 {\n	color: [[ColorPalette::Foreground]];\n}\n\n.wizardStep {\n	background: [[ColorPalette::Background]];\n	border-top: 1px solid [[ColorPalette::SecondaryMid]];\n	border-bottom: 1px solid [[ColorPalette::SecondaryMid]];\n	border-left: 1px solid [[ColorPalette::SecondaryMid]];\n}\n\n.wizard .button {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n	border-top: 1px solid [[ColorPalette::PrimaryLight]];\n	border-right: 1px solid [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n	border-left: 1px solid [[ColorPalette::PrimaryLight]];\n}\n\n.wizard .button:hover {\n	color: [[ColorPalette::PrimaryLight]];\n	background: [[ColorPalette::PrimaryDark]];\n	border-color: [[ColorPalette::PrimaryLight]];\n}\n\n.wizard .button:active {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n	border-top: 1px solid [[ColorPalette::PrimaryLight]];\n	border-right: 1px solid [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n	border-left: 1px solid [[ColorPalette::PrimaryLight]];\n}\n\n#messageArea {\n	border: 1px solid [[ColorPalette::SecondaryDark]];\n	background: [[ColorPalette::SecondaryMid]];\n	color: [[ColorPalette::PrimaryDark]];\n}\n\n#messageArea .button {\n	padding: 0.2em 0.2em 0.2em 0.2em;\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::Background]];\n}\n\n.popup {\n	background: [[ColorPalette::PrimaryLight]];\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n.popup hr {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px;\n}\n\n.listBreak div{\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n}\n\n.popup li.disabled {\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n.popup li a, .popup li a:visited {\n	color: [[ColorPalette::TertiaryPale]];\n	border: none;\n}\n\n.popup li a:hover {\n	background: [[ColorPalette::PrimaryDark]];\n	color: [[ColorPalette::Background]];\n	border: none;\n}\n\n.tiddler .defaultCommand {\n font-weight: bold;\n}\n\n.shadow .title {\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.title {\n	color: [[ColorPalette::SecondaryDark]];\n}\n\n.subtitle {\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.toolbar {\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n.tagging, .tagged {\n	border: 1px solid [[ColorPalette::TertiaryPale]];\n	background-color: [[ColorPalette::TertiaryPale]];\n}\n\n.selected .tagging, .selected .tagged {\n	background-color: [[ColorPalette::TertiaryLight]];\n	border: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n.tagging .listTitle, .tagged .listTitle {\n	color: [[ColorPalette::PrimaryDark]];\n}\n\n.tagging .button, .tagged .button {\n		border: none;\n}\n\n.footer {\n	color: [[ColorPalette::TertiaryLight]];\n}\n\n.selected .footer {\n	color: [[ColorPalette::TertiaryMid]];\n}\n\n.sparkline {\n	background: [[ColorPalette::PrimaryPale]];\n	border: 0;\n}\n\n.sparktick {\n	background: [[ColorPalette::PrimaryDark]];\n}\n\n.error, .errorButton {\n	color: [[ColorPalette::Foreground]];\n	background: [[ColorPalette::Error]];\n}\n\n.warning {\n	color: [[ColorPalette::Foreground]];\n	background: [[ColorPalette::SecondaryPale]];\n}\n\n.cascade {\n	background: [[ColorPalette::TertiaryPale]];\n	color: [[ColorPalette::TertiaryMid]];\n	border: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n.imageLink, #displayArea .imageLink {\n	background: transparent;\n}\n\n.viewer .listTitle {list-style-type: none; margin-left: -2em;}\n\n.viewer .button {\n	border: 1px solid [[ColorPalette::SecondaryMid]];\n}\n\n.viewer blockquote {\n	border-left: 3px solid [[ColorPalette::TertiaryDark]];\n}\n\n.viewer table {\n	border: 2px solid [[ColorPalette::TertiaryDark]];\n}\n\n.viewer th, thead td {\n	background: [[ColorPalette::SecondaryMid]];\n	border: 1px solid [[ColorPalette::TertiaryDark]];\n	color: [[ColorPalette::Background]];\n}\n\n.viewer td, .viewer tr {\n	border: 1px solid [[ColorPalette::TertiaryDark]];\n}\n\n.viewer pre {\n	border: 1px solid [[ColorPalette::SecondaryLight]];\n	background: [[ColorPalette::SecondaryPale]];\n}\n\n.viewer code {\n	color: [[ColorPalette::SecondaryDark]];\n}\n\n.viewer hr {\n	border: 0;\n	border-top: dashed 1px [[ColorPalette::TertiaryDark]];\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.highlight, .marked {\n	background: [[ColorPalette::SecondaryLight]];\n}\n\n.editor input {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n.editor textarea {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n	width: 100%;\n}\n\n.editorFooter {\n	color: [[ColorPalette::TertiaryMid]];\n}\n\n/*}}}*/",
	StyleSheetLayout: "/*{{{*/\n* html .tiddler {\n    height: 1%;\n}\n\nbody {\n	font-size: .75em;\n	font-family: arial,helvetica;\n	margin: 0;\n	padding: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	font-weight: bold;\n	text-decoration: none;\n	padding-left: 0.4em;\n}\n\nh1 {font-size: 1.35em;}\nh2 {font-size: 1.25em;}\nh3 {font-size: 1.1em;}\nh4 {font-size: 1em;}\nh5 {font-size: .9em;}\n\nhr {\n	height: 1px;\n}\n\na{\n	text-decoration: none;\n}\n\ndt {font-weight: bold;}\n\nol { list-style-type: decimal }\nol ol { list-style-type: lower-alpha }\nol ol ol { list-style-type: lower-roman }\nol ol ol ol { list-style-type: decimal }\nol ol ol ol ol { list-style-type: lower-alpha }\nol ol ol ol ol ol { list-style-type: lower-roman }\nol ol ol ol ol ol ol { list-style-type: decimal }\n\n.txtOptionInput {\n	width: 11em;\n}\n\n#contentWrapper .chkOptionInput {\n	border: 0;\n}\n\n.externalLink {\n	text-decoration: underline;\n}\n\n.indent {margin-left:3em;}\n.outdent {margin-left:3em; text-indent:-3em;}\ncode.escaped {white-space:nowrap;}\n\n.tiddlyLinkExisting {\n	font-weight: bold;\n}\n\n.tiddlyLinkNonExisting {\n	font-style: italic;\n}\n\n/* the 'a' is required for IE, otherwise it renders the whole tiddler a bold */\na.tiddlyLinkNonExisting.shadow {\n	font-weight: bold;\n}\n\n#mainMenu .tiddlyLinkExisting, \n#mainMenu .tiddlyLinkNonExisting,\n#sidebarTabs .tiddlyLinkNonExisting{\n font-weight: normal;\n font-style: normal;\n}\n\n#sidebarTabs .tiddlyLinkExisting {\n font-weight: bold;\n font-style: normal;\n}\n\n.header {\n		position: relative;\n}\n\n.header a:hover {\n	background: transparent;\n}\n\n.headerShadow {\n	position: relative;\n	padding: 4.5em 0em 1em 1em;\n	left: -1px;\n	top: -1px;\n}\n\n.headerForeground {\n	position: absolute;\n	padding: 4.5em 0em 1em 1em;\n	left: 0px;\n	top: 0px;\n}\n\n.siteTitle {\n	font-size: 3em;\n}\n\n.siteSubtitle {\n	font-size: 1.2em;\n}\n\n#mainMenu {\n	position: absolute;\n	left: 0;\n	width: 10em;\n	text-align: right;\n	line-height: 1.6em;\n	padding: 1.5em 0.5em 0.5em 0.5em;\n	font-size: 1.1em;\n}\n\n#sidebar {\n	position: absolute;\n	right: 3px;\n	width: 16em;\n	font-size: .9em;\n}\n\n#sidebarOptions {\n	padding-top: 0.3em;\n}\n\n#sidebarOptions a {\n	margin: 0em 0.2em;\n	padding: 0.2em 0.3em;\n	display: block;\n}\n\n#sidebarOptions input {\n	margin: 0.4em 0.5em;\n}\n\n#sidebarOptions .sliderPanel {\n	margin-left: 1em;\n	padding: 0.5em;\n	font-size: .85em;\n}\n\n#sidebarOptions .sliderPanel a {\n	font-weight: bold;\n	display: inline;\n	padding: 0;\n}\n\n#sidebarOptions .sliderPanel input {\n	margin: 0 0 .3em 0;\n}\n\n#sidebarTabs .tabContents {\n	width: 15em;\n	overflow: hidden;\n}\n\n.wizard {\n	padding: 0.1em 0em 0em 2em;\n}\n\n.wizard h1 {\n	font-size: 2em;\n	font-weight: bold;\n	background: none;\n	padding: 0em 0em 0em 0em;\n	margin: 0.4em 0em 0.2em 0em;\n}\n\n.wizard h2 {\n	font-size: 1.2em;\n	font-weight: bold;\n	background: none;\n	padding: 0em 0em 0em 0em;\n	margin: 0.2em 0em 0.2em 0em;\n}\n\n.wizardStep {\n	padding: 1em 1em 1em 1em;\n}\n\n.wizard .button {\n	margin: 0.5em 0em 0em 0em;\n	font-size: 1.2em;\n}\n\n#messageArea {\nposition:absolute; top:0; right:0; margin: 0.5em; padding: 0.5em;\n}\n\n*[id='messageArea'] {\nposition:fixed !important; z-index:99;}\n\n.messageToolbar {\ndisplay: block;\ntext-align: right;\n}\n\n#messageArea a{\n	text-decoration: underline;\n}\n\n.popup {\n	font-size: .9em;\n	padding: 0.2em;\n	list-style: none;\n	margin: 0;\n}\n\n.popup hr {\n	display: block;\n	height: 1px;\n	width: auto;\n	padding: 0;\n	margin: 0.2em 0em;\n}\n\n.listBreak {\n	font-size: 1px;\n	line-height: 1px;\n}\n\n.listBreak div {\n	margin: 2px 0;\n}\n\n.popup li.disabled {\n	padding: 0.2em;\n}\n\n.popup li a{\n	display: block;\n	padding: 0.2em;\n}\n\n.tabset {\n	padding: 1em 0em 0em 0.5em;\n}\n\n.tab {\n	margin: 0em 0em 0em 0.25em;\n	padding: 2px;\n}\n\n.tabContents {\n	padding: 0.5em;\n}\n\n.tabContents ul, .tabContents ol {\n	margin: 0;\n	padding: 0;\n}\n\n.txtMainTab .tabContents li {\n	list-style: none;\n}\n\n.tabContents li.listLink {\n	 margin-left: .75em;\n}\n\n#displayArea {\n	margin: 1em 17em 0em 14em;\n}\n\n\n.toolbar {\n	text-align: right;\n	font-size: .9em;\n	visibility: hidden;\n}\n\n.selected .toolbar {\n	visibility: visible;\n}\n\n.tiddler {\n	padding: 1em 1em 0em 1em;\n}\n\n.missing .viewer,.missing .title {\n	font-style: italic;\n}\n\n.title {\n	font-size: 1.6em;\n	font-weight: bold;\n}\n\n.missing .subtitle {\n display: none;\n}\n\n.subtitle {\n	font-size: 1.1em;\n}\n\n.tiddler .button {\n	padding: 0.2em 0.4em;\n}\n\n.tagging {\nmargin: 0.5em 0.5em 0.5em 0;\nfloat: left;\ndisplay: none;\n}\n\n.isTag .tagging {\ndisplay: block;\n}\n\n.tagged {\nmargin: 0.5em;\nfloat: right;\n}\n\n.tagging, .tagged {\nfont-size: 0.9em;\npadding: 0.25em;\n}\n\n.tagging ul, .tagged ul {\nlist-style: none;margin: 0.25em;\npadding: 0;\n}\n\n.tagClear {\nclear: both;\n}\n\n.footer {\n	font-size: .9em;\n}\n\n.footer li {\ndisplay: inline;\n}\n\n* html .viewer pre {\n	width: 99%;\n	padding: 0 0 1em 0;\n}\n\n.viewer {\n	line-height: 1.4em;\n	padding-top: 0.5em;\n}\n\n.viewer .button {\n	margin: 0em 0.25em;\n	padding: 0em 0.25em;\n}\n\n.viewer blockquote {\n	line-height: 1.5em;\n	padding-left: 0.8em;\n	margin-left: 2.5em;\n}\n\n.viewer ul, .viewer ol{\n	margin-left: 0.5em;\n	padding-left: 1.5em;\n}\n\n.viewer table {\n	border-collapse: collapse;\n	margin: 0.8em 1.0em;\n}\n\n.viewer th, .viewer td, .viewer tr,.viewer caption{\n	padding: 3px;\n}\n\n.viewer table.listView {\n	font-size: 0.85em;\n	margin: 0.8em 1.0em;\n}\n\n.viewer table.listView th, .viewer table.listView td, .viewer table.listView tr {\n	padding: 0px 3px 0px 3px;\n}\n\n.viewer pre {\n	padding: 0.5em;\n	margin-left: 0.5em;\n	font-size: 1.2em;\n	line-height: 1.4em;\n	overflow: auto;\n}\n\n.viewer code {\n	font-size: 1.2em;\n	line-height: 1.4em;\n}\n\n.editor {\nfont-size: 1.1em;\n}\n\n.editor input, .editor textarea {\n	display: block;\n	width: 100%;\n	font: inherit;\n}\n\n.editorFooter {\n	padding: 0.25em 0em;\n	font-size: .9em;\n}\n\n.editorFooter .button {\npadding-top: 0px; padding-bottom: 0px;}\n\n.fieldsetFix {border: 0;\npadding: 0;\nmargin: 1px 0px 1px 0px;\n}\n\n.sparkline {\n	line-height: 1em;\n}\n\n.sparktick {\n	outline: 0;\n}\n\n.zoomer {\n	font-size: 1.1em;\n	position: absolute;\n	padding: 1em;\n}\n\n.cascade {\n	font-size: 1.1em;\n	position: absolute;\n	overflow: hidden;\n}\n/*}}}*/",
	StyleSheetPrint: "/*{{{*/\n@media print {\n#mainMenu, #sidebar, #messageArea, .toolbar {display: none ! important;}\n#displayArea {margin: 1em 1em 0em 1em;}\n/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */\nnoscript {display:none;}\n}\n/*}}}*/",
	PageTemplate: "<!--{{{-->\n<div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'>\n<div class='headerShadow'>\n<span class='siteTitle' refresh='content' tiddler='SiteTitle'></span>&nbsp;\n<span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'></span>\n</div>\n<div class='headerForeground'>\n<span class='siteTitle' refresh='content' tiddler='SiteTitle'></span>&nbsp;\n<span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'></span>\n</div>\n</div>\n<div id='mainMenu' refresh='content' tiddler='MainMenu'></div>\n<div id='sidebar'>\n<div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'></div>\n<div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'></div>\n</div>\n<div id='displayArea'>\n<div id='messageArea'></div>\n<div id='tiddlerDisplay'></div>\n</div>\n<!--}}}-->",
	ViewTemplate: "<!--{{{-->\n<div class='toolbar' macro='toolbar closeTiddler closeOthers +editTiddler permalink references jump'></div>\n<div class='title' macro='view title'></div>\n<div class='subtitle'><span macro='view modifier link'></span>, <span macro='view modified date [[DD MMM YYYY]]'></span> (<span macro='message views.wikified.createdPrompt'></span> <span macro='view created date [[DD MMM YYYY]]'></span>)</div>\n<div class='tagging' macro='tagging'></div>\n<div class='tagged' macro='tags'></div>\n<div class='viewer' macro='view text wikified'></div>\n<div class='tagClear'></div>\n<!--}}}-->",
	EditTemplate: "<!--{{{-->\n<div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler deleteTiddler'></div>\n<div class='title' macro='view title'></div>\n<div class='editor' macro='edit title'></div>\n<div class='editor' macro='edit text'></div>\n<div class='editor' macro='edit tags'></div><div class='editorFooter'><span macro='message views.editor.tagPrompt'></span><span macro='tagChooser'></span></div>\n<!--}}}-->",
	MarkupPreHead: "<!--{{{-->\n<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>\n<!--}}}-->",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: ""
	};

// ---------------------------------------------------------------------------------
// Translateable strings
// ---------------------------------------------------------------------------------

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. This could be because your browser doesn't support saving (instead, use FireFox if you can), or because the pathname to your TiddlyWiki file contains illegal characters",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.plugins,{
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these tiddlers:\n\n%0",
	listViewTemplate : {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Title', field: 'title', tiddlerLink: 'title', title: "Title", type: 'TiddlerLink'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			],
		actions: [
			{caption: "More actions...", name: ''},
			{caption: "Remove systemConfig tag", name: 'remove'},
			{caption: "Delete these tiddlers forever", name: 'delete'}
			]}
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import tiddlers into a read-only TiddlyWiki. Try opening the TiddlyWiki file from a file:// URL",
	defaultPath: "http://www.tiddlywiki.com/index.html",
	fetchLabel: "fetch",
	fetchPrompt: "Fetch the tiddlywiki file",
	fetchError: "There were problems fetching the tiddlywiki file",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	wizardTitle: "Import tiddlers from another TiddlyWiki file",
	step1: "Step 1: Locate the TiddlyWiki file",
	step1prompt: "Enter the URL or pathname here: ",
	step1promptFile: "...or browse for a file: ",
	step1promptFeeds: "...or select a pre-defined feed: ",
	step1feedPrompt: "Choose...",
	step2: "Step 2: Loading TiddlyWiki file",
	step2Text: "Please wait while the file is loaded from: %0",
	step3: "Step 3: Choose the tiddlers to import",
	step4: "%0 tiddler(s) imported",
	step5: "Done",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Title', field: 'title', title: "Title", type: 'String'},
			{name: 'Snippet', field: 'text', title: "Snippet", type: 'String'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			],
		actions: [
			{caption: "More actions...", name: ''},
			{caption: "Import these tiddlers", name: 'import'}
			]}
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "GettingStarted",
	MainMenu: "GettingStarted",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	GettingStarted: "To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:\n* SiteTitle & SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\n* MainMenu: The menu (usually on the left)\n* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\nYou'll also need to enter your username for signing your edits: <<option txtUserName>>",
	SideBarOptions: "<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal 'DD MMM YYYY'>><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel 'options »' 'Change TiddlyWiki advanced options'>>",
	OptionsPanel: "These InterfaceOptions for customising TiddlyWiki are saved in your browser\n\nYour username for signing your edits. Write it as a WikiWord (eg JoeBloggs)\n\n<<option txtUserName>>\n<<option chkSaveBackups>> SaveBackups\n<<option chkAutoSave>> AutoSave\n<<option chkRegExpSearch>> RegExpSearch\n<<option chkCaseSensitiveSearch>> CaseSensitiveSearch\n<<option chkAnimate>> EnableAnimations\n\n----\nAdvancedOptions\nPluginManager\nImportTiddlers",
	AdvancedOptions: "<<option chkGenerateAnRssFeed>> GenerateAnRssFeed\n<<option chkOpenInNewWindow>> OpenLinksInNewWindow\n<<option chkSaveEmptyTemplate>> SaveEmptyTemplate\n<<option chkToggleLinks>> Clicking on links to tiddlers that are already open causes them to close\n^^(override with Control or other modifier key)^^\n<<option chkHttpReadOnly>> HideEditingFeatures when viewed over HTTP\n<<option chkForceMinorUpdate>> Treat edits as MinorChanges by preserving date and time\n^^(override with Shift key when clicking 'done' or by pressing Ctrl-Shift-Enter^^\n<<option chkConfirmDelete>> ConfirmBeforeDeleting\nMaximum number of lines in a tiddler edit box: <<option txtMaxEditRows>>\nFolder name for backup files: <<option txtBackupFolder>>\n<<option chkInsertTabs>> Use tab key to insert tab characters instead of jumping to next field",
	SideBarTabs: "<<tabs txtMainTab Timeline Timeline TabTimeline All 'All tiddlers' TabAll Tags 'All tags' TabTags More 'More lists' TabMore>>",
	TabTimeline: "<<timeline>>",
	TabAll: "<<list all>>",
	TabTags: "<<allTags>>",
	TabMore: "<<tabs txtMoreTab Missing 'Missing tiddlers' TabMoreMissing Orphans 'Orphaned tiddlers' TabMoreOrphans Shadowed 'Shadowed tiddlers' TabMoreShadowed>>",
	TabMoreMissing: "<<list missing>>",
	TabMoreOrphans: "<<list orphans>>",
	TabMoreShadowed: "<<list shadowed>>",
	PluginManager: "<<plugins>>",
	ImportTiddlers: "<<importTiddlers>>"});

// ---------------------------------------------------------------------------------
// Main
// ---------------------------------------------------------------------------------

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
config.parsers = {}; // Hashmap of alternative parsers for the wikifier
var anim = new Animator(); // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = config.browser.isSafari || config.browser.isOpera;

// Starting up
function main()
{
	var now, then = new Date();
	startingUp = true;
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	store.loadFromDiv("storeArea","store",true);
	invokeParamifier(params,"onload");
	var pluginProblem = loadPlugins();
	formatter = new Formatter(config.formatters);
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	invokeParamifier(params,"onconfig");
	store.notifyAll();
	restart();
	if(pluginProblem)
		{
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
		}
	now = new Date();
	if(config.displayStartupTime)
		displayMessage("TiddlyWiki startup in " + (now-then)/1000 + " seconds");
	startingUp = false;
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty())
		{
		var defaultParams = store.getTiddlerText("DefaultTiddlers").parseParams("open",null,false);
		invokeParamifier(defaultParams,"onstart");
		}
	window.scrollTo(0,0);
}

function saveTest()
{
	var saveTest = document.getElementById("saveTest");
	if(saveTest.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	saveTest.appendChild(document.createTextNode("savetest"));
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	installedPlugins = [];
	var hadProblem = false;
	for(var t=0; t<configTiddlers.length; t++)
		{
		tiddler = configTiddlers[t];
		pluginInfo = getPluginInfo(tiddler);
		if(isPluginExecutable(pluginInfo))
			{
			pluginInfo.executed = true;
			pluginInfo.error = false;
			try
				{
				if(tiddler.text && tiddler.text != "")
					window.eval(tiddler.text);
				}
			catch(e)
				{
				pluginInfo.log.push(config.messages.pluginError.format([exceptionText(e)]));
				pluginInfo.error = true;
				hadProblem = true;
				}
			}
		else
			pluginInfo.warning = true;
		installedPlugins.push(pluginInfo);
		}
	return hadProblem;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable"))
		return verifyTail(plugin,false,config.messages.pluginDisabled);
	if(plugin.tiddler.isTagged("systemConfigForce"))
		return verifyTail(plugin,true,config.messages.pluginForced);
	if(plugin["CoreVersion"])
		{
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0]) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1]) - version.minor;
		if(w == 0 && coreVersion[2])
		 	w = parseInt(coreVersion[2]) - version.revision;
		if(w > 0)
			return verifyTail(plugin,false,config.messages.pluginVersionError);
		}
	return true;
}

function verifyTail(plugin,result,message)
{
	plugin.log.push(message);
	return result;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try
		{
		var m = config.macros[macro];
		if(m && m.handler)
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		else
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	catch(ex)
		{
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
		}
}

// ---------------------------------------------------------------------------------
// Paramifiers
// ---------------------------------------------------------------------------------

function getParameters()
{
	var p = null;
	if(window.location.hash)
		{
		p = decodeURI(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
		}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var t=1; t<params.length; t++)
		{
		var p = config.paramifiers[params[t].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[t].value);
		}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
		}
};

config.paramifiers.open = {
	onstart: function(v) {
		story.displayTiddler("bottom",v,null,false,false);
		}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
		}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
		}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
		}
};

config.paramifiers.tag = {
	onstart: function(v) {
		var tagged = store.getTaggedTiddlers(v,"title");
		for(var t=0; t<tagged.length; t++)
			story.displayTiddler("bottom",tagged[t].title,null,false,false);
		}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly)
			{
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
			}
		}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly)
			{
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
			}
		}
};

// ---------------------------------------------------------------------------------
// Formatter helpers
// ---------------------------------------------------------------------------------

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++)
		{
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
		}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},
	
	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			var s,v;
			if(lookaheadMatch[1])
				{
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
				}
			else
				{
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
				}
			if (s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
			}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++)
			{
			try
				{
				e.style[styles[t].style] = styles[t].value;
				}
			catch (ex)
				{
				}
			}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link))
			{
			//# Definitely not an external link
			return false;
			}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link))
			{
			// Definitely an external link
			return true;
			}
		if (link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1)
			{
			//# Link contains . / or \ so is probably an external link
			return true;
			}
		//# Otherwise assume it is not an external link
		return false;
	}

};

// ---------------------------------------------------------------------------------
// Standard formatters
// ---------------------------------------------------------------------------------

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},

	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k")
				{
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
				}
			else
				{
				if(nextRowType != currRowType)
					{
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
					}
				if(currRowType == "c")
					{
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
					}
				else
					{
					this.rowHandler(w,createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow"),prevColumns);
					rowCount++;
					}
				}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch)
			{
			if(cellMatch[1] == "~")
				{
				// Rowspan
				var last = prevColumns[col];
				if(last)
					{
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					}
				w.nextMatch = this.cellRegExp.lastIndex-1;
				}
			else if(cellMatch[1] == ">")
				{
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
				}
			else if(cellMatch[2])
				{
				// End of row
				if(prevCell && colSpanCount > 1)
					{
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
					}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
				}
			else
				{
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ")
					{
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
					}
				var cell;
				if(chr == "!")
					{
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
					}
				else
					cell = createTiddlyElement(e,"td");
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1, element:cell};
				if(colSpanCount > 1)
					{
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
					}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
				}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
			}
	}
},

{
	name: "heading",
	match: "^!{1,5}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:(?:(?:\\*)|(?:#)|(?:;)|(?::))+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var placeStack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			if(lookaheadMatch[1])
				{
				listType = "ul";
				itemType = "li";
				}
			else if(lookaheadMatch[2])
				{
				listType = "ol";
				itemType = "li";
				}
			else if(lookaheadMatch[3])
				{
				listType = "dl";
				itemType = "dt";
				}
			else if(lookaheadMatch[4])
				{
				listType = "dl";
				itemType = "dd";
				}
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			if(listLevel > currLevel)
				{
				for(var t=currLevel; t<listLevel; t++)
					placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],listType));
				}
			else if(listLevel < currLevel)
				{
				for(var t=currLevel; t>listLevel; t--)
					placeStack.pop();
				}
			else if(listLevel == currLevel && listType != currType)
				{
				placeStack.pop();
				placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],listType));
				}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(placeStack[placeStack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var placeStack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel)
				{
				for(t=currLevel; t<newLevel; t++)
					placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],this.element));
				}
			else if(newLevel < currLevel)
				{
				for(t=currLevel; t>newLevel; t--)
					placeStack.pop();
				}
			currLevel = newLevel;
			w.subWikifyTerm(placeStack[placeStack.length-1],this.termRegExp);
			createTiddlyElement(placeStack[placeStack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched)
				{
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
				}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^\\{\\{\\{\\n",
	lookaheadRegExp: /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForCSS",
	match: "^/\\*[\\{]{3}\\*/\\n",
	lookaheadRegExp: /\/\*[\{]{3}\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*[\}]{3}\*\/$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForPlugin",
	match: "^//\\{\\{\\{\\n",
	lookaheadRegExp: /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForTemplate",
	match: "^<!--[\\{]{3}-->\\n",
	lookaheadRegExp: /<!--[\{]{3}-->\n*((?:^[^\n]*\n)+?)(\n*^<!--[\}]{3}-->$\n?)/mg, 
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "wikifyCommentForPlugin", 
	match: "^/\\*\\*\\*\\n",
	termRegExp: /(^\*\*\*\/\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "wikifyCommentForTemplate", 
	match: "^<!---\\n",
	termRegExp: /(^--->\n)/mg,
	handler: function(w) 
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1])
			{
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
			}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3])
				{
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link))
						? createExternalLink(w.output,link)
						: createTiddlyLink(w.output,link,false,null,w.isStatic);
				}
			else
				{
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic);
				}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "unWikiLink",
	match: config.textPrimitives.unWikiLink+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		w.outputText(w.output,w.matchStart+1,w.nextMatch);
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchStart > 0)
			{
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1)
				{
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
				}
			}
		if(w.autoLinkWikiWords == true || store.isShadowTiddler(w.matchText))
			{
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic);
			w.outputText(link,w.matchStart,w.nextMatch);
			}
		else
			{
			w.outputText(w.output,w.matchStart,w.nextMatch);
			}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[(<?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) // Simple bracketted link
			{
			var e = w.output;
			if(lookaheadMatch[5])
				{
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic);
				addClass(e,"imageLink");
				}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "boldByChar",
	match: "''",
	termRegExp: /('')/mg,
	element: "strong",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "italicByChar",
	match: "//",
	termRegExp: /(\/\/)/mg,
	element: "em",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "underlineByChar",
	match: "__",
	termRegExp: /(__)/mg,
	element: "u",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "strikeByChar",
	match: "--(?!\\s|$)",
	termRegExp: /((?!\s)--|(?=\n\n))/mg,
	element: "strike",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "superscriptByChar",
	match: "\\^\\^",
	termRegExp: /(\^\^)/mg,
	element: "sup",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "subscriptByChar",
	match: "~~",
	termRegExp: /(~~)/mg,
	element: "sub",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "monospacedByChar",
	match: "\\{\\{\\{",
	lookaheadRegExp: /\{\{\{((?:.|\n)*?)\}\}\}/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "styleByChar",
	match: "@@",
	termRegExp: /(@@)/mg,
	handler:  function(w)
	{
		var e = createTiddlyElement(w.output,"span");
		var styles = config.formatterHelpers.inlineCssHelper(w);
		if(styles.length == 0)
			e.className = "marked";
		else
			config.formatterHelpers.applyCssHelper(e,styles);
		w.subWikifyTerm(e,this.termRegExp);
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
		{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
		}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
		{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
		}
},

{
	name: "customClasses",
	match: "\\{\\{",
	termRegExp: /(\}\}\})/mg,
	lookaheadRegExp: /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch)
			{
			var e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			w.subWikifyTerm(e,this.termRegExp);
			}
	}
}

];

// ---------------------------------------------------------------------------------
// Wikifier
// ---------------------------------------------------------------------------------

function getParser(tiddler)
{
	var f = formatter;
	if(tiddler!=null)
		{
		for(var i in config.parsers)
			{
			if(tiddler.isTagged(config.parsers[i].formatTag))
				{
				f = config.parsers[i];
				break;
				}
			}
		}
	return f;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.subWikifyUnterm(output);
		}
}

function wikifyStatic(source,highlightRegExp,tiddler)
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	var html = "";
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikifyUnterm(e);
		html = e.innerHTML;
		e.parentNode.removeChild(e);
		}
	return html;
}

// Wikify a named tiddler to plain text
function wikifyPlain(title)
{
	if(store.tiddlerExists(title) || store.isShadowTiddler(title))
		{
		var wikifier = new Wikifier(store.getTiddlerText(title),formatter,null,store.getTiddler(title));
		return wikifier.wikifyPlain();
		}
	else
		return "";
}

// Highlight plain text into an element
function highlightify(source,output,highlightRegExp)
{
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,formatter,highlightRegExp);
		wikifier.outputText(output,0,source.length);
		}
}

// Construct a wikifier object
// source - source string that's going to be wikified
// formatter - Formatter() object containing the list of formatters to be used
// highlightRegExp - regular expression of the text string to highlight
// tiddler - reference to the tiddler that's taken to be the container for this wikification
function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp)
		{
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
		}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = getPlainText(e);
	e.parentNode.removeChild(e);
	return text;
}

Wikifier.prototype.subWikify = function(output,terminator)
{
	// Handle the terminated and unterminated cases separately
	if (terminator)
		this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
	else
		this.subWikifyUnterm(output);
}

Wikifier.prototype.subWikifyUnterm = function(output)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first match
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch)
		{
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		// Figure out which formatter matched and call its handler
		for(var t=1; t<formatterMatch.length; t++)
			{
			if(formatterMatch[t])
				{
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
				}
			}
		// Get the next match
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
		}
	// Output any text after the last match
	if(this.nextMatch < this.source.length)
		{
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
		}
	// Restore the output pointer
	this.output = oldOutput;
}

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first matches for the formatter and terminator RegExps
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch)
		{
		// Check for a terminator match  before the next formatter match
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index))
			{
			// Output any text before the match
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			// Set the match parameters
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			// Restore the output pointer
			this.output = oldOutput;
			return;
			}
		// It must be a formatter match; output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		// Figure out which formatter matched and call its handler
		for(var t=1; t<formatterMatch.length; t++)
			{
			if(formatterMatch[t])
				{
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
				}
			}
		// Get the next match
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
		}
	// Output any text after the last match
	if(this.nextMatch < this.source.length)
		{
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
		}
	// Restore the output pointer
	this.output = oldOutput;
}

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	// Check for highlights
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos))
		{
		// Deal with any plain text before the highlight
		if(this.highlightMatch.index > startPos)
			{
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
			}
		// Deal with the highlight
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		// Nudge along to the next highlight if we're done with this one
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
		}
	// Do the unhighlighted text left over
	if(startPos < endPos)
		{
		createTiddlyText(place,this.source.substring(startPos,endPos));
		}
}

// ---------------------------------------------------------------------------------
// Macro definitions
// ---------------------------------------------------------------------------------

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text;
	if(params[0])
		text = now.formatString(params[0].trim());
	else
		text = now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
}

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
}

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var theList = document.createElement("ul");
	place.appendChild(theList);
	if(this[type].prompt)
		createTiddlyElement(theList,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++)
		{
		var theListItem = document.createElement("li")
		theList.appendChild(theListItem);
		if(typeof results[t] == "string")
			createTiddlyLink(theListItem,results[t],true);
		else
			createTiddlyLink(theListItem,results[t].title,true);
		}
}

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
}

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
}

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
}

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
}

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags();
	var theDateList = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(theDateList,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++)
		{
		var theListItem =createTiddlyElement(theDateList,"li");
		var theTag = createTiddlyButton(theListItem,tags[t][0] + " (" + tags[t][1] + ")",this.tooltip.format([tags[t][0]]),onClickTag);
		theTag.setAttribute("tag",tags[t][0]);
		}
}

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] ? params[0] : "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	for(var t=tiddlers.length-1; t>=last; t--)
		{
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay)
			{
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler[field].formatString(this.dateFormat));
			lastDay = theDay;
			}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink");
		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
		}
}

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick);
	var txt = createTiddlyElement(place,"input",null,"txtOptionInput");
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	if(config.browser.isSafari)
		{
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
		}
	else
		txt.setAttribute("type","text");
}

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0)
		{
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
		}
}

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
}

config.macros.search.onKeyPress = function(e)
{
	if(!e) var e = window.event;
	switch(e.keyCode)
		{
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
		}
	if(this.value.length > 2)
		{
		if(this.value != this.getAttribute("lastSearchText"))
			{
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
			var txt = this;
			config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
			}
		}
	else
		{
		if(config.macros.search.timeout)
			clearTimeout(config.macros.search.timeout);
		}
}

config.macros.search.onFocus = function(e)
{
	this.select();
}

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] ? names[1] : null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args)
		{
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
		}
	var text = store.getTiddlerText(tiddlerName);
	if(text)
		{
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try
			{
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) 
				{
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
				}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
			}
		finally
			{
			stack.pop();
			}
		}
}

config.macros.tiddler.renderText = function(place,text,tiddlerName,params) 
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
}

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
}

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++)
		{
		createTagButton(createTiddlyElement(theList,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(theList,sep);
		}
}

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	theList.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++)
		{
		createTiddlyLink(createTiddlyElement(theList,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(theList,sep);
		}
}

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
}

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
}

config.macros.saveChanges.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);
}

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
}

config.macros.slider.onClickSlider = function(e)
{
	if(!e) var e = window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(anim && config.options.chkAnimate)
		anim.startAnimating(new Slider(n,!isOpen,e.shiftKey || e.altKey,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
}

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var cookie = cookie ? cookie : "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",cookie);
	panel.style.display = config.options[cookie] ? "block" : "none";
	place.appendChild(panel);
	return panel;
}

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh", "content");
	panel.setAttribute("tiddler", params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
}

config.macros.option.onChangeOption = function(e)
{
	var opt = this.getAttribute("option");
	var elementType,valueField;
	if(opt)
		{
		switch(opt.substr(0,3))
			{
			case "txt":
				elementType = "input";
				valueField = "value";
				break;
			case "chk":
				elementType = "input";
				valueField = "checked";
				break;
			}
		config.options[opt] = this[valueField];
		saveOptionCookie(opt);
		var nodes = document.getElementsByTagName(elementType);
		for(var t=0; t<nodes.length; t++)
			{
			var optNode = nodes[t].getAttribute("option");
			if(opt == optNode)
				nodes[t][valueField] = this[valueField];
			}
		}
	return(true);
}

config.macros.option.handler = function(place,macroName,params)
{
	var opt = params[0];
	if(config.options[opt] == undefined)
		return;
	var c;
	switch(opt.substr(0,3))
		{
		case "txt":
			c = document.createElement("input");
			c.onkeyup = this.onChangeOption;
			c.setAttribute("option",opt);
			c.className = "txtOptionInput";
			place.appendChild(c);
			c.value = config.options[opt];
			break;
		case "chk":
			c = document.createElement("input");
			c.setAttribute("type","checkbox");
			c.onclick = this.onChangeOption;
			c.setAttribute("option",opt);
			c.className = "chkOptionInput";
			place.appendChild(c);
			c.checked = config.options[opt];
			break;
		}
}



config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++)
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal);
	btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	var text = getParam(params,"text");
	if(text !== undefined) 
		btn.setAttribute("newText",text);
	return btn;
}

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal"))
		{
		var now = new Date();
		title = now.formatString(title.trim());
		}
	var params = this.getAttribute("params").split("|");
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	story.displayTiddler(null,title,template);
	var text = this.getAttribute("newText");
	if(typeof text == "string")
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<params.length;t++)
		story.setTiddlerTag(title,params[t],+1);
	story.focusTiddler(title,focus);
	return false;
}

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly)
		{
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
		}
}

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly)
		{
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : "";
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
		}
}

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	for(var t=0; t<params.length; t++)
		{
		var v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
		}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++)
		{
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		var v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
		}
}

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++)
		{
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
		}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
}

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
}

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++)
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab)
			{
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
			}
		else
			nodes[t].className = "tab tabUnselected"
	if(theTab)
		{
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			tabset.parentNode.removeChild(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie)
			{
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
			}
		}
}

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier)
{
	var terminator = ">>";
	var panel;
	if(wikifier)
		panel = createTiddlyElement(place,"div",null,"gradient");
	else
		panel = place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	var t;
	if(wikifier)
		{
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
		}
	var colours = [];
	for(t=1; t<params.length; t++)
		{
		var c = new RGB(params[t]);
		if(c)
			colours.push(c);
		}
	drawGradient(panel,params[0] != "vert",colours);
	if(wikifier)
		wikifier.subWikify(panel,terminator);
	if(document.all)
		{
		panel.style.height = "100%";
		panel.style.width = "100%";
		}
}

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0])
		{
		var m = config;
		var p = params[0].split(".");
		for(var t=0; t<p.length; t++)
			{
			if(p[t] in m)
				m = m[p[t]];
			else
				break;
			}
		createTiddlyText(place,m.toString().format(params.splice(1)));
		}
}

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0])
		{
		var value = store.getValue(tiddler,params[0]);
		if(value != undefined)
			switch(params[1])
				{
				case undefined:
					highlightify(value,place,highlightHack);
					break;
				case "link":
					createTiddlyLink(place,value,true);
					break;
				case "wikified":
					wikify(value,place,highlightHack,tiddler);
					break;
				case "date":
					value = Date.convertFromYYYYMMDDHHMM(value);
					if(params[2])
						createTiddlyText(place,value.formatString(params[2]));
					else
						createTiddlyText(place,value);
					break;
				}
		}
}

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	if((tiddler instanceof Tiddler) && field)
		{
		story.setDirty(tiddler.title,true);
		if(field != "text")
			{
				var e = createTiddlyElement(null,"input");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				e.setAttribute("edit",field);
				e.setAttribute("type","text");
				var v = store.getValue(tiddler,field);
				if(!v) 
					v = "";
				e.value = v;
				e.setAttribute("size","40");
				e.setAttribute("autocomplete","off");
				place.appendChild(e);
			}
		else
			{
				var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
				var wrapper2 = createTiddlyElement(wrapper1,"div");
				var e = createTiddlyElement(wrapper2,"textarea");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				var v = store.getValue(tiddler,field);
				if(!v) 
					v = "";
				e.value = v;
				var rows = 10;
				var lines = v.match(/\n/mg);
				var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
				if(lines != null && lines.length > rows)
					rows = lines.length + 5;
				rows = Math.min(rows,maxLines);
				e.setAttribute("rows",rows);
				e.setAttribute("edit",field);
				place.appendChild(wrapper1);
			}
		}
}

config.macros.tagChooser.onClick = function(e)
{
	if(!e) var e = window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags();
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for(var t=0; t<tags.length; t++)
		{
		var theTag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler", this.getAttribute("tiddler"));
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return(false);
}

config.macros.tagChooser.onTagClick = function(e)
{
	if(!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return(false);
}

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler)
		{
		var title = tiddler.title;
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler", title);
		}
}

// Create a toolbar command button
// place - parent DOM element
// command - reference to config.commands[] member -or- name of member
// tiddler - reference to tiddler that toolbar applies to
// theClass - the class to give the button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,theClass)
{
	if(typeof commandName != "string")
		{
		var c = null;
		for(var t in config.commands)
			if(config.commands[t] == commandName)
				c = t;
		commandName = c;
		}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string"))
		{
		var title = tiddler.title;
		var command = config.commands[commandName];
		var ro = tiddler.isReadOnly();
		var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
		var text = ro && command.readOnlyText ? command.readOnlyText : command.text;
		var tooltip = ro && command.readOnlyTooltip ? command.readOnlyTooltip : command.tooltip;
		if((!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow))

			{
			var btn = createTiddlyButton(null,text,tooltip,this.onClickCommand);
			btn.setAttribute("commandName", commandName);
			btn.setAttribute("tiddler", title);
			if(theClass)
				addClass(btn,theClass);
			place.appendChild(btn);
			}
		}
}

config.macros.toolbar.onClickCommand = function(e)
{
	if(!e) var e = window.event;
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
}

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,theClass,event)
{
	var children = place.getElementsByTagName("a")
	for(var t=0; t<children.length; t++)
		{
		var c = children[t];
		if(hasClass(c,theClass) && c.getAttribute && c.getAttribute("commandName"))
			{
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
			}
		}
}

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++)
		{
		var c = params[t];
		var theClass = "";
		switch(c.substr(0,1))
			{
			case "+":
				theClass = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				theClass = "cancelCommand";
				c = c.substr(1);
				break;
			}
		if(c in config.commands)
			this.createCommand(place,c,tiddler,theClass);
		}
}

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var e = createTiddlyElement(place,"div");
	e.setAttribute("refresh","macro");
	e.setAttribute("macroName","plugins");
	e.setAttribute("params",paramString);
	this.refresh(e,paramString);
}

config.macros.plugins.refresh = function(place,params)
{
	var selectedRows = [];
	ListView.forEachSelector(place,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(place);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++)
		{
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null)
			{
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
			}
		}
	for(t=0; t<plugins.length; t++)
		{
		var p = plugins[t];
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
		}
	if(plugins.length == 0)
		createTiddlyElement(place,"em",null,null,this.noPluginText);
	else
		ListView.create(place,plugins,this.listViewTemplate,this.onSelectCommand);
}

config.macros.plugins.onSelectCommand = function(command,rowNames)
{
	var t;
	switch(command)
		{
		case "remove":
			for(t=0; t<rowNames.length; t++)
				store.setTiddlerTag(rowNames[t],false,"systemConfig");
			break;
		case "delete":
			if(rowNames.length > 0 && confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")])))
				{
				for(t=0; t<rowNames.length; t++)
					{
					store.removeTiddler(rowNames[t]);
					story.closeTiddler(rowNames[t],true,false);
					}
				}
			break;
		}
	if(config.options.chkAutoSave)
		saveChanges(true);
}

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
}

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly)
		{
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
		}
	var importer = createTiddlyElement(null,"div",null,"importTiddler wizard");
	createTiddlyElement(importer,"h1",null,null,this.wizardTitle);
	createTiddlyElement(importer,"h2",null,"step1",this.step1);
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	createTiddlyText(step,this.step1prompt);
	var input = createTiddlyElement(null,"input",null,"txtOptionInput");
	input.type = "text";
	input.size = 50;
	step.appendChild(input);
	importer.inputBox = input;
	createTiddlyElement(step,"br");
	createTiddlyText(step,this.step1promptFile);
	var fileInput = createTiddlyElement(null,"input",null,"txtOptionInput");
	fileInput.type = "file";
	fileInput.size = 50;
	fileInput.onchange = this.onBrowseChange;
	fileInput.onkeyup = this.onBrowseChange;
	step.appendChild(fileInput);
	createTiddlyElement(step,"br");
	createTiddlyText(step,this.step1promptFeeds);
	var feeds = this.getFeeds([{caption: this.step1feedPrompt, name: ""}]);
	createTiddlyDropDown(step,this.onFeedChange,feeds);
	createTiddlyElement(step,"br");
	createTiddlyButton(step,this.fetchLabel,this.fetchPrompt,this.onFetch,null,null,null);
        place.appendChild(importer);
}

config.macros.importTiddlers.getFeeds = function(feeds)
{
	var tagged = store.getTaggedTiddlers("contentPublisher","title");
	for(var t=0; t<tagged.length; t++)
		feeds.push({caption: tagged[t].title, name: store.getTiddlerSlice(tagged[t].title,"URL")});
	return feeds;
}

config.macros.importTiddlers.onFeedChange = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	importer.inputBox.value = this.value;
	this.selectedIndex = 0;
}

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	importer.inputBox.value = "file://" + this.value;
}

config.macros.importTiddlers.onFetch = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	var url = importer.inputBox.value;
	var cutoff = findRelated(importer.firstChild,"step2","className","nextSibling");
	while(cutoff)
		{
		var temp = cutoff.nextSibling;
		cutoff.parentNode.removeChild(cutoff);
		cutoff = temp;
		}
	createTiddlyElement(importer,"h2",null,"step2",config.macros.importTiddlers.step2);
	var step = createTiddlyElement(importer,"div",null,"wizardStep",config.macros.importTiddlers.step2Text.format([url]));
	loadRemoteFile(url,config.macros.importTiddlers.onLoad,importer);
}

config.macros.importTiddlers.onLoad = function(status,params,responseText,url,xhr)
{
	if(!status)
		{
		displayMessage(this.fetchError);
		return;
		}
	var importer = params;
	// Check that the tiddler we're in hasn't been closed - doesn't work on IE
//	var p = importer;
//	while(p.parentNode)
//		p = p.parentNode;
//	if(!(p instanceof HTMLDocument))
//		return;
	// Crack out the content - (should be refactored)
	var posOpeningDiv = responseText.indexOf(startSaveArea);
	var limitClosingDiv = responseText.indexOf("<!--POST-BODY-START--"+">");
	var posClosingDiv = responseText.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? responseText.length : limitClosingDiv);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([url]));
		return;
		}
	var content = "<html><body>" + responseText.substring(posOpeningDiv,posClosingDiv + endSaveArea.length) + "</body></html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	importer.insertBefore(iframe,importer.firstChild);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	var importStore = new TiddlyWiki();
	importStore.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	// Extract data for the listview
	var tiddlers = [];
	importStore.forEachTiddler(function(title,tiddler)
		{
		var t = {};
		t.title = title;
		t.modified = tiddler.modified;
		t.modifier = tiddler.modifier;
		t.text = tiddler.text.substr(0,50);
		t.tags = tiddler.tags;
		tiddlers.push(t);
		});
	// Display the listview
	createTiddlyElement(importer,"h2",null,"step3",config.macros.importTiddlers.step3);
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	ListView.create(step,tiddlers,config.macros.importTiddlers.listViewTemplate,config.macros.importTiddlers.onSelectCommand);
	// Save the importer
	importer.store = importStore;
}

config.macros.importTiddlers.onSelectCommand = function(listView,command,rowNames)
{
	var importer = findRelated(listView,"importTiddler","className","parentNode");
	switch(command)
		{
		case "import":
			config.macros.importTiddlers.doImport(importer,rowNames);
			break;
		}
	if(config.options.chkAutoSave)
		saveChanges(true);
}

config.macros.importTiddlers.doImport = function(importer,rowNames)
{
	var theStore = importer.store;
	var overwrite = new Array();
	var t;
	for(t=0; t<rowNames.length; t++)
		{
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0)
		if(!confirm(this.confirmOverwriteText.format([overwrite.join(", ")])))
			return;
	for(t=0; t<rowNames.length; t++)
		{
		var inbound = theStore.fetchTiddler(rowNames[t]);
		store.saveTiddler(inbound.title, inbound.title, inbound.text, inbound.modifier, inbound.modified, inbound.tags);
		store.fetchTiddler(inbound.title).created = inbound.created;
		store.notify(rowNames[t],false);
		}
	store.notifyAll();
	store.setDirty(true);
	createTiddlyElement(importer,"h2",null,"step4",this.step4.format([rowNames.length]));
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	for(t=0; t<rowNames.length; t++)
		{
		createTiddlyLink(step,rowNames[t],true);
		createTiddlyElement(step,"br");
		}
	createTiddlyElement(importer,"h2",null,"step5",this.step5);
}
// ---------------------------------------------------------------------------------
// Menu and toolbar commands
// ---------------------------------------------------------------------------------

config.commands.closeTiddler.handler = function(event,src,title)
{
	story.closeTiddler(title,true,event.shiftKey || event.altKey);
	return false;
}

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
}

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
	story.focusTiddler(title,"text");
	return false;
}

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
	   story.displayTiddler(null,newTitle);
	return false;
}

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly)
		if(!confirm(this.warning.format([title])))
			return false;
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
}

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if (config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if (deleteIt)
		{
		store.removeTiddler(title);
		story.closeTiddler(title,true,event.shiftKey || event.altKey);
		if(config.options.chkAutoSave)
			saveChanges();
		}
	return false;
}

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
}

config.commands.references.handler = function(event,src,title)
{
	var popup = Popup.create(src);
	if(popup)
		{
		var references = store.getReferringTiddlers(title);
		var c = false;
		for(var r=0; r<references.length; r++)
			if(references[r].title != title && !references[r].isTagged("excludeLists"))
				{
				createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
				c = true;
				}
		if(!c)
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
		}
	Popup.show(popup,false);
	event.cancelBubble = true;
	if (event.stopPropagation) event.stopPropagation();
	return false;
}

config.commands.jump.handler = function(event,src,title)
{
	var popup = Popup.create(src);
	if(popup)
		{
		story.forEachTiddler(function(title,element) {
			createTiddlyLink(createTiddlyElement(popup,"li"),title,true);
			});
		}
	Popup.show(popup,false);
	event.cancelBubble = true;
	if (event.stopPropagation) event.stopPropagation();
	return false;
}

// ---------------------------------------------------------------------------------
// Tiddler() object
// ---------------------------------------------------------------------------------

function Tiddler()
{
	this.title = null;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.created = new Date();
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
}

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title" + ">" + this.title.htmlEncode() + "</title" + ">");
	s.push("<description>" + wikifyStatic(this.text,null,this).htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return(s.join("\n"));
}

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
}

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
}

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
}

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
}

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
}

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
}

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(this.text);
	while(formatMatch)
		{
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) // wikiWordLink
			{
			if(formatMatch.index > 0)
				{
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(this.text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
				}
			else
				this.links.pushUnique(formatMatch[1]);
			}
		else if(formatMatch[2-t] && (store.tiddlerExists(formatMatch[3-t]) || store.isShadowTiddler(formatMatch[3-t]))) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		// Do not add link if match urlPattern (formatMatch[5-t])
		formatMatch = tiddlerLinkRegExp.exec(this.text);
		}
	this.linksUpdated = true;
	return;
}

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return(config.messages.tiddlerLinkTooltip.format([this.title,theModifier,theModified]));
}

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
}

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
}

Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
}

// ---------------------------------------------------------------------------------
// TiddlyWiki() object contains Tiddler()s
// ---------------------------------------------------------------------------------

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
		};
	this.fetchTiddler = function(title) {
		return tiddlers[title];
		};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
		};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
		};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers)
			{
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
			}
		};
}

// Set the dirty flag
TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
}

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
}

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
}

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
}

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel)
		for(var t=0; t<this.namedNotifications.length; t++)
			{
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
			}
}

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel)
		for(var t=0; t<this.namedNotifications.length; t++)
			{
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
			}
}

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for (var i=0; i<this.namedNotifications.length; i++)
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	this.namedNotifications.push({name: title, notify: fn});
	return this;
}

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		{
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
		}
}

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return (t != undefined);
}

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return typeof config.shadowTiddlers[title] == "string";
}

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
}

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		return tiddler.text;
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1)
		{
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
		}
	if(this.isShadowTiddler(title))
		return config.shadowTiddlers[title];
	if(defaultText != undefined)
		return defaultText;
	return null;
}

TiddlyWiki.prototype.slicesRE = /(?:[\'\/]*~?(\w+)[\'\/]*\:[\'\/]*\s*(.*?)\s*$)|(?:\|[\'\/]*~?(\w+)\:?[\'\/]*\|\s*(.*?)\s*\|)/gm

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title) 
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	do 
		{
			var m = this.slicesRE.exec(text);
			if (m) 
				{
					if (m[1])
						slices[m[1]] = m[2];
					else
						slices[m[3]] = m[4];
				}
		}
	while(m);
	return slices;
}

// Returns the slice of text of the given name
//#
//# A text slice is a substring in the tiddler's text that is defined
//# either like this
//#    aName:  textSlice
//# or
//#    |aName:| textSlice |
//# or
//#    |aName| textSlice |
//#
//# In the text the name (or name:) may be decorated with '' or //. I.e.
//# this would also a possible text slice:
//#
//#    |''aName:''| textSlice |
//#
//# @param name should only contain "word characters" (i.e. "a-ZA-Z_0-9")
//# @return [may be undefined] the (trimmed) text of the specified slice.
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if (!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
}

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++)
		{
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
		}
	return r;
}

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match)
			{
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1])
				{
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
				}
			lastPos = match.index + match[0].length;
			}
		else
			textOut.push(text.substr(lastPos));
	} while(match);
	return(textOut.join(""));
}

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		{
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		this.notify(title,true);
		this.setDirty(true);
		}
}

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields)
{
	var tiddler = this.fetchTiddler(title);
	var created;
	if(tiddler)
		{
		created = tiddler.created; // Preserve created date
		this.deleteTiddler(title);
		}
	else
		{
		tiddler = new Tiddler();
		created = modified;
		}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
}

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		{
		tiddler = new Tiddler();
		tiddler.title = title;
		this.addTiddler(tiddler);
		this.setDirty(true);
		}
	return tiddler;
}

// Load contents of a tiddlywiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate)
		{
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
		}
}

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
		});
}

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return store.getSaver().externalize(store);
}

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag)
{
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++)
		{
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
		}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
}

// Return an array of all the tags in use. Each member of the array is another array where [0] is the name of the tag and [1] is the number of occurances
TiddlyWiki.prototype.getTags = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++)
			{
			var tag = tiddler.tags[g];
			var f = false;
			for(var c=0; c<results.length; c++)
				if(results[c][0] == tag)
					{
					f = true;
					results[c][1]++;
					}
			if(!f)
				results.push([tag,1]);
			}
		});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
}

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
}

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
}

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++)
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		if(f)
			results.push(tiddler);
		});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
}

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
		});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
}

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		for(var n=0; n<tiddler.links.length;n++)
			{
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
			}
		});
	results.sort();
	return results;
}

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
		});
	results.sort();
	return results;
}

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers)
		if(typeof config.shadowTiddlers[t] == "string")
			results.push(t);
	results.sort();
	return results;
}

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler) 
{
	var t = (typeof tiddler == 'string') ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
}

TiddlyWiki.prototype.getLoader = function() 
{
	if (!this.loader) 
		this.loader = new TW21Loader();
	return this.loader;
}
 
TiddlyWiki.prototype.getSaver = function() 
{
	if (!this.saver) 
		this.saver = new TW21Saver();
	return this.saver;
}

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by '.'
TiddlyWiki.isValidFieldName = function (name) {
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
}

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name) {
	if (!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
}

function StringFieldAccess(n, readOnly) {
	this.set = readOnly 
		? function(t,v) {if (v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);}
		: function(t,v) {if (v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n) {
	this.set = function(t,v) {
			var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v); 
			if (d != t[n]) {
				t[n] = d; return true;
			}
		};
	this.get = function(t)   {return t[n].convertToYYYYMMDDHHMM();}
}

function LinksFieldAccess(n) {
	this.set = function(t,v) {
			var s = (typeof v == "string") ? v.readBracketedList() : v; 
			if (s.toString() != t[n].toString()) {
				t[n] = s; return true;
			}
		};
	this.get = function(t)   {return String.encodeTiddlyLinkList(t[n]);}
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	
	"title":    new StringFieldAccess("title", true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title", true),
	
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name) {
	return TiddlyWiki.standardFieldAccess[name] != undefined;
}

// Sets the value of the given field of the tiddler to the value. 
// Setting an ExtendedField's value to null or undefined removes the field. 
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler, fieldName, value) {
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return;
		
	fieldName = fieldName.toLowerCase();

	var isRemove = (value === undefined) || (value === null);

	if (!t.fields) 
		t.fields = {};
		
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if (accessor) {
		if (isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if (!h.set(t, value))
			return;

	} else {
		var oldValue = t.fields[fieldName];
		
		if (isRemove) {
			if (oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				
				// delete all fields in a namespace
				var re = new RegExp('^'+fieldName+'\\.');
				var dirty = false;
				for (var n in t.fields) {
					if (n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if (!dirty)
					return
			}
				
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
 			value = value instanceof Date 
				? value.convertToYYYYMMDDHHMMSSMMM() 
				: String(value);
			if (oldValue == value) 
				return;
			t.fields[fieldName] = value;
		}
	}
	
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if (!fieldName.match(/^temp\./))
		this.setDirty(true);
}

// Returns the value of the given field of the tiddler. 
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler, fieldName) {
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return undefined;

	fieldName = fieldName.toLowerCase();

	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if (accessor) {
		return accessor.get(t);
	}
	
	return t.fields ? t.fields[fieldName] : undefined;
}

// Calls the callback function for every field in the tiddler.
//
// When callback function returns a non-false value the iteration stops 
// and that value is returned. 
//
// The order of the fields is not defined.
// 
// @param callback a function(tiddler, fieldName, value). 
// 
TiddlyWiki.prototype.forEachField = function(tiddler, callback, onlyExtendedFields) {
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return undefined;
	
	if (t.fields) {
		for (var n in t.fields) {
			var result = callback(t, n, t.fields[n]);
			if (result)
				return result;
		}
	}
	
	if (onlyExtendedFields)
		return undefined;

	for (var n in TiddlyWiki.standardFieldAccess) {
		if (n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
			
		var result = callback(t, n, TiddlyWiki.standardFieldAccess[n].get(t));
		if (result)
			return result;
	}

	return undefined;
};
// ---------------------------------------------------------------------------------
// Story functions
// ---------------------------------------------------------------------------------

// A story is a HTML div containing a sequence of tiddlers that can be manipulated
// container - id of containing element
// idPrefix - string prefix prepended to title to make ids for tiddlers in this story
function Story(container,idPrefix)
{
	this.container = container;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
}

// Iterate through all the tiddlers in a story
// fn - callback function to be called for each tiddler. Arguments are:
//		tiddler - reference to Tiddler object
//		element - reference to tiddler display element
Story.prototype.forEachTiddler = function(fn)
{
	var place = document.getElementById(this.container);
	if(!place)
		return;
	var e = place.firstChild;
	while(e)
		{
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
		}
}

// Display several tiddlers given their titles in an array. Parameters same as displayTiddler(), except:
// titles - array of string titles
Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,slowly)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,slowly);
}

// Display a given tiddler with a given template. If the tiddler is already displayed but with a different
// template, it is switched to the specified template
// srcElement - reference to element from which this one is being opened -or-
//              special positions "top", "bottom"
// title - title of tiddler to display
// template - the name of the tiddler containing the template -or-
//			  one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE -or-
//			  null or undefined to indicate the current template if there is one, DEFAULT_VIEW_TEMPLATE if not
// animate - whether to perform animations
// slowly - whether to perform animations in slomo
Story.prototype.displayTiddler = function(srcElement,title,template,animate,slowly)
{
	var place = document.getElementById(this.container);
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem)
		this.refreshTiddler(title,template);
	else
		{
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template);
		}
	if(srcElement && typeof srcElement !== "string")
		{
		if(anim && config.options.chkAnimate && (animate == undefined || animate == true))
			anim.startAnimating(new Cascade(title,srcElement,tiddlerElem,slowly),new Scroller(tiddlerElem,slowly));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
		}
}

// Figure out the appropriate position for a newly opened tiddler
// srcElement - reference to the element containing the link to the tiddler -or-
//              special positions "top", "bottom"
// returns - reference to the tiddler that the new one should appear before (null for the bottom of the story)
Story.prototype.positionTiddler = function(srcElement)
{
	var place = document.getElementById(this.container);
	var before;
	if(typeof srcElement == "string")
		{
		switch(srcElement)
			{
			case "top":
				before = place.firstChild;
				break;
			case "bottom":
				before = null;
				break;
			}
		}
	else
		{
		var after = this.findContainingTiddler(srcElement);
		if(after == null)
			before = place.firstChild;
		else if(after.nextSibling)
			before = after.nextSibling;
		else
			before = null;
		}
	return before;
}

// Create a tiddler frame at the appropriate place in a story column
// place - reference to parent element
// before - null, or reference to element before which to insert new tiddler
// title - title of new tiddler
// template - the name of the tiddler containing the template or one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE
Story.prototype.createTiddler = function(place,before,title,template)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.idPrefix + title,"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	place.insertBefore(tiddlerElem,before);
	this.refreshTiddler(title,template);
	return tiddlerElem;
}

// Overridable for choosing the name of the template to apply for a tiddler
Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
}

// Overridable for extracting the text of a template from a tiddler
Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
}

// Apply a template to an existing tiddler if it is not already displayed using that template
// title - title of tiddler to update
// template - the name of the tiddler containing the template or one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE
// force - if true, forces the refresh even if the template hasn't changedd
Story.prototype.refreshTiddler = function(title,template,force)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem)
		{
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force)
			{
			var tiddler = store.getTiddler(title);
			if(!tiddler)
				{
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title))
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,[],version.date);
				else
					{
					var text = template=="EditTemplate"
								? config.views.editor.defaultText.format([title])
								: config.views.wikified.defaultText.format([title]);
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date);
					}
				}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			var me = this;
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			var html = this.getTemplateForTiddler(title,template,tiddler);
			tiddlerElem.innerHTML = html;
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(!store.tiddlerExists(title))
				{
				if(store.isShadowTiddler(title))
					addClass(tiddlerElem,"shadow");
				else
					addClass(tiddlerElem,"missing");
				}
			else
				{
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
				}
			}
		}
	return tiddlerElem;
}

// Refresh all tiddlers in the Story
Story.prototype.refreshAllTiddlers = function() 
{
	var place = document.getElementById(this.container);
	var e = place.firstChild;
	if(!e)
		return;
	this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
	while((e = e.nextSibling) != null) 
		this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
}

// Default tiddler onmouseover/out event handlers
Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
}

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
}

// Default tiddler ondblclick event handler
Story.prototype.onTiddlerDblClick = function(e)
{
	if(!e) var e = window.event;
	var theTarget = resolveTarget(e);
	if(theTarget && theTarget.nodeName.toLowerCase() != "input" && theTarget.nodeName.toLowerCase() != "textarea")
		{
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if (e.stopPropagation) e.stopPropagation();
		return true;
		}
	else
		return false;
}

Story.prototype.onTiddlerKeyPress = function(e)
{
	if(!e) var e = window.event;
	clearMessage();
	var consume = false; 
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode)
		{
		case 9: // Tab
			if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea")
				{
				replaceSelection(target,String.fromCharCode(9));
				consume = true; 
				}
			if(config.isOpera)
				{
				target.onblur = function()
					{
					this.focus();
					this.onblur = null;
					}
				}
			break;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey)
				{
				blurElement(this);
				config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
				consume = true;
				}
			break; 
		case 27: // Escape
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
			consume = true;
			break;
		}
	e.cancelBubble = consume;
	if(consume)
		{
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
		}
	return(!consume);
};

// Returns the specified field (input or textarea element) in a tiddler, otherwise the first edit field it finds
// or null if it found no edit field at all
Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	var e = null;
	if(tiddlerElem != null)
		{
		var children = tiddlerElem.getElementsByTagName("*");
		for (var t=0; t<children.length; t++)
			{
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea")
				{
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
				}
			}
		}
	return e;
}

// Focus a specified tiddler. Attempts to focus the specified field, otherwise the first edit field it finds
Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e)
		{
		e.focus();
		e.select();
		}
}

// Ensures that a specified tiddler does not have the focus
Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null && tiddlerElem.focus && tiddlerElem.blur)
		{
		tiddlerElem.focus();
		tiddlerElem.blur();
		}
}

// Adds a specified value to the edit controls (if any) of a particular
// array-formatted field of a particular tiddler (eg "tags")
//  title - name of tiddler
//  tag - value of field, without any [[brackets]]
//  mode - +1 to add the tag, -1 to remove it, 0 to toggle it
//  field - name of field (eg "tags")
Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = story.getTiddlerField(title,field);

	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
}

// The same as setTiddlerField but preset to the "tags" field
Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	Story.prototype.setTiddlerField(title,tag,mode,"tags");
}

// Close a specified tiddler
// title - name of tiddler to close
// animate - whether to perform animations
// slowly - whether to perform animations in slomo
Story.prototype.closeTiddler = function(title,animate,slowly)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		{
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(anim && config.options.chkAnimate && animate)
			anim.startAnimating(new Slider(tiddlerElem,false,slowly,"all"));
		else
			tiddlerElem.parentNode.removeChild(tiddlerElem);
		}
}

// Scrub IDs from a tiddler. This is so that the 'ghost' of a tiddler while it is being closed
// does not interfere with things
// tiddler - reference to the tiddler element
Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
}

// Set the 'dirty' flag of a tiddler
// title - title of tiddler to change
// dirty - new boolean status of flag
Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
}

// Is a particular tiddler dirty (with unsaved changes)?
Story.prototype.isDirty = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
}

// Determine whether any open tiddler are dirty
Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
		});
	return r;
}

// Close all tiddlers in the story
Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
		});
	window.scrollTo(0,0);
}

// Check if there are any tiddlers in the story
Story.prototype.isEmpty = function()
{
	var place = document.getElementById(this.container);
	return(place && place.firstChild == null);
}

// Perform a search and display the result
// text - text to search for
// useCaseSensitive - true for case sensitive matching
// useRegExp - true to interpret text as a RegExp
Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ?	 text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	var titles = [];
	for(var t=matches.length-1; t>=0; t--)
		titles.push(matches[t].title);
	this.displayTiddlers(null,titles);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([titles.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
}

// Determine if the specified element is within a tiddler in this story
// e - reference to an element
// returns: reference to a tiddler element or null if none
Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return(e);
}

// Gather any saveable fields from a tiddler element
// e - reference to an element to scan recursively
// fields - object to contain gathered field values
Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute)
		{
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");;
		if(e.hasChildNodes())
			{
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields)
			}
		}
}

// Determine whether a tiddler has any edit fields, and if so if their values have been changed
// title - name of tiddler
Story.prototype.hasChanges = function(title)
{
	var e = document.getElementById(this.idPrefix + title);
	if(e != null)
		{
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if (!tiddler)
			return false;
		for(var n in fields)
			if (store.getValue(title,n) != fields[n])
				return true;
		}
	return false;
}

// Save any open edit fields of a tiddler and updates the display as necessary
// title - name of tiddler
// minorUpdate - true if the modified date shouldn't be updated
// returns: title of saved tiddler, or null if not saved
Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		{
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title ? fields.title : title;
		if(store.tiddlerExists(newTitle) && newTitle != title)
			{
			if(confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				this.closeTiddler(newTitle,false,false);
			else
				return null;
			}
		tiddlerElem.id = this.idPrefix + newTitle;
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		var newDate = new Date();
		store.saveTiddler(title,newTitle,fields.text,config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags);
		for (var n in fields) 
			if (!TiddlyWiki.isStandardField(n))
				store.setValue(newTitle,n,fields[n]);
		if(config.options.chkAutoSave)
			saveChanges();
		return newTitle;
		}
	return null;
}

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
		});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
}

// ---------------------------------------------------------------------------------
// Message area
// ---------------------------------------------------------------------------------

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e)
		{
		alert(text);
		return;
		}
	if(linkText)
		{
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
		}
	else
		e.appendChild(document.createTextNode(text));
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea)
		{
		removeChildren(msgArea);
		msgArea.style.display = "none";
		}
	return false;
}

// ---------------------------------------------------------------------------------
// Refresh mechanism
// ---------------------------------------------------------------------------------

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},
	
	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1)
			{
			removeChildren(e);
			wikify(store.getTiddlerText(title,title),e);
			return true;
			}
		else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++)
		{
		var e = nodes[c],type;
		if(e.getAttribute)
			type = e.getAttribute("refresh");
		else
			type = null;
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
		}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e)
		{
		var nextChild = e.nextSibling;
		if(e.getAttribute)
			{
			var macro = e.getAttribute("macro");
			if(macro)
				{
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1)
					{
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
					}
				invokeMacro(e,macro,params,null,tiddler);
				}
			}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
		}
}

function refreshPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = document.getElementById("tiddlerDisplay");
	var nodes,t;
	if(display)
		{
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
		}
	var wrapper = document.getElementById("contentWrapper");
	if(!title)
		title = "PageTemplate";
	var html = store.getRecursiveTiddlerText(title,null,10);
	wrapper.innerHTML = html;
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = document.getElementById("tiddlerDisplay");
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div","tiddlerDisplay");
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	stash.parentNode.removeChild(stash);
}

function refreshDisplay(hint)
{
	var e = document.getElementById("contentWrapper");
	if(typeof hint == "string")
		hint = [hint];
	refreshElements(e,hint);
}

function refreshPageTitle()
{
	document.title = wikifyPlain("SiteTitle") + " - " + wikifyPlain("SiteSubtitle");
}

function refreshStyles(title)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles("StyleSheet");
	refreshStyles("StyleSheetPrint");
}

// ---------------------------------------------------------------------------------
// Options cookie stuff
// ---------------------------------------------------------------------------------

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++)
		{
		var p = cookies[c].indexOf("=");
		if(p != -1)
			{
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			switch(name.substr(0,3))
				{
				case "txt":
					config.options[name] = unescape(value);
					break;
				case "chk":
					config.options[name] = value == "true";
					break;
				}
			}
		}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	switch(name.substr(0,3))
		{
		case "txt":
			c += escape(config.options[name].toString());
			break;
		case "chk":
			c += config.options[name] ? "true" : "false";
			break;
		}
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

// ---------------------------------------------------------------------------------
// Saving
// ---------------------------------------------------------------------------------

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false)
		{
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
		}
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + store.getRecursiveTiddlerText(tiddlerName,"") + "\n");
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:")
		{
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
		}
	var localPath = getLocalPath(originalPath);
	// Load the original file
	var original = loadFile(localPath);
	if(original == null)
		{
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
		}
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([localPath]));
		return;
		}
	// Save the backup
	if(config.options.chkSaveBackups)
		{
		var backupPath = getBackupPath(localPath);
		var backup = saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
		}
	// Save Rss
	if(config.options.chkGenerateAnRssFeed)
		{
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
		}
	// Save empty template
	if(config.options.chkSaveEmptyTemplate)
		{
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posOpeningDiv + startSaveArea.length) + original.substr(posClosingDiv);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
		}
	var save;
	try 
		{
		// Save new file
		var revised = original.substr(0,posOpeningDiv + startSaveArea.length) + "\n" +
					convertUnicodeToUTF8(store.allTiddlersAsHtml()) + "\n" +
					original.substr(posClosingDiv);
		var newSiteTitle = convertUnicodeToUTF8((wikifyPlain("SiteTitle") + " - " + wikifyPlain("SiteSubtitle")).htmlEncode());
		revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
		revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
		revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
		revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
		revised = updateMarkupBlock(revised,"POST-BODY","MarkupPostBody");
		save = saveFile(localPath,revised);
		}
	catch (e) 
		{
		showException(e);
		}
	if(save)
		{
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
		}
	else
		alert(config.messages.mainFailed);
}

function getLocalPath(originalPath)
{
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format assuming
	// "file:///x:/path/path/path..." - pc local file --> "x:\path\path\path..."
	// "file://///server/share/path/path/path..." - FireFox pc network file --> "\\server\share\path\path\path..."
	// "file:///path/path/path..." - mac/unix local file --> "/path/path/path..."
	// "file://server/share/path/path/path..." - pc network file --> "\\server\share\path\path\path..."
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath)
{
	var backSlash = true;
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1)
		{
		dirPathPos = localPath.lastIndexOf("/");
		backSlash = false;
		}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + (backSlash ? "\\" : "/") + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
	return backupPath;
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}


// UTF-8 encoding rules:
// 0x0000 - 0x007F:	0xxxxxxx
// 0x0080 - 0x07FF:	110xxxxx 10xxxxxx
// 0x0800 - 0xFFFF:	1110xxxx 10xxxxxx 10xxxxxx

function convertUTF8ToUnicode(u)
{
	if(window.netscape == undefined)
		return manualConvertUTF8ToUnicode(u);
	else
		return mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length)
		{
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80)
			dst++;
		else if(b1 < 0xE0)
			{
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
			}
		else
			{
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
			}
	}
	return(uni);
}

function mozConvertUTF8ToUnicode(u)
{
	try
		{
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
		}
	catch(e)
		{
		return manualConvertUTF8ToUnicode(u);
		} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return (fin.length > 0) ? s+fin : s;
}

function convertUnicodeToUTF8(s)
{
	if(window.netscape == undefined)
		return manualConvertUnicodeToUTF8(s);
	else
		return mozConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var re = /[^\u0000-\u007F]/g ;
	return s.replace(re, function($0) {return("&#" + $0.charCodeAt(0).toString() + ";");})
}

function mozConvertUnicodeToUTF8(s)
{
	try
		{
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
		}
	catch(e)
		{
		return manualConvertUnicodeToUTF8(s);
		} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function saveFile(fileUrl, content)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = ieSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = javaSaveFile(fileUrl, content);
	return(r);
}

function loadFile(fileUrl)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return(r);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		}
	catch(e)
		{
		//alert("Exception while attempting to save\n\n" + e.toString());
		return(null);
		}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
		}
	catch(e)
		{
		//alert("Exception while attempting to load\n\n" + e.toString());
		return(null);
		}
	return(content);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				file.create(0, 0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file, 0x20 | 0x02, 00004,null);
			out.write(content, content.length);
			out.flush();
			out.close();
			return(true);
			}
		catch(e)
			{
			//alert("Exception while attempting to save\n\n" + e);
			return(false);
			}
	return(null);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				return(null);
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file, 0x01, 00004, null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return(sInputStream.read(sInputStream.available()));
			}
		catch(e)
			{
			//alert("Exception while attempting to load\n\n" + e);
			return(false);
			}
	return(null);
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	if(i > 0)
		return url.substring(i-1);
	return url;
}

function javaSaveFile(filePath, content)
{
	try
		{
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
		}
	catch(e)
		{
		}
	try
		{
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
		}
	catch(e)
		{
		return null;
		}
	return true;
}

function javaLoadFile(filePath)
{
	try
		{
	if(document.applets["TiddlySaver"])
		return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
		}
	catch(e)
		{
		}
	var content = [];
	try
		{
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while ((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
		}
	catch(e)
		{
		return null;
		}
	return content.join("\n");
}


// ---------------------------------------------------------------------------------
// Remote HTTP requests
// ---------------------------------------------------------------------------------

// Load a file over http
//   url - the source url
//   callback - function to call when there's a response
//   params - parameter object that gets passed to the callback for storing it's state
// Return value is the underlying XMLHttpRequest object, or 'null' if there was an error
// Callback function is called like this:
//   callback(status,params,responseText,xhr)
//     status - true if OK, false if error
//     params - the parameter object provided to loadRemoteFile()
//     responseText - the text of the file
//     xhr - the underlying XMLHttpRequest object
function loadRemoteFile(url,callback,params)
{
	// Get an xhr object
	var x;
	try
		{
		x = new XMLHttpRequest(); // Modern
		}
	catch(e)
		{
		try
			{
			x = new ActiveXObject("Msxml2.XMLHTTP"); // IE 6
			}
		catch (e)
			{
			return null;
			}
		}
	// Install callback
	x.onreadystatechange = function()
		{
		if (x.readyState == 4)
			{
			if ((x.status == 0 || x.status == 200) && callback)
				{
				callback(true,params,x.responseText,url,x);
			}
			else
				callback(false,params,null,url,x);
			}
		}
	// Send request
	if(window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	try
		{
		url = url + (url.indexOf("?") < 0 ? "?" : "&") + "nocache=" + Math.random();
		x.open("GET",url,true);
		if (x.overrideMimeType)
			x.overrideMimeType("text/html");
		x.send(null);
		}
	catch (e)
		{
		alert("Error in send " + e);
		return null;
		}
	return x;
}
// ---------------------------------------------------------------------------------
// TiddlyWiki-specific utility functions
// ---------------------------------------------------------------------------------

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId,theAccessKey)
{
	var theButton = document.createElement("a");
	if(theAction)
		{
		theButton.onclick = theAction;
		theButton.setAttribute("href","javascript:;");
		}
	if(theTooltip)
		theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	else
		theButton.className = "button";
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	if(theAccessKey)
		theButton.setAttribute("accessKey",theAccessKey);
	return(theButton);
}

function createTiddlyLink(place,title,includeText,theClass,isStatic)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,theClass)
	var btn;
	if(isStatic)
		btn = createExternalLink(place,"#" + title);
	else
		btn = createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	return(btn);
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler)
		{
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
		}
	else
		{
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title))
			{
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
			}
		else
			{
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
			}
		}
	return {classes: classes.join(" "), subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return(theLink);
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(title)
		{
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		var opening;
		if(toggling && document.getElementById("tiddler" + title))
			story.closeTiddler(title,true,e.shiftKey || e.altKey);
		else
			story.displayTiddler(theTarget,title,null,true,e.shiftKey || e.altKey);
		}
	clearMessage();
	return(false);
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return(theTag);
}

// Event handler for clicking on a tiddler tag
function onClickTag(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag)
		{
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++)
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		var lingo = config.views.wikified.tag;
		if(titles.length > 0)
			{
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++)
				{
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
				}
			}
		else
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(e)
{
	if (!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	var titles = [];
	for(var t=0; t<tagged.length; t++)
		titles.push(tagged[t].title);
	story.displayTiddlers(this,titles);
	return(false);
}

function onClickError(e)
{
	if (!e) var e = window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++)
		{
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		}
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if (text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for (p in src)
		if (!preserveExisting || dst[p] === undefined)
			dst[p] = src[p];
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e, message)
{
	var s = e.description ? e.description : e.toString();
	return message ? "%0:\n%1".format([message, s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e, message)
{
	alert(exceptionText(e, message));
}

// ---------------------------------------------------------------------------------
// Animation engine
// ---------------------------------------------------------------------------------

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0)
		{
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},5);
		}
	this.running += arguments.length;
}

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length)
		{
		var animation = me.animations[a];
		if(animation.tick())
			a++;
		else
			{
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
			}
		}
}

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
}

// ---------------------------------------------------------------------------------
// Cascade animation
// ---------------------------------------------------------------------------------

function Cascade(text,startElement,targetElement,slowly)
{
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	this.elements = [];
	this.startElement = startElement;
	this.startLeft = findPosX(this.startElement);
	this.startTop = findPosY(this.startElement);
	this.startWidth = Math.min(this.startElement.offsetWidth,winWidth);
	this.startHeight = Math.min(this.startElement.offsetHeight,winHeight);
	this.targetElement = targetElement;
	targetElement.style.position = "relative";
	targetElement.style.zIndex = 2;
	this.targetLeft = findPosX(this.targetElement);
	this.targetTop = findPosY(this.targetElement);
	this.targetWidth = Math.min(this.targetElement.offsetWidth,winWidth);
	this.targetHeight = Math.min(this.targetElement.offsetHeight,winHeight);
	this.progress = -1;
	this.steps = slowly ? config.cascadeSlow : config.cascadeFast;
	this.text = text;
	this.tick();
	return this;
}

Cascade.prototype.tick = function()
{
	this.progress++;
	if(this.progress >= this.steps)
		{
		while(this.elements.length > 0)
			this.removeTail();
		this.targetElement.style.position = "static";
		this.targetElement.style.zIndex = "";
		return false;
		}
	else
		{
		if(this.elements.length > 0 && this.progress > config.cascadeDepth)
			this.removeTail();
		if(this.progress < (this.steps - config.cascadeDepth))
			{
			var f = Animator.slowInSlowOut(this.progress/(this.steps - config.cascadeDepth - 1));
			var e = createTiddlyElement(document.body,"div",null,"cascade",this.text);
			e.style.zIndex = 1;
			e.style.left = this.startLeft + (this.targetLeft-this.startLeft) * f + "px";
			e.style.top = this.startTop + (this.targetTop-this.startTop) * f + "px";
			e.style.width = this.startWidth + (this.targetWidth-this.startWidth) * f + "px";
			e.style.height = this.startHeight + (this.targetHeight-this.startHeight) * f + "px";
			e.style.display = "block";
			this.elements.push(e);
			}
		return true;
		}
}

Cascade.prototype.removeTail = function()
{
	var e = this.elements[0];
	e.parentNode.removeChild(e);
	this.elements.shift();
}

// ---------------------------------------------------------------------------------
// Scroller animation
// ---------------------------------------------------------------------------------

function Scroller(targetElement,slowly)
{
	this.targetElement = targetElement;
	this.startScroll = findScrollY();
	this.targetScroll = ensureVisible(targetElement);
	this.progress = 0;
	this.step = slowly ? config.animSlow : config.animFast;
	return this;
}

Scroller.prototype.tick = function()
{
	this.progress += this.step;
	if(this.progress > 1)
		{
		window.scrollTo(0,this.targetScroll);
		return false;
		}
	else
		{
		var f = Animator.slowInSlowOut(this.progress);
		window.scrollTo(0,this.startScroll + (this.targetScroll-this.startScroll) * f);
		return true;
		}
}

// ---------------------------------------------------------------------------------
// Slider animation
// ---------------------------------------------------------------------------------

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,slowly,deleteMode)
{
	this.element = element;
	element.style.display = "block";
	this.deleteMode = deleteMode;
	this.element.style.height = "auto";
	this.realHeight = element.offsetHeight;
	this.opening = opening;
	this.step = slowly ? config.animSlow : config.animFast;
	if(opening)
		{
		this.progress = 0;
		element.style.height = "0px";
		element.style.display = "block";
		}
	else
		{
		this.progress = 1;
		this.step = -this.step;
		}
	element.style.overflow = "hidden";
	return this;
}

Slider.prototype.stop = function()
{
	if(this.opening)
		{
		this.element.style.height = "auto";
		this.element.style.opacity = 1;
		this.element.style.filter = "alpha(opacity:100)";
		}
	else
		{
		switch(this.deleteMode)
			{
			case "none":
				this.element.style.display = "none";
				break;
			case "all":
				this.element.parentNode.removeChild(this.element);
				break;
			case "children":
				removeChildren(this.element);
				break;
			}
		}
}

Slider.prototype.tick = function()
{
	this.progress += this.step;
	if(this.progress < 0 || this.progress > 1)
		{
		this.stop();
		return false;
		}
	else
		{
		var f = Animator.slowInSlowOut(this.progress);
		var h = this.realHeight * f;
		this.element.style.height = h + "px";
		this.element.style.opacity = f;
		this.element.style.filter = "alpha(opacity:" + f * 100 +")";
		return true;
		}
}

// ---------------------------------------------------------------------------------
// Popup menu
// ---------------------------------------------------------------------------------

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root)
{
	Popup.remove();
	var popup = createTiddlyElement(document.body,"ol","popup","popup");
	Popup.stack.push({root: root, popup: popup});
	return popup;
}

Popup.onDocumentClick = function(e)
{
	if (!e) var e = window.event;
	var target = resolveTarget(e);
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
}

Popup.show = function(unused,slowly)
{
	var curr = Popup.stack[Popup.stack.length-1];
	var rootLeft = findPosX(curr.root);
	var rootTop = findPosY(curr.root);
	var rootHeight = curr.root.offsetHeight;
	var popupLeft = rootLeft;
	var popupTop = rootTop + rootHeight;
	var popupWidth = curr.popup.offsetWidth;
	var winWidth = findWindowWidth();
	if(popupLeft + popupWidth > winWidth)
		popupLeft = winWidth - popupWidth;
	curr.popup.style.left = popupLeft + "px";
	curr.popup.style.top = popupTop + "px";
	curr.popup.style.display = "block";
	addClass(curr.root,"highlight");
	if(anim && config.options.chkAnimate)
		anim.startAnimating(new Scroller(curr.popup,slowly));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
}

Popup.remove = function()
{
	if(Popup.stack.length > 0)
		{
		Popup.removeFrom(0);
		}
}

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--)
		{
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		p.popup.parentNode.removeChild(p.popup);
		}
	Popup.stack = Popup.stack.slice(0,from);
}

// ---------------------------------------------------------------------------------
// ListView gadget
// ---------------------------------------------------------------------------------

var ListView = {};

// Create a listview
//   place - where in the DOM tree to insert the listview
//   listObject - array of objects to be included in the listview
//   listTemplate - template for the listview
//   callback - callback for a command being selected
//   className - optional classname for the <table> element
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className ? className : "listView");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++)
		{
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader)
			colType.createHeader(c,columnTemplate,t);
		}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++)
		{
		rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(var c=0; c<listTemplate.rowClasses.length; c++)
			{
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
			}
		rowObject.rowElement = rowObject;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++)
			{
			var c = createTiddlyElement(r,"td");
			var columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			var colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem)
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
			rowObject.colElements[field] = c;
			}
		}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons)
		{
		for(t=0; t<listTemplate.buttons.length; t++)
			{
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
			}
		}
	return table;
}

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e)
		{
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection)
			alert(config.messages.nothingSelected);
		else
			{
			if(this.nodeName.toLowerCase() == "select")
				{
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
				}
			else
				callback(view,name,tiddlers);
			}
		};
}

// Invoke a callback for each selector checkbox in the listview
//   view - <table> element of listView
//   callback(checkboxElement,rowName)
//     where
//       checkboxElement - DOM element of checkbox
//       rowName - name of this row as assigned by the column template
//   result: true if at least one selector was checked
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++)
		{
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox")
			{
			var rn = cb.getAttribute("rowName");
			if(rn)
				{
				callback(cb,rn);
				hadOne = true;
				}
			}
		}
	return hadOne;
}

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				{
				for(var t=0; t<v.length; t++)
					{
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
					}
				}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				{
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
				}
		}
};
// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
// ---------------------------------------------------------------------------------

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
}

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++)
		if(this[i] === item)
			return i;
	return -1;
}}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++)
		if(this[t][field] == value)
			return t;
	return null;
}

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1)
		{
		if(p == -1)
			this.push(value);
		}
	else if(mode == -1)
		{
		if(p != -1)
			this.splice(p,1);
		}
}

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++)
		if (this.indexOf(items[i]) != -1)
			return true;
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for (var i = 0; i<items.length; i++)
		if (this.indexOf(items[i]) == -1)
			return false;
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique != undefined && unique == false)
		this.push(item);
	else
		{
		if(this.indexOf(item) == -1)
			this.push(item);
		}
}

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	if(n < this.length)
		return this.slice(this.length-n);
	else
		return this;
}

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
}

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1)
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	return s.join("");
}

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1])
			{
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
			}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
}

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
}

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
}

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
}

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return(this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;"));
}

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return(this.replace(/&amp;/mg,"&").replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\""));
}

// Parse a space-separated string of name:value parameters where:
//   - the name or the value can be optional (in which case separate defaults are used instead)
//     - in case of ambiguity, a lone word is taken to be a value
//     - if 'cascadeDefaults' is set to true, then the defaults are modified by updated by each specified name or value
//     - name prefixes are not allowed if the 'noNames' parameter is true
//   - if both the name and value are present they must be separated by a colon
//   - the name and the value may both be quoted with single- or double-quotes, double-square brackets
//   - names or values quoted with {{double-curly braces}} are evaluated as a JavaScript expression
//     - as long as the 'allowEval' parameter is true
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p)
		{
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try
				{
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
				}
			catch(e)
				{
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(e);
				}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
		};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames
		? new RegExp(token,"mg")
		: new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match)
			{
			var n = parseToken(match,1);
			if(noNames)
				r.push({name: "", value: n});
			else
				{
				var v = parseToken(match,8);
				if(v == null && defaultName)
					{
					v = n;
					n = defaultName;
					}
				else if(v == null && defaultValue)
					v = defaultValue;
				r.push({name: n, value: v});
				if(cascadeDefaults)
					{
					defaultName = n;
					defaultValue = v;
					}
				}
			}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++)
		{
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
		}
	return r;
}

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
}

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.pushUnique(p[t].value,unique);
	return n;
}

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end) 
{
	var s = this.indexOf(start);
	if(s != -1)
		{
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s, e];
		}
}

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r 
		? this.substring(0,r[0]) + sub + this.substring(r[1])
		: this;
}

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if (r)
		return this.substring(r[0],r[1]);
}


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	if(title.indexOf(" ") == -1)
		return(title);
	else
		return("[[" + title + "]]");
}

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list)
		{
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
		}
	else
		return "";
}

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return(s);
}

String.prototype.startsWith = function(prefix) 
{
	return !prefix || this.substring(0,prefix.length) == prefix;
}

// Returns the first value of the given named parameter.
//#
//# @param params
//#         as returned by parseParams or null/undefined
//# @return [may be null/undefined]
//#
function getParam(params, name, defaultValue) {
	if (!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
//#
//# @param params
//#         as returned by parseParams or null/undefined
//#
function getFlag(params, name, defaultValue) {
	return !!getParam(params, name, defaultValue);
} 
	
// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	return t;
}

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000); 
	return Math.floor(n/7)+1;
}

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
}

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
}

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? "pm" : "am";
}

Date.prototype.daySuffix = function()
{
	var num = this.getDate();
	if (num >= 11 && num <= 13) return "th";
	else if (num.toString().substr(-1)=="1") return "st";
	else if (num.toString().substr(-1)=="2") return "nd";
	else if (num.toString().substr(-1)=="3") return "rd";
	return "th";
}

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2));
}

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2));
}

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return(String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4));
}

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var theDate = new Date(Date.UTC(parseInt(d.substr(0,4),10),
							parseInt(d.substr(4,2),10)-1,
							parseInt(d.substr(6,2),10),
							parseInt(d.substr(8,2),10),
							parseInt(d.substr(10,2),10),0,0));
	return(theDate);
}

// ---------------------------------------------------------------------------------
// Crypto functions and associated conversion routines
// ---------------------------------------------------------------------------------

// Crypto "namespace"
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	var be = Array();
	var len = Math.floor(str.length/4);
	var i, j;
	for(i=0, j=0; i<len; i++, j+=4)
		{
		be[i] = ((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
		}
	while (j<str.length)
		{
		be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
		j++;
		}
	return be;
}

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	var str = "";
	for(var i=0;i<be.length*32;i+=8)
		str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
	return str;
}

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	var hex = "0123456789ABCDEF";
	var str = "";
	for(var i=0;i<be.length*4;i++)
		str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
	return str;
}

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return Crypto.be32sToHex(Crypto.sha1Str(str));
}

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return Crypto.sha1(Crypto.strToBe32s(str),str.length);
}

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	// Add 32-bit integers, wrapping at 32 bits
	//# Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
	add32 = function(a,b)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF);
		var msw = (a>>16)+(b>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Add five 32-bit integers, wrapping at 32 bits
	//# Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
	add32x5 = function(a,b,c,d,e)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
		var msw = (a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Bitwise rotate left a 32-bit integer by 1 bit
	rol32 = function(n)
	{
		return (n>>>31)|(n<<1);
	};

	var len = blen*8;
	// Append padding so length in bits is 448 mod 512
	x[len>>5] |= 0x80 << (24-len%32);
	// Append length
	x[((len+64>>9)<<4)+15] = len;
	var w = Array(80);

	var k1 = 0x5A827999;
	var k2 = 0x6ED9EBA1;
	var k3 = 0x8F1BBCDC;
	var k4 = 0xCA62C1D6;

	var h0 = 0x67452301;
	var h1 = 0xEFCDAB89;
	var h2 = 0x98BADCFE;
	var h3 = 0x10325476;
	var h4 = 0xC3D2E1F0;

	for(var i=0;i<x.length;i+=16)
		{
		var j,t;
		var a = h0;
		var b = h1;
		var c = h2;
		var d = h3;
		var e = h4;
		for(j = 0;j<16;j++)
			{
			w[j] = x[i+j];
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=16;j<20;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=20;j<40;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k2);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=40;j<60;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),(b&c)|(d&(b|c)),w[j],k3);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=60;j<80;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k4);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}

		h0 = add32(h0,a);
		h1 = add32(h1,b);
		h2 = add32(h2,c);
		h3 = add32(h3,d);
		h4 = add32(h4,e);
		}
	return Array(h0,h1,h2,h3,h4);
}

// ---------------------------------------------------------------------------------
// RGB colour object
// ---------------------------------------------------------------------------------

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string")
		{
		if(r.substr(0,1) == "#")
			{
			if(r.length == 7)
				{
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
				}
			else
				{
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
				}
			}
		else
			{
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/ ;
			var c = r.match(rgbPattern);
			if (c)
				{
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
				}
			}
		}
	else
		{
		this.r = r;
		this.g = g;
		this.b = b;
		}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
}

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var r = this.r.clamp(0,1);
	var g = this.g.clamp(0,1);
	var b = this.b.clamp(0,1);
	return("#" + ("0" + Math.floor(r * 255).toString(16)).right(2) +
				 ("0" + Math.floor(g * 255).toString(16)).right(2) +
				 ("0" + Math.floor(b * 255).toString(16)).right(2));
}

// ---------------------------------------------------------------------------------
// DOM utilities - many derived from www.quirksmode.org
// ---------------------------------------------------------------------------------

function drawGradient(place,horiz,colours)
{
	for(var t=0; t<= 100; t+=2)
		{
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var f = t/100;
		var p = f*(colours.length-1);
		bar.style.backgroundColor = colours[Math.floor(p)].mix(colours[Math.ceil(p)],p-Math.floor(p)).toString();
		}
}

function createTiddlyText(theParent,theText)
{
	return theParent.appendChild(document.createTextNode(theText));
}

function createTiddlyCheckbox(theParent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	theParent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,theParent);
	return cb;
}

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return(e);
}

// Add an event handler
// Thanks to John Resig, via QuirksMode
function addEvent(obj,type,fn)
{
	if(obj.attachEvent)
		{
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);}
		obj.attachEvent('on'+type,obj[type+fn]);
		}
	else
		obj.addEventListener(type,fn,false);
}

// Remove  an event handler
// Thanks to John Resig, via QuirksMode
function removeEvent(obj,type,fn)
{
	if(obj.detachEvent)
		{
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
		}
	else
		obj.removeEventListener(type,fn,false);
}

function addClass(e,theClass)
{
	var currClass = e.className.split(" ");
	if(currClass.indexOf(theClass) == -1)
		e.className += " " + theClass;
}

function removeClass(e,theClass)
{
	var currClass = e.className.split(" ");
	var i = currClass.indexOf(theClass);
	while(i != -1)
		{
		currClass.splice(i,1);
		i = currClass.indexOf(theClass);
		}
	e.className = currClass.join(" ");
}

function hasClass(e,theClass)
{
	if(e.className)
		{
		if(e.className.split(" ").indexOf(theClass) != -1)
			return true;
		}
	return false;
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name ? name : "tagName";
	relative = relative ? relative : "parentNode";
	if(name == "className")
		{
		while(e && !hasClass(e,value))
			{
			e = e[relative];
			}
		}
	else
		{
		while(e && e[name] != value)
			{
			e = e[relative];
			}
		}
	return e;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if (e.target)
		obj = e.target;
	else if (e.srcElement)
		obj = e.srcElement;
	if (obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return(obj);
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop)
		return(posTop);
	else if(posBot > winBot)
		{
		if(e.offsetHeight < winHeight)
			return(posTop - (winHeight - e.offsetHeight));
		else
			return(posTop);
		}
	else
		return(winTop);
}

// Get the current width of the display window
function findWindowWidth()
{
	return(window.innerWidth ? window.innerWidth : document.documentElement.clientWidth);
}

// Get the current height of the display window
function findWindowHeight()
{
	return(window.innerHeight ? window.innerHeight : document.documentElement.clientHeight);
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return(window.scrollX ? window.scrollX : document.documentElement.scrollLeft);
}

// Get the current vertical page scroll position
function findScrollY()
{
	return(window.scrollY ? window.scrollY : document.documentElement.scrollTop);
}

function findPosX(obj)
{
	var curleft = 0;
	while (obj.offsetParent)
		{
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
		}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while (obj.offsetParent)
		{
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
		}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e != null && e.focus && e.blur)
		{
		e.focus();
		e.blur();
		}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e.hasChildNodes())
		e.removeChild(e.firstChild);
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id)
{
	if(!id)
		id = "customStyleSheet";
	var n = document.getElementById(id);
	if(document.createStyleSheet) // Test for IE's non-standard createStyleSheet method
		{
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
		}
	else
		{
		if(n)
			n.replaceChild(document.createTextNode(s),n.firstChild);
		else
			{
			var n = document.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(document.createTextNode(s));
			document.getElementsByTagName("head")[0].appendChild(n);
			}
		}
}

// Replace the current selection of a textarea or text input and scroll it into view

function replaceSelection(e,text)
{
	if (e.setSelectionRange)
		{
		var oldpos = e.selectionStart + 1;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionStart);
		e.setSelectionRange( oldpos, oldpos);
		var linecount = e.value.split('\n').length;
		var thisline = e.value.substr(0,e.selectionStart).split('\n').length-1;
		e.scrollTop = Math.floor((thisline-e.rows/2)*e.scrollHeight/linecount);
		}
	else if (document.selection)
		{
		var range = document.selection.createRange();
		if (range.parentElement() == e)
			{
			var isCollapsed = range.text == "";
			range.text = text;
			 if (!isCollapsed)
				{
				range.moveStart('character', -text.length);
				range.select();
				}
			}
		}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = ""; 
	while (e && e.nodeName == "#text")
		{
		t += e.nodeValue;
		e = e.nextSibling;
		}
	return t;
}
//# -------------------------
//# LoaderBase: A (abstract) storage loader that loads the tiddlers from a list of HTML elements.
//# The format of the elements is defined by subclasses of this loader through the internalizeTiddler implementation.
//# Subclasses must implement:
//# 			function getTitle(store, e)
//#
//# store must implement:
//# 			function createTiddler(title).
//#

function LoaderBase()
{
}

LoaderBase.prototype.loadTiddler = function(store,e,tiddlers)
{
	var title = this.getTitle(store, e);
	if (title)
		{
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store, tiddler, title, e);
		tiddlers.push(tiddler);
		}
}

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for (var t = 0; t < nodes.length; t++)
		{
		try
			{
			this.loadTiddler(store, nodes[t], tiddlers);
			}
		catch(e)
			{
			showException(e, config.messages.tiddlerLoadError.format([this.getTitle(store, nodes[t])]));
			}
		}
	return tiddlers;
}
	
//# -------------------------
//# SaverBase: a (abstract) storage saver that externalizes all tiddlers into a string, 
//# with every tiddler individually externalized (using this.externalizeTiddler) and joined with newlines 
//# Subclasses must implement:
//# 			function externalizeTiddler(store, tiddler)
//#
//# store must implement:
//# 			function getTiddlers(sortByFieldName)
//#

function SaverBase()
{
}

SaverBase.prototype.externalize = function(store) 
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for (var t = 0; t < tiddlers.length; t++)
		results.push(this.externalizeTiddler(store, tiddlers[t]));
	return results.join("\n");
}
//--------------------------------
// TW21Loader (inherits from LoaderBase)

function TW21Loader() {};

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store, e) {
	var title = null;
	if(e.getAttribute)
		title = e.getAttribute("tiddler");
	if(!title && e.id) {	
		var lenPrefix = store.idPrefix.length;
		if (e.id.substr(0,lenPrefix) == store.idPrefix)
			title = e.id.substr(lenPrefix);
	}
	return title;
}

TW21Loader.prototype.internalizeTiddler = function(store, tiddler, title, data) {
	var text = getNodeText(data.firstChild).unescapeLineBreaks();
	var modifier = data.getAttribute("modifier");
	var modified = Date.convertFromYYYYMMDDHHMM(data.getAttribute("modified"));
	var c = data.getAttribute("created");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : modified;
	var tags = data.getAttribute("tags");
	var fields = {};
	var attrs = data.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if (attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created, fields);
	return tiddler;
};

//--------------------------------
// TW21Saver (inherits from SaverBase)

function TW21Saver() {};

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store, tiddler) 
{
	try {
		var extendedFieldAttributes = "";
		store.forEachField(tiddler, 
			function(tiddler, fieldName, value) {
				// don't store stuff from the temp namespace
				if (!fieldName.match(/^temp\./))
					extendedFieldAttributes += ' %0="%1"'.format([fieldName, value.escapeLineBreaks().htmlEncode()]);
			}, true);
		return '<div tiddler="%0" modifier="%1" modified="%2" created="%3" tags="%4"%6>%5</div>'.format([
				tiddler.title.htmlEncode(),
				tiddler.modifier.htmlEncode(),
				tiddler.modified.convertToYYYYMMDDHHMM(),
				tiddler.created.convertToYYYYMMDDHHMM(),
				tiddler.getTags().htmlEncode(),
				tiddler.escapeLineBreaks().htmlEncode(),
				extendedFieldAttributes
			]);
	} catch (e) {
		throw exceptionText(e, config.messages.tiddlerSaveError.format([tiddler.title]));
	}
}

// ---------------------------------------------------------------------------------
// Deprecated code
// ---------------------------------------------------------------------------------

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
}

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
		{
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
		}
}

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
}

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
}

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
}

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
}

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,slowly)
{
	story.displayTiddlers(srcElement,titles,template,animate,slowly);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,slowly)
{
	story.displayTiddler(srcElement,title,template,animate,slowly);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");
// ---------------------------------------------------------------------------------
// End of scripts
// ---------------------------------------------------------------------------------
//]]>
</script>
<style type="text/css">

#saveTest {
	display: none;
}

.zoomer {
	display: none;
}

#messageArea {
	display: none;
}

#copyright {
	display: none;
}

.popup {
	position: absolute;
}

#storeArea {
	display: none;
	margin: 4em 10em 3em;
}

#storeArea div {
 padding: 0.5em;
 margin: 1em 0em 0em 0em;
 border-color: #f0f0f0 #606060 #404040 #d0d0d0; 
 border-style: solid; 
 border-width: 2px;
 overflow: auto;
}

#javascriptWarning {
	width: 100%;
	text-align: center;
	font-weight: bold;
	background-color: #dd1100;
	color: #fff;
	padding:1em 0em; 
}

</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
	<script type="text/javascript">
//<![CDATA[
if (useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
	</script>
	<div id="copyright">
	Welcome to TiddlyWiki by Jeremy Ruston, Copyright &copy; 2006 Osmosoft Limited
	</div>
	<noscript>
		<div id="javascriptWarning">This page requires JavaScript to function properly</div>
	</noscript>
	<div id="saveTest"></div>
	<div id="contentWrapper"></div>
	<div id="contentStash"></div>
	<div id="storeArea">
<div tiddler="About This Wiki" modifier="RyanGerry" modified="200708070223" created="200708010226" tags="">This Wiki has been created by RyanGerry and uses [[TiddlyWiki|http://www.tiddlywiki.com/]].  It was originally started as a file that I only used on my local machine.  However, I decided that there is no good reason to keep it private so now it is on the web.  This is not a very cooperative wiki since only I can edit it.  But since I mostly use it as a personal notebook I am willing to sacrifice collaboration for the simplicity of  [[TiddlyWiki|http://www.tiddlywiki.com/]] which is all one file.\n\nI am currently using the Kubric theme created by Clint Checketts which is availabe from http://tiddlythemes.com/#Kubrick .\n\nIf you would like to be collaborative I can be reached at the email address at the result of this Perl one linter:\n\n{{{ perl -e'print join(&quot;&quot;, reverse qw(com . gmail @ gerryster)), &quot;\sn&quot;' }}}\n\n''svn information''\n$Id: index.html 103 2011-01-21 12:44:05Z ryan $</div>
<div tiddler="AdTech NY 2007" modifier="RyanGerry" modified="200711061829" created="200711061722" tags="adtech07">!Tuesday 11 AM Keynote - Nick Brien - Universal McCAn\n!!Intro by one of the AdTech chairs\n* &quot;Unbundling Has Been a Failure&quot;\n* First AdTech was in 1996.\n* Radiohead experiment - offered album for free.  38% payed about $6 and the rest just downloaded it.\n** Total sales: Larger than compbined sales of previous two albums durgin the same time period\n!!Main Keynote\n* Talked about the convergence of media platforms (tv, phone, computer as one)\n* &quot;Media is the ultimate social lubricant.&quot;\n* Agencies were in the business of persuasion.  Now we are in the world of influance.  But the speaker suggested you need to use both.\n\n!Global Perspectives on the Digital Revolution\n* The future is already here it is just unevenly distributed.\n* Cell phone use is expected to be 4 billion in 2010.\n\nAnd, I won't be able to take many more notes than this as adTech is not very laptop freindly.</div>
<div tiddler="An Illustrated History of Failure" modifier="RyanGerry" modified="200807240057" created="200807240056" tags="oscon2008">Paul Fenwick\n* Talked about a 2000 year old Greek device used to calculate the revolutions of the sun and moon\n* There was an idea which software could be made perfect \n* Therac-25 was a cancer machine: was made without hardware interlocks (because the software was perfect) - picked the wrong mode six times in three years\n* Code = Bugs\n* &quot;It's possible to make mistakes so large they invalidate your entire worth as a human being&quot; - Adam Kennedy\n* What if we had a metric to evaluate failure?\n** Did some silly math which multiplied the GDP by average life span and got to 3.1 million USD.  Defined that number as the lifetime failure.\n* Gave a switching example which cost AT&amp;T millions of dollars\n* Ariane 5 - European space agency in 1996 - measured distance in a 64 bit floating point number which was cast to a 16 bit integer.  \n** Turned off all of the exception handling in this code.  \n** They had a test but did not test it before the launch\n** $360 MM cost - almost 12,000 life years\n* Auckland (New Zeland) blackout of 1996\n** Left without power for five weeks.\n** Running 150 MW of load over 110 MW of cables\n** A cable failed and they had bad press so they didn't tell anyone about it\n** Management willpower vs. Physics\n** Cost: 150 MM to the power company; cost to Auckland business: unknown\n* Curse of the sysadmin - hard to get people to listen to you\n** but they are doom sayers\n* Mars Climate Orbiter: 1998\n** Imperial vs. Metric issue.  pound force vs. newtons\n** Testing budget was cut at the end of the project\n* Mars Lander\n** Landing thrusters stopped working\n** Landing gear moving = landing\n** total cost for all projects: 8,300 years\n* came up with deep space two: all it had to do was to hit mars\n** but it missed it's launch date and was stored for a year\n** hit mars but no data came back because the batteries were dead\n* 2003 North East blackouts\n** 50MM people were affected\n** A power company, First Energy was responsible\n** An alarm system failed silently for 27 minutes\n** the hot spare fialed after 13 mins\n** One of the huge lines failed but that was noticed because the alarms were dead\n** Power was rerouted but then one of those cables failed\n** There was an oversight board: MISO\n*** their software had an error before the previous problems happened\n** MISO's software was too inflexable and First Energy's software had a race condition\n** About 6000 lifetimes of cost\n!Lessons\n* Test your code\n** and before launch\n* Test your spec\n* Listen to your sysadmins\n* test for race conditions and think really really hard about them</div>
<div tiddler="AppWorx" modifier="RyanGerry" modified="200711271938" created="200711261609" tags="">!Day 1 Basic\n* external integration is via command line\n* load ballencing\n* runs on Unix and Windows\n* Version 6 uses JDBC drivers to connect to pretty much any DB\n* There is a command line utility called {{{awrun}}} which can be used to edit objects directly.  There is also an Oracle stored procedure called {{{awrun}}} with a similar interface.\n* There is a database browser utility inside the application.  There are also views which give better names to the columns within the real tables.\n* The {{{awprint}}} command line utility inserts a record into the AppWorx database so it is possible to tell appworks about files the program creates.\n* View menu\n** see who is connected\n** send a broadcast message\n* restarting AppWorx will not kill any jobs\n* Lower number priorities have preference.\n* The acronym seen in tables, SO, stands for SQL Opera which was the original name of the product.\n* Staging Jobs allow you to change the parameters on a job just for one iteration.\n* There is a prompt type called modules where you can define the contents of a SQL query to fill in a drop down.\n\n!Day 2 - Advanced\n* {{{awrun}}} is a command line utility which can start ad hoc jobs\n** There is a {{{-iic}}} option where you can insert jobs into a chain.\n*** Example, insert a module into an existing chain (id of 8006.00).  There is a $chain_id environment variable.  Insert the module (job) TEST_MODULE and call it B in the chain.  Make it dependent on module A with a success criteria (S).\n** {{{aw4.awrun}}} is the Oracle stored procedure.\n{{{$ awrun TEST_MODULE -v B -iic 8006.00 -pr &quot;&amp;/A = S&quot;}}}\n* Starting AppWorx.  Java Web start can create a shortcut on your desktop to the cached client.  Run this command {{{javaws -viewer}}} to see all of the cached applications.  You can then right click on AppWorx and have a shortcut created on the desktop.\n* Scripts\n** There are PREFIX commands which are essential pre run hooks at different levels of granularity.  Similarly there are COMPLETION and TROUBLE hooks.  These are not used as much any more as there are more features to AppWorx.\n** The SYSOUT script can be used to redirect output to user defined files.  SYSOUT happens before PREFIX.\n* These need to be located in the $AW_HOME/exec directory.\n* There is a {{{show_status}}} environment variable where you can set statuses yourself.\n* There is a shell which is called {{{appworx}}}.\n** Can't create objects but you can view statuses\n** can be run from the master or a remote client\n** {{{jq}}} shows you the job queue, {{{agents}}}, and {{{queue}}} are other obviously named commands.\n** {{{setvar}}} and {{{getvar}}} are commands which manipulate substitution variables\n* Tables\n** The SO_JOB_HISTORY table contains the history information.\n** {{{AV_JOB_HISTORY}}} is the union between the queue and history table.\n** There are SO_JOB_ACTIVITY.SO_REF1-9 columns in the queue table which can be useful for storing custom values such as the number of records in a job.\n*** Example of setting these: {{{awexe EPD_SO_REF1 var_value=123 so_job_id=x}}}\n* ''Substitution variables are global''\n* Exporing/Importing\n** Saves flat file to $AW_HOME/exports on the master\n** Import by $AW_HOME/imports\n** Need DBA role\n* Debugging\n** There are fancy debugging options which are set using bitwise arithmatic.\n** Can also change the debugging info in {{{awenv.ini}}} which is the main config file.\n* Roles and Security\n** Want to create a maintenance roll if users are not in the DBA group.  If this is not done users will be able to create objects but not see them.</div>
<div tiddler="Applying Maslow's Hierarchy of Needs to Technology" modifier="RyanGerry" modified="200707312254" created="200707252357" tags="">Tom Standage - &quot;The Victorian Internet&quot; - A book on Telegraphy.\n\nMarkets are driven by: Safety, prosperity, and solicitation like Maslow's hierarchy of needs.\n\nUsed examples - Telegraph, radio, internet\n\nSoftware - Don't break, be useful, be pretty\n\nApple focused on interface rather than functionality and won the music player war.\n\nYour product is a careful balance of features functionality and fun.\n\nSilly: http://uselessaccount.com\n\n&quot;does it make me last or help me out?&quot;\n\n\n</div>
<div tiddler="Bash" modifier="RyanGerry" modified="200810021443" created="200810021443" tags="">Creating commands dynamically with while read:\n\n{{{ ls | while read l; do echo ls $l; done | bash }}}</div>
<div tiddler="Beautiful Concurrency with Erlang" modifier="RyanGerry" modified="200807232103" created="200807231840" tags="erlang oscon2008">Kevin Scaldeferri from Yahoo\n* Speaker does not use Erlang\n* Erlang language\n** Interpreted\n** A fusion of Prolog and ML\n** Has concurrency primitives\n** Created by Ericson for telecom applications in 1987\n* Concurrency primitives - spawn, ! (send) and receive\n* Example algorithm 1 - quicksort\n** Stolen from: http://21ccw.blogspot.com/2008/05/parallel-quicksort-in-erlang-part-ii.html\n** made the example parallel by changing map to pmap!  But this is 10x slower than the sequential version :(\n*** the problem is that the algorithm does not do enough in each step to warrant the overhead of the process management\n*** A web spider would make more sense for pmap\n!Distributed Systems\n* Erlang Twitter implementation\n* Each user is an Erlang process and messages map to themselves\n* On commodity hardware can typically run tens of thousands or hundreds of thousands of Erlang processes.\n* Distributing requires using the global module\n** {{{global:register_name(Name, Pid)}}}\n** {{{global:send(Name, Msg)}}}\n* Want a reliable distributed system\n** There is a framework for this called OTP (Open Telecom Platform).  This is not necessarily specific to telecom.\n** OTP uses behaviors which are plugged into\n** His example used the gen_server OTP behavior\n* &quot;Erlang makes adding concurrency to your programs nearly trivial&quot;\n!Setting up a cluster\n* use a shared secret for security\n* distribute a standard configuration so that machines know how to join\n!Resources\n* http://trapexit.org\n* #erlang on freenode\n* Erlang-questions@erlang.org\n* CEAN\n* Web servers\n** [[yaws|http://yaws.hyber.org/]], [[erlyweb|http://erlyweb.org/]] and [[mochiweb|http://code.google.com/p/mochiweb/]]</div>
<div tiddler="Body Hacking" modifier="RyanGerry" modified="200708061213" created="200707262155" tags="oscon2007">Quinn Norton\n\nBody modification defined: Acting on yourself, with or without assistance, to enhance the function of our body or your perceptions.  Enhance is the key word.  &quot;If you can't open it, you don't own it&quot; - Make Magazine.\n\nHumans have more neuroplacticiy than other animals (we can reconfigure our brains).  \n\nBody monitors are coming out.  People want to get their medical data.\n\nI stopped taking notes at this point as I started feeling faint.</div>
<div tiddler="Capistrano" modifier="RyanGerry" modified="200806121937" created="200806121645" tags="">Manual http://manuals.rubyonrails.com/read/chapter/97\n\n* Capistrano 2.0 requires that you have a local id_rsa.pub with the correct public key.  I created an empty id_rsa.pub and got a cryptic error message.</div>
<div tiddler="Care and Feeding of Large Web Applications" modifier="RyanGerry" modified="200708070211" created="200707251844" tags="Perl oscon2007">!CPAN Problem\n\n&quot;Just use the CPAN shell&quot; - bad advice - fails too often and gets the latest versions\nHe put everything in a local directory.  This is nice because different CPAN configurations could installed twice on one machine.  The presenters solution was to write a Perl script build everything (including apache).  Expect was used to answer questions, and tests were not run.  Would have preferred to build binary distributions.  See build system in Krag: http://krangcms.com/ .\n\n!Database Versioning\n\nUsed a rails like model.  [[LVM|http://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)]] for snapshots worked a lot better than vmware.  Vmware took a long time and LVM was a matter of seconds.\n\n!Config\n\nUsed Config;:~ApacheFormat - basic scoping and inheritance\n\nPeople will ignore config option they don't understand.  Things you rarely change shouldn't be in the shipped config file.\n\n!Version Control\n\nA discussion regarding git vs. svn: utsl.gen.nz/talks/git-svn/intro.html\n\nI left this session 10 minutes early as I have already heard much of what he was saying about testing.</div>
<div tiddler="ColorPalette" modifier="RyanGerry" modified="200612042249" created="200612042247" tags="">Background: #fff\nForeground: #000\nPrimaryPale: #8cf\nPrimaryLight: #18f\nPrimaryMid: #04b\nPrimaryDark: #014\nSecondaryPale: #ffc\nSecondaryLight: #fe8\nSecondaryMid: #db4\nSecondaryDark: #841\nTertiaryPale: #eee\nTertiaryLight: #ccc\nTertiaryMid: #999\nTertiaryDark: #666\nError: #f88\n</div>
<div tiddler="DB2" modifier="RyanGerry" modified="200801161731" created="200704111431" tags="">!Starting and Stopping\n\n!Determining the current version\n\ndb2level - I think this is only a client side thing\n\nYou can also see the version when you connect via the command line.\n\n! Nothing table\n\nLike Oracle's dual table DB2 has sysibm.sysdummy1.  To select the current date:\n\n{{{ select current_time from sysibm.sysdummy1 }}}\n\n! Help on Error Messages\n\nIf the error message contains a string like SQL0803N then you can get nice help by doing this from the command line:\n\n{{{ $ db2 &quot;? SQL0803N&quot; }}}\n\nOften times it will include SQL which can be used to track down the human readable column names from the numbers in the error message.</div>
<div tiddler="DBD::Gofer" modifier="RyanGerry" modified="200708070207" created="200707252122" tags="oscon2007 Perl">The idea of DBD::Gofer is to be better than DBD::Proxy.\n\nDBD::Gofer is a scalable and stateless proxy architecture.  Development was sponsored by ShopZilla.\n\n!Classes\nDBI::Gofer::Transport::null - useful for benchmarking and testing.\n\nDBD::Gofer::Transport::stream - ssh - there is also a DB::Gofer::Transport::stream for the other end of the connection..\n\nDBD::Gover::Transport:http - sends requests as http posts.  The server usually runs mod_perl running the DBI::Gofer ::Transport::Http.  Can be used for hiding real DBI connection info.\n\nDBD::Gofer::Transport::gearman - Written by Brad Fitzpatrick.  www.danga.com/gearman.\n\nDBD::Gofer::Policy - defines how many round trips to do.  Cannot manually clear the cache although Tim said he would add that feature after I asked if you could manually clear the cache.\n\n!Caveats\n* no transactions\n* can't use temp tables, locks, and other per-connection persistent state (ShopZilla gets around this by using stored procedures for anything which requires a transaction).\n\n!Examples\nUsing HTTP load balancers and proxies as a database cache with Gofer with a new middle tier.\n\n!Error Handling\nDBD::Gofer can automatically retry on failure.  Can define our own retry behavior.\n\n!Proxy vs. Gofer\nProxy is not well tested, however does support transactions.\n\n!Future\n* http caching - may be easier to implement than memcached\n* JSON - turns DBI into a web service.\n* client caching.  Could work with memcached.\n* could implement transactions with http KeepAlive\n\n!Slides\n\nThe slides from the OSCON presentation are located on CPAN at http://cpan.cs.utah.edu/authors/id/T/TI/TIMB/Gofer-200707.pdf</div>
<div tiddler="DefaultTiddlers" modifier="RyanGerry" modified="201011122315" created="200509061740" tags="systemTiddlers">NFJS2010</div>
<div tiddler="Eclipse" modifier="RyanGerry" modified="200803071850" created="200803062011" tags="java tools">!Pluggins\n* subeclipse for svn\n* myEclipse is a commercial product which manages pluggins like the Tomcat.\n!Meta Data\n.project and .classpath files which can be checked in to svn and work for everyone.\n!Misc. Tips\n* put class files in a different directory when creating a new project\n* if unit tests are put in a different directory, you need to tell eclipse that source code exists in that new directory.  (Project Properties, Java Build Path, Source tab, Add folder)\n* Ctrl + &lt;space&gt; brings up the suggestion dropdown.\n* Quick fixes are helpful\n* If you Ctrl + &lt;space&gt; after starting a method, you get a form that you can tab through to fill in your arguments.\n* Ctrl + F11 = run last launched\n* Shift + Ctrl + T = Show types, Shift + Ctrl + R = find anything\n* There is a VI plugging for eclipse!\n\n* use JDBC Template</div>
<div tiddler="Economics" modifier="RyanGerry" modified="200903031156" created="200902272306" tags="">!Commanding Heights\n* Norilsk - Soviet industrial city which had forced laborers who were political prisoners.\n* Oleg Gordievsky - Soviet double agent - not fatally poisoned in 2007.</div>
<div tiddler="Erlang" modifier="RyanGerry" modified="200807231840" created="200807222247" tags="">[[Practical Erlang Programming]]\n[[Beautiful Concurrency with Erlang]]</div>
<div tiddler="Generating Gorgeous Word Documents, PDFs, and Excel Spreadsheets" modifier="RyanGerry" modified="200707312256" created="200707260104" tags="">Looked at API's for writing word documents and was scared away.\n\nUsed open office format and then generated PDF&quot;s from that.\n\nUsed UNO to convert OpenOffice documents to PDF and Word.  Used S3 for communication with a separate server and was complicated.\n\nS3 has geographic generation.\n\nODFToolkit with make OpenOffice less monolithic.</div>
<div tiddler="ImportTiddlers" modifier="RyanGerry" modified="200708070216" created="200708070216" tags="systemTiddlers">&lt;&lt;importTiddlers&gt;&gt;</div>
<div tiddler="ImportantWords" modifier="RyanGerry" modified="200509290849" created="200509290849" tags="">''[[vestigial|http://dictionary.reference.com/search?q=vestigial]]'' - Software evolves.  In biology, evolution leaves behind vestigial organs.  Vestigial organs, like the appendix, cause problems in biology as well as in software systems.</div>
<div tiddler="Introduction To Python" modifier="RyanGerry" modified="200807211735" created="200807211541" tags="oscon2008 python">* Slides: http://holdenweb.com/files/PythonIntro0821.ppt\n* Both a new Python 2.6 and 3.0 versions were released.\n* Highly recommends &quot;Python in a Nutshell&quot; by Alex Martelli (O'Reilly).\n* Names are not typed but values are.\n* Namespaces\n** each function call has a local namespace\n** each module has a global namespace\n\nI left this talk at the break as the speaker was pretty much sticking to the slides which I already have.</div>
<div tiddler="Introduction to Django" modifier="RyanGerry" modified="200807212053" created="200807212035" tags="">OSCON 2008, Monday 7/21, 2008\n\nCourse notes: http://toys.jacobian.org/presentations/2008/oscon/tutorial/\nThe speaker is a Django core developer.\n\n</div>
<div tiddler="Java" modifier="YourName" modified="200906052221" created="200611282354" tags="java">!SCJP\nI passed the Sun Certified Java Programmer 1.5 exam on 2007-10-22!  Here are the notes I took to help me study.\n\n!Exam Topics\nJavaSyntax\nJavaObjects\nJavaStrings\nJavaIO\nJavaArrays\nJavaExceptions\nJavaDataStructures\nJavaAccessControl\nJavaThreads\nJavaInnerClasses\nJavaGenerics\n\nJavaCertificationTest\n\nMany of the examples in the notes are taken from the book &quot;SCJP Sun Certified Programmer for Java 5 Study Guide.&quot;\n!Other \n[[Eclipse]]\nJavaQuestions</div>
<div tiddler="JavaAccessControl" modifier="RyanGerry" modified="200703282235" created="200612200040" tags="">The levels of access control are (in order of least to most restrictive): public, protected, default, and private.  Protected is like default except that protected methods can be seen outside the package by extending classes.\n\n''All methods in interfaces are implicitly public.''  Because what would be the point of a non public interface?</div>
<div tiddler="JavaArrays" modifier="RyanGerry" modified="200612071404" created="200612061419" tags="java">There are three steps to using an array:\n# declare:  {{{String[] mystrings;}}} \n## It is ''illegal'' for the length of the array to be determined here so ''no'' {{{String[5] ...}}} \n## the location of the [] does not matter much so it could be {{{String mystrings[];}}} but Java people prefer the first way for readability\n## reference: chapter 1 of scjp, page 55\n# construct: {{{String[] mystrings = new String[5]}}}\n## for two dimentional arrays, only the first dimension is initialized at first and other dimensions are optoinal.  {{{int array[][] = new int[3][]}}}  Other dimensions can be different sizes (not a rectangle).\n## reference: chapter 3 of scjp, page 39\n# initialize: {{{Dog[] myDogs = {new Dog(&quot;Clover&quot;), new Dog(&quot;Aiko&quot;)};}}} - shorthand\n## it can also be initialized one at a time\n## multi dimensional shorthand: {{{int[][] scores = {{5,2,4,7}, {9,2}, {3,4}};}}}\n## construction and initialization can be done on one line: {{{args = new String[]{&quot;.&quot;};}}} .\n### These are referred to as //anonymous// arrays.  This is helpful for re-initializing an existing array or passing without declaration to a method.\n### ''notice'' that there is no length passed into the rvalue.  Instead the number of comma separated values in the curlies are counted.\n## reference: chapter 3 of scjp, page 42\n\n''Casting''\n* Array elements are automatically casted like scalars.\n* Primative Array's themselves do not cast, but Object ones do.\n* It is not possible to assign a 2D array to a 1D array.</div>
<div tiddler="JavaCertificationTest" modifier="RyanGerry" modified="200612041318" created="200611291412" tags="">Java practice test, 76 Questions.\n\nHow many questions does the actual test have? 65?\n\nTo review:\n* Thread.join()\n* java -cp and CLASSPATH.  CLASSPATH must contain the directory which has .class files or a \n*.jar file. - See chapter 10 of SCJP\n* Data structure API - 10 of SCJP and Learning Java\n** Generics\n* File IO - try reproducing some Unix programs\n* Two minute exercises\n</div>
<div tiddler="JavaDataStructures" modifier="RyanGerry" modified="200708070212" created="200612131301" tags="java">!Classes\n\nAll the below inherit from java.util.~AbstractCollection .\n\n* List &lt;&lt;interface&gt;&gt;\n** ~ArrayList\n**</div>
<div tiddler="JavaExceptions" modifier="RyanGerry" modified="200710121205" created="200702272338" tags="">* try/catch/finally - each try block must be followed by a catch and finally or both.  The finally block ''always gets executed.''  Even if there is no exception thrown the finally block still gets executed.  The idea here is that the finally block provides a consistent way to cleanup after a try block.\n\n* What is the syntactical difference in the definition of checked an unchecked exceptions?</div>
<div tiddler="JavaGenerics" modifier="RyanGerry" modified="200903051359" created="200903051358" tags="">See chapter 7 of the SCJP book starting on page 584.  &quot;Making Your own generic Class&quot; starts on page 598.</div>
<div tiddler="JavaIO" modifier="RyanGerry" modified="200710091250" created="200611291427" tags="java">Page 19 of chapter 6 of the SJCP book has a good overview of the classes.\n\nWriter classes are for characters and Streams are for data.  The only Stream objectives are for serialization.\n\n!!File IO Class Overview\nThere are a lot of wrapper classes.  The Java IO package implements the Gang of Four decorator pattern.\n\n* ''File'' - File or directory meta data.  Creates, deletes, file and directories; lists directories.\n* ''~FileReader &amp; ~FileWriter'' - OS buffered read and write to files.  Passed a ''File'' object or ''String'' to know where to read and write to.\n* ''~BufferedReader &amp; ~BufferedWriter'' - provides buffering and the readLine and writeLine methods.  Can only be created with a Reader or Writer.\n* ''~PrintWriter'' - provides formatting methods.  Can be instanciated with a File, String, Writer, or ~OutputStream.\n* Page 26 of chapter 6 of the SJCP has at table of the IO classes covered on the exam.\n\n!!Object Serialization\n* Page 85 of chapter of the SJCP has an overview of the serialization classes.\n* {{{transient}}} instance variables are not serialized\n\n!!Dates\n\n!!Regular Expressions\n* the \s in meta characters needs to be escaped which is annoying so &quot;\s\sd&quot; would match one number.\n\n\nLeft off on SJCP  page 33, Serialization.\n</div>
<div tiddler="JavaInnerClasses" modifier="RyanGerry" modified="200710011238" created="200702272315" tags="">!Types\n* regular\n** Decloration\n{{{\nclass MyOuter {\n    class MyInner { }\n}\n}}}\n** Instantiation from outside the outer class, ''must have an instance of the outer class'':\n{{{\npublic static void main(String[] args) {\n    MyOuter.MyInner inner = new MyOuter().new MyInner();\n    inner.seeOuter();\n}\n}}}\n** Referencing the outer instance\n{{{\nclass MyInner {\n    public void seeOuter() {\n        System.out.println(&quot;Outer class ref is &quot; + MyOuter.this);\n    }\n}\n}}}\n* static\n** {{{static className}}} means that the inner class can only access static members of the outer class.\n** The keyword {{{static}}} cannot be applied to normal outer classes.\n** Instantiation outside outer class: {{{BigOuter.Nest n = new BigOuter.Nest();}}}\n* method local\n** can only be instantiated within that method.\n** can not be declared with access modifiers\n** can access the same variables as regular inner classes but only {{{final}}} method variables.  This is because methods use a stack and objects use the heap.  The variables on the stack may go away before the references from the heap.\n* anonymous\n** since you are forced into a specific type, you cannot call methods not defined in that type even if you define the methods in the anonymous class.\n** there is no mechanism for implementing multiple instances anonymously\n** ''declaration requires a closing semi colin {{{};}}}''\n** method argument declaratoins require a semi colin at then end of the method call as usual.\n\nOne of the major motivations of inner classes is to see everything about the outer class including private members.\n\n!Questions\n* Can classes be nested to an arbitrary depth?\n* Does the compiler warn if a member variable of an inner class masks a member variable of the outer class?</div>
<div tiddler="JavaObjects" modifier="RyanGerry" modified="200701182346" created="200701182346" tags="">Constructors do not inherit!  Custom constructors must be explicidly provided in the sub class even if they are identical to the constructors in the super class.  Was this done as an optimization?</div>
<div tiddler="JavaQuestions" modifier="YourName" modified="200906052223" created="200906052219" tags="">* How does one write code to do something with annotations?  java.lang.annotation?</div>
<div tiddler="JavaScript" modifier="RyanGerry" modified="200509070752" created="200509070752" tags="">JavaScriptToLookUp - things to look up\n\nJavaScriptSyntaxNotes</div>
<div tiddler="JavaScriptSyntaxNotes" modifier="RyanGerry" modified="200509191724" created="200509191724" tags="javascript">''Basic Data Types''\n\n''undefined'' is the keyword for Perl's undef.\n\nif(variable != undefined) { do something }\n\n''Boolean''\n\ntrue and false are keywords.\n\n''Complex data structures''\n\nvar config = {\n   // hash of hashes\n   options: {\n      chkRegExpSearch: false,\n      chkCaseSensitiveSearch: false\n   }\n   // hash of arrays\n   notifyTiddlers: [\n     refreshMenu,    refreshStory,\n     refreshTabs\n   ]\n}\n\n// Access an attribute\nvar value = config.options.chkRegExpSearch;\n\n// Assign to an attribute\nconfig.options.chkRegExpSearch = value;</div>
<div tiddler="JavaScriptToLookUp" modifier="RyanGerry" modified="200509070853" created="200509070853" tags="javascript">var e = document.createElement(theElement); - used in this site\n\nHow to get the class or type of an unkown object?  ref() in Perl.  Can't remember operator in Java, perhaps type?  This might be the valueOf method.</div>
<div tiddler="JavaStrings" modifier="RyanGerry" modified="200611291410" created="200611282355" tags="java">Indexes are zero based.\n\n!String Classes\n* ''String'' = points to one literal string in memory (which is immutable).\n** Any operations performed on the string create a NEW string in memory which is returned by the expression.\n** The literals in memory are only stored once per unique string.\n** The string class is final so this memory management behavior cannot be overridden.\n* ''~StringBuffer'' = mutable and thread safe\n* ''~StringBuilder'' = mutable and not thread safe (faster)\n\n!!API Notes\n* when string methods take a beginning and an end, the beginning is 0 based and the end is 1 based\n* .length is an attribute of arrays.  .length() is a method of strings.\n\n|!immutable|!mutator|\n|concat|append|\n</div>
<div tiddler="JavaSyntax" modifier="RyanGerry" modified="200710101209" created="200710101209" tags="">!Loops\n\nEhanced for loop syntax:\n{{{\nint [] a = {1,2,3,4};\nfor(int n : a) // enhanced for loop\n   System.out.print(n);\n}}}</div>
<div tiddler="JavaThreads" modifier="RyanGerry" modified="200703292223" created="200701182314" tags="">!Thread States\n\nStates are defined in the Thread inner class Thread.State which is an Enum.\n\n!!wait, notify, and notifyAll\n* Think of a waiting room analogy.\n* ''must be called from a synchronized context''\n* are all instance methods of Object\n* wait() can throw an InterruptedException like sleep.\n\nImportant paragraph from [[SCJP]] page 728:\n\n&quot;The moral here is that when you use wait() and notify() or notifyAll(),\nyou should almost always also have a while loop around the wait() that checks a\ncondition and forces continued waiting until the condition is met. And you should\nalso make use of the required synchronization for the wait() and notify() calls,\nto also protect whatever other data you're sharing between threads. If you see code\nwhich fails to do this, there's usually something wrong with the code—even if you\nhave a hard time seeing what exactly the problem is.&quot;\n\n!! Sillyness\n* ''Only object can be synchronized.  Primitives may not be synchronized.'' Keep in mind that in a lower level languages like Java (in relation to Perl), primitives are closer to the machine so it would be overhead to include locking semaphores.</div>
<div tiddler="Keeping Your Workers In Line: Use TheSchwartz" modifier="RyanGerry" modified="200711261841" created="200707270018" tags="oscon2007">Ttey use master - master replication with even odd keys.\n\nCurrently comes with one utility: schwartzmon.  Other utilities are available with the Livejournal source.\n\nRunning xinitd on all hosts to control and query services on hosts.\n\nWeb page: http://code.sixapart.com/trac/TheSchwartz</div>
<div tiddler="KubrickSidebar" modifier="YourName" modified="200701122313" created="200701122350" tags="KubrickTheme">!Categories\n&lt;&lt;allTags&gt;&gt;\n!Blog!\n*&lt;&lt;newTiddler&gt;&gt;\n*&lt;&lt;newJournal 'DD MMM YYYY' journal&gt;&gt;\n\n!Meta\n*&lt;&lt;closeAll&gt;&gt;\n*&lt;&lt;permaview&gt;&gt;\n*&lt;&lt;saveChanges&gt;&gt;\n*&lt;&lt;slider chkSliderOptionsPanel OptionsPanel 'options »' 'Change TiddlyWiki advanced options'&gt;&gt;</div>
<div tiddler="Lisp" modifier="RyanGerry" modified="200509050931" created="200509050931" tags="people:eric Lisp">There are many variants of Lisp.  Eric uses [[ACL2|http://www.cs.utexas.edu/users/moore/acl2/]] which is side effect free Lisp.\n\nScheme is anohter populart variant.  Eric recommended the book [[The Little Schemer|http://www.ccs.neu.edu/home/matthias/BTLS/]] to learn the language.  This book is also very popular on Amazon.   The web site also has another free book about Scheme for beginners called [[How to Design Programs|http://www.htdp.org/]].\n\nEmacs has its own version of Lisp.</div>
<div tiddler="MainMenu" modifier="RyanGerry" modified="201011141747" created="200602071449" tags="systemTiddlers">\n!Culture\nImportantWords\n\n!Databases\nMySQL\n[[DB2]]\n[[Oracle]]\n\n!Events\n[[NFJS2010]]\n[[OSCON2008|OSCON 2008 Notes]]\n[[YAPC::NA 2008|YAPC::NA2008 Session Notes]]\n[[OSCON2007]]\n\n!Languages\n[[Bash]]\n[[Erlang]]\n[[Java]]\nJavaScript\n[[Lisp]]\n[[Perl]]\n[[Perl6]]\n[[Python]]\n[[Ruby]]\nSqL\n\n!Methodology\n[[Refactoring]]\n\n!OS's\n[[Unix]]\n\n![[SCM's]]\n[[svn]]\n\n\n!Tools\n[[apt]]\n[[Capistrano]]\n[[Eclipse]]\n[[find]]\nMySQLGUI\n[[netcat]]\n[[irc]]\nProjectManTools\n[[rsync]]\nSeleniumTesting\nTiddlyWikiSyntax\n[[vim]]\nAppWorx\n\n!WebDev\n[[Rails]]\n\n!Reference\n[[Unix2Dos]]\n\n!Applications\n[[MoneyDance]]\n\n--------\n[[Reading]]\n\n--------\n[[Economics]]\n\n&lt;&lt;newTiddler&gt;&gt;\n&lt;&lt;newJournal &quot;DD MMM YYYY&quot;&gt;&gt;\nMainMenu\n\n^^[img[favicon.ico]] TiddlyWiki &lt;&lt;version&gt;&gt;^^</div>
<div tiddler="Making Linux Work on Your Laptop" modifier="RyanGerry" modified="200708032307" created="200707261918" tags="">Suspend resume sucks because ACPI moves the logic from the firmware to the OS.\n\nXRANDR 1.2 - a new project for managing displays and second monitors which X.org 1.3 or higher is required.  The right hardware is from Intel\n\nLaptop hotkeys.\ndmsg (the kernal log) will tell you what the keys are used for.  Setpcodes can be used to reconfigure the keyboard bindings.  There is a Thinkpad ACPI driver.  You can then add scripts to the ACPI deamon to hook into this.  2.6.23 integrates more of these drivers.  i8042 is the standard for mouse and keybard input that is not followed enough.\n\n!Flash readers\n* SDHCI driver manages most SD readers\n* tifm managers most of the rest\n* make sure tifm_sd and mmc_block are loaded\n* Memory stick and XD are not supported.\n\n!Webcams\n* gspca supports a lot of them\n\n!Good plan\n* get a laptops with as little custom hardware as possible (big name vendords are usually better here - not Sony)\n* get a laptop used by as many kernal or distribution developers as possible (better plan)\n* buy from a company like EmporerLinux who builds Linux supported laptops.\nhttp://linux-on-laptops.net\n\nUrbuntu contains a lot of drivers but they may be low quality.\n\nMorale of the story: buy a Mac :(\n\nThe only good non reverse engineered driver WIFI drivers are from Intel.</div>
<div tiddler="Managing Your Manager" modifier="RyanGerry" modified="200708061217" created="200707271829" tags="oscon2007 management">It self defeating to get upset in politics, management, schedules, etc. in your job.\n\nFall into a trap of thinking us vs. them.  All relationships are the same (spouse and manager).\n\nOur common mistake is to assume that managers will be interested in technology for technology sake.\n\nNeuro Linguistic Programming (NLP)- Pacing and Leading.  This has a negative connotation as it can be seen as a way of manipulating people.\n\n!Meta Modle\n* Deletions - something left out - &quot;I'm upset.&quot;\n* Distortions - mind reading or false causality\n* Generalizations - universal qualifiers or modal operators\n* Nominalizations - pretend that an abstract thing is concrete  - &quot;Leadership at our company is weak.&quot;\n* Complex equivalences - connecting two things without rationale\n* Lost performatives - A value judgment that deletes the attribution for the judgment - &quot;It is ...&quot;\n\nRapport is the foundation of successfully communication.  The foundation of rapport is respect.  Look for something that the other person wants that makes sense.  You don't have rapport when you can't see the other person's point of view.  Look for places of agreement before disagreeing with an opinion.\n\nYou can detect visual facial changes on the order of a micron.\n\nBook: &quot;Influencing with Integrity&quot; 0-961372-0-5\n</div>
<div tiddler="MoneyDance" modifier="RyanGerry" modified="200806131248" created="200806130311" tags="moneydance finance">MoneyDanceExportFormat</div>
<div tiddler="MoneyDanceExportFormat" modifier="RyanGerry" modified="200806131249" created="200806130322" tags="moneydance finance perl">The tab delimited format exports the entire file with all accounts.  Unfortunately there is no way to export a single account.  The export file has two lines; one for each side of the transactions.  One of the goofy things is that the export is sorted by the date entered column which is different from the date column which shows up in the app.\n\n!Columns\n* Date - same as the date field in the application\n* Credit/Debit Status - 40 = Uncleared, 30 = Reconciling, 20 = Cleared\n* Credit/Debit Account - numbers can be looked up in the second table of the export.  In my case 1 is checking and 2 is savings.\n\n!How to Get a sorted list of the credits to the checking account currently being reconciled (requires a Unix shell and Perl)\n* export to a file called {{{md_export}}}\n* delete the first two tables\n* {{{$ perl -ne'next if /^[-#]/; @cols=split &quot;\st&quot;; print &quot;$cols[9]\sn&quot; if $cols[5] == 30 &amp;&amp; $cols[6] == 1;' md_export | sort -n}}} \n\n\n</div>
<div tiddler="MySQL" modifier="RyanGerry" modified="200904071455" created="200602071450" tags="">The RESET QUERY CACHE statement removes all query results from the query cache. The FLUSH TABLES statement also does this.\n\n{{{set sql_mode='only_full_group_by'}}} will enforce that columns outside of the group by clause cannot be included in the select column list.  This is helpful as the results of nonsense columns are non-deterministic and can break testing.  [[This article|http://www.oreillynet.com/databases/blog/2007/05/debunking_group_by_myths.html]] has more info.\n\nSubSelects</div>
<div tiddler="MySQLGUI" modifier="RyanGerry" modified="200510191134" created="200510191134" tags="evaluations">''Essential DBMS GUI Feature''\n\n * ''Keystroke'' query execution - Mousing should not be required for executing a free form SQL query.\n * Query ''Save'' - The ability to save certain queries\n * ''Multiple'' Queries - Multiple queries can be run and results viewed at a time\n * ''Active'' Query - Execute the highlighted or query in the clip board\n * ''Blob &amp; Text'' View - See blobs and large text sections in any table view (includes custom queries).\n * Adjustable Character ''Encoding'' - Can switch between Latin1 and UTF8 character sets for query results.\n\n||Keystroke|Save|Multiple|Active|Blob &amp; Text|Price/License|Encoding|Notes|\n|Cocoa MySQL|N|Y|N|N|Y|GPL|Y|Crashes Often|\n|Navicat|Y|Y|Y|N|Y|$95 for 3|Y|Overall Good|\n|YourSQL|Y|N|N|N|N|GPL|?|Not enough features|\n|MySQL Query Browser|Y|Y|Y|N|Y|Open Source|N|Beta only for OSX, crashes often|\n|Aqua Data Studio|Y|Y|Y|?|?|$139 for three|N|encoding is in Latin1 for OSX.  Plans fix this in a later version|</div>
<div tiddler="NFJS2010" modifier="RyanGerry" modified="201011142216" created="201011122123" tags="java confereneces nfjs">NFJS2010ChoosingTechnologies\nNFJS2010NoSql\nNFJS2010DecisionMakingInSoftwareTeams\nNFJS2010DebuggingYourProductionJVM\nNFJS2010MultiParadigmDesigm\nNFJS2010ClassLoaders\nNFJS2010EnterTheGradle\nNFJS2010TDDWithGroovy\nNFJS2010GameProgramming</div>
<div tiddler="NFJS2010ChoosingTechnologies" modifier="YourName" modified="201011122247" created="201011122136" tags="conferences nfjs">Peter Bell\n\nBrought up the value of fun in selecting a technology by referencing two studies: (1) that people are not that much happier after they make more than 75K and (2) building bionicals.\n\nTechnology adoption curve.\n\nCore vs. incidental\n\nSize of the community vs. passion in the community.  Closure vs. php programmers.\n\nEasy way to pick a technology: spike on it.\n\n!Adoption Process\nBook: Driving Technical Change - how to persuade teams to adopt technologies\nBook: Knowing doing gap\n\nWhen talk substitutes for action: death by meetings.\nThe power of precedent because following it is less risky.  Ask why five times; root cause analysis.\nDemming: rooting out fear was the most importing thing in improving an organization.  An organization has to allow for failure.\n\n!Driving Technical Change\n!!The case of characters...\n* the uninformed - be careful how to handle this group because they can turn into the herd.\n* the herd - sub types: newer people and un-passionate people\n** need to take a leadership position to help move the herd\n* the cynic - there is a social benefit to be a cynic.  The presenter referenced a study where people were asked to assess the intelligence of paper reviews.  The negative reviews were almost always seen a smarter.\n* the burned\n* the time crunched - sub types: seasonal and generally busy\n** common anti pattern - we don't have time to do it right be we will do it twice\n* the boss\n* the irrational\n!!Strategies\n* gain expertise\n* deliver your message\n* demonstrate your technique\n* propose compromise\n** types of rules where compromise can be used:\n*** absolute rules\n*** rules without a because\n*** security based rules\n*** industry best practices\n* create trust - don't hide by omission\n* get publicity - ie: validate a technology externally to the organization by open sourcing something.  &quot;You can never be a prophet in your home town.&quot;\n* focus on synergy\n* build a bridge - ie: write an automated test for bugs only for an organization which does not use automated testing.\n* create something compelling - ie. create a shell application with advanced techniques to train an unsophisticated team.\n\nNot only technical debt but also innovation debt within a company.\nTheory of constraints: there is one thing in any system which is the limiting factor.\n\n!Seven secrets of technology selection\n1. know thyself\n2. don't sweat the small stuff\n3. spikes rock\n4. use then sell\n5. demonstrate results\n6. always be adding something\n7. one at a time </div>
<div tiddler="NFJS2010ClassLoaders" modifier="RyanGerry" modified="201011141743" created="201011141513" tags="">{{{java -verbose:class}}} shows all of the classes that are loaded.\n\njavap\n\njdk/jre/lib/ext directory contains jars which are implicitly available to the extensions class loader\n\n!Class Loader Laws\n* Classes are lazy loaded.  *Very* lazy.\n* Every class has an associated class loader  {{{App.class.getClassLoader()}}} or {{{Class.forName(&quot;App&quot;).getClassLoader()}}}\n** The JVM has a bootstrap class loader implemented in native code,\n** The bootstrap loader exists outside of the Java security system.\n* A classloader always delegates to it's parent first.\n* A class's uniqueness is determined by it's package name, class name, *and runtime classloader instance which loaded it*.\n\n!Kinds of dependencies\n* static - must load class B in order to load A.\n* dynamic\n* runtime\n\nThe static initializer block gets called when the class loader *resolves* the class.  Sun split up the class loader in 1.2 into two parts: class loading and class resolving.  This was done to speed up application startup.\n\nThe single argument version of Class.getClassLoader() uses the app class loader.\n\nThe default class loader is the class loader which loaded the current class.\n\n!The context class loader\n{{{Thread.currentThread().getContextClassLoader()}}}\nAllows classes which were loaded by an early class loader to load new classes in the current threads class loader which may be a much deeper class loader child.\n\nJava can't unload classes.\n!First class loaders\n* Native\n** Extentions\n*** App\n\nThe servlet specification breaks the usual class loader model because it states that classes should first be loaded from the WEB* directories.\n\n\n!Making a custom class loader.\nUse java.net.URLClassLoader as it takes care of the \n\n{{{\nURLClassLoader ucl = new URLClassLoader(new URL[] { new File(&quot;./subdir&quot;).toURL() }, oldCL); // Specify it's parent class loader!\nThread.currentThread().setContextClassLoader(ucl);\n// and then revert the contextClassLoader to it's original context\n// URL's are deprecated so there will be a warning.  However, Sun did not provide a URI class loader.\n}}}\n\n*Statics are only statics to classloader boundaries!*\n</div>
<div tiddler="NFJS2010DebuggingYourProductionJVM" modifier="RyanGerry" modified="201012061251" created="201011131925" tags="java nfjs monitoring">Speaker: Ken Sipe http://kensipe.blogspot.com\n\nRoot Set: data structure used for mark and sweep garbage collection.\n* There have been many optimizations in the JVM to make object creation and destruction cheap. Don't try to program around it by creating unnecessary singletons.\n\nWe can allocate memory faster in the JVM than in C in many cases.\n\nPermanent Space: where class information is stored.\n\nGood article on JVM memory management: http://www.ibm.com/developerworks/java/library/j-nativememory-linux/\n\nThere are both major and minor GC's.  A minor GC happens when eden fills up and a major GC happens when old space fills up.\n\nJava 7 is coming out with a new collector called G1 which has four spaces like the CLR,\n\nRan the Java2D demo in the background to show an active process.\n!Tools\n* jps (berkley's ps has a flag to see the entire commandline) available since 1.5 in the bin directory\n** -v = show complete command line\n** -l = show main class\n** jps &lt;remotehost&gt;  === requires jstatd on the remote host\n* jstat - shows real time memory usage.\n** jstat -gcutils 250\n* VisualVM - GUI swiss army knive - already in the jdk (as of 1.6) http://visualvm.dev.java.net .\n** can show deadlocked threads, current threads\n** ThreadContentionMonitoringEnabled - gives more thread detail for a little more overhead.\n* jmap - diff between -histo:live and -histoy to see a diff in the heap.  Heap dumps will have negative impacts on production.\n* visualgc is a plugin for visualvm.\n* jhat - creates a local web server on port 7000 which visualizes the output of jmap\n** nomenclature: [I = an array of integers\n** Execute an Object Query Language (OQL) query.\n* jinfo - change flags within a running VM.  Can also be done via mbeans.\n* jstack - get a dump of threads\n* JTop -.jar in the demo\smanagement\sdirectory to see the top threads\n\n\nHuge dips in major GC's are concerning in nominal conditions.\n\nStateless applications should have a lot of new space.\n* mat (memory analyzer toolkit) http://www.eclipse.org/mat/\n\njava.endorsed.dirs = certificate search directories.\n\nWant larger old spaces on clients or bath processes.\n\n!BTrace: dtrace for Java\n* Like dtrace for Solaris or mac\n* hooks into dtrace\n* Only work in Java 5.\n* A btrace agent lives in all VM's.\n* There is a VisualVM btrace plugin.\n* A class is available by BtraceUtils.\n* There is an unsafe mode witch no rules for modifying existing code.\n* There are JDBC examples in the docs.\n* Can monitor file access.\n\nSetting permsize on JVM startup speeds it up as it does not have to auto detect it.\n\nWily Intrascope is an expensive alternative to btrace.\n\nUse web analytics to determine common use cases of your ap and then tune for that.</div>
<div tiddler="NFJS2010DecisionMakingInSoftwareTeams" modifier="RyanGerry" modified="201011131609" created="201011131533" tags="nfjs">Allister Cockburn looks at software development as a game with three decisions:\n1. Invent\n2. Communicate\n3. Decide\n\n&quot;Developers make critical decisions about every 15 minutes.&quot; - Mary Poppendieck.\n\n!Cognitive Biases\n* Overconfidence - effects us during estimation\n* Sunk Cost - &quot;we've come so far&quot;, &quot;we can't stop now&quot;, &quot;we've put so much into this&quot;\n* Confirmation bias - ignore evidence which does not confirm your model of the world.  Antidote: work on a diverse team.\nBoundedly rational - phrase for human rationality used by behavior economists.\n\nProposals Framing: keep risks and opportunities in mind.\n\nIntuition: can be very valuable but it is hard to communicate.  A trusting team helps this.  Intuition is a way to search through experiences.\n\n!Team decision making\n* Process losses - something that causes us to work as a team less well than we should.  ie. bad meetings\n** Causes\n*** conformity\n*** fault line - aka. tribalism\n*** air time - when one person dominates the conversation.  More difficult for off site team members.\n*** team parasites - need a way for teams to hold individual members accountable\n*** information flow - information needs to flow up in an organization as much as it should flow down\n* Groupthink - symptoms: when nobody argues for a couple of weeks.  When one person has to speak first in team decisions.  Antidote: encourage conflict.  Members of a team need to feel safe for disagreeing with each other.  What happens to nonconformists?\n** tools for allowing nonconformists:\n*** The Red Pencil award - a teacher who rewarded the student with the most mistakes.  However, a student could not get the reward by making the same mistake twice.  This allowed students to take chances.  ie. give out prizes in retrospectives for identifying the best mistake made.\n*** Red Team vs. Blue Team\n*** Devil's advocacy - help expose new information.  Hard to find someone who can do this effectively.\n* Managing conflict\n** cognitive vs. affective debate\n* Inability to commit</div>
<div tiddler="NFJS2010EnterTheGradle" modifier="RyanGerry" modified="201011141747" created="201011141722" tags="">Suggested standardizing on a build system and not an editor or IDE.\n\n!Ant\nPros\n* cross platform\n* powerful\n* control\nCons\n* Verbose\n* haphazard/lack of standards\n\n!Maven\nPros\n* dependency management\n* jars live in a repo\n* convention over configuration\n* plugins\nCons\n* Hard to deal with things which fall outside of the Maven vision\n\n!Gradle\n* Ant + Ivy + Groovy\n* declarative DSL\n\n{{{\ntask hello &lt;&lt; { // without the left shift this becomes configuration instead of addative code\n  println &quot;hello chicago&quot;\n}\n}}}\n</div>
<div tiddler="NFJS2010GameProgramming" modifier="RyanGerry" modified="201011142259" created="201011142258" tags="">Emergence is when games or player imposed rules appear within games.\nJessie Schell: book &quot;The Art of Game Design&quot;\n\n!Core game concepts\n* territorial acquisition\n* prediction\n* spacial reasoning\n* survival\n* destruction\n* building\n* collection\n* chasing/evading\n* trading\n* race to the end\n* goal/pursuit</div>
<div tiddler="NFJS2010MultiParadigmDesigm" modifier="RyanGerry" modified="201011132255" created="201011132255" tags="">C++ had three paradigms: procedural, OO and meta programming via templates.\nJava had one originally: OO.\n\nDifferent paradigms help us manage commonalities and variabilities.  According to James Coplien.\n\nSometimes even procedural paradigms have value.  For example printf over cout in C++.\n\nJava is accidentally multiparadigm.\n\nA lot of design decisions are aesthetics driven.\n\nPositive and negative variability.  Much easier to deal with positive variability.\n\n!Types of paradigms\n* Procedural: commonality are the data structures and the variability are the procedures.\n* OO\n** two dimensions of commonality: behavior and structure\n** interfaces: clean separation of behavior from stucture\n** inheritance\n*** suggested that the Open/Closed Principle is dead because everyone loves the ability to read the source of open source software.\n** strong behavioral subtyping\n* Metaprogramming\n** automatic (code generation) - seen as a code smell; metaprogramming of last resort. ie. xdoclet\n** generics - parametric polymophism\n** reflective - attribute-oriented\n* Dynamic\n** variability becomes names\n* functions separate behavior and structure</div>
<div tiddler="NFJS2010NoSql" modifier="RyanGerry" modified="201011130027" created="201011122308" tags="nfjs databases">!Issues with SQL\n* scaling\n* performance\n* schemas - pain in putting things in a relational schema\n* DBA's :)\n\nNow that we have tools for dealing with larger data sets, we will see a market requirement for this.\n!Four types of NoSQL\n1. Key/Values - ie. Amazon Dynamo.  Want: speed and scale but not complex queries.  Use cases: shopping carts, persistent caches.  Alternatives: Voldemort, Redis, MemcacheDB\n2. Column Based - ie. BigTable.  Gives atomicity across multiple values.  Usually a limited query capability.  Use case: logging.  Useful where column values have varying size.  Implementations: Cassandra, hadoop\n3. Document - generally richer querying and potentially ad hoc querying.  Use cases: powerful queries, eventually consistent, flexible schema.  Possible uses: product catalog, articles/CMS.  Alternatives: CouchDB, SimpleDB, Apache Jackrabbit.\n4. Graph - ie. Neo4j; can be used to support SQL.  Alternatives: AllegroGraph, InfoGrid, FlockDB.\n\n!Examples\n* Riak(key value) - Lucene based query language; map reduce queries.\n* Cassandra(column based) - Facebook's implementation of Bigtable.\n* MongoDB(document) - documents are stored in JSON.  Broken down into collections.  Ad hoc queries - pass a JSON document with the query info.\n\n\nSpringData, Grails are NoSQL abstraction layers.\n\nInsight: when it comes to NoSQL, think polyglot.</div>
<div tiddler="NFJS2010TDDWithGroovy" modifier="RyanGerry" modified="201011142141" created="201011142116" tags="">groovy.util.GroovyTestCase extends JunitTestCase\nGroovy tests can be run as if they had a main method.\n{{{groovy.mock.interceptor.StubFor}}} allows classes to be mocked *but only for Groovy code.*\ncodenarc is a static analysis tool for groovy</div>
<div tiddler="NewTiddler" modifier="YourName" modified="200611132057" created="200611132057" tags="">asdf</div>
<div tiddler="Next Generation Version Control Systems" modifier="RyanGerry" modified="200708061211" created="200707262105" tags="oscon2007 SCM">Centralized version control is always in a star pattern but distributed does not have to do this.\n\nWith distributed version control, the branching happens in the way the code is going - branching is less declarative and more observed.  Illustrated problems with branching and merging with subversion.\n\nThe idea is to treat the repository as a data warehouse.  Goal: find out more information about the code.  Can show all commits which added or deleted a particular string:\ngit -log -S'string'\ngit -annotate -C : follows lines moving between source files\nVisualization tools: gitk, hgk, olive\n\nStable Development Model: this is easier because it is possible to drop bad changes.  This can be done with feature branches but is harder and happens less.\n\n!Tools\n* Bazaar-NG - oldest - python based - slower.  File - based backing which stores inode history.  Generates purely UUIDS.\n* git - CLI, Sports the &quot;Content Hashed Fileysytem&quot; idea stolen from Monotone.  Very popular.  Only looks at content.  History mining toolds are necessity.  Occasionally misses renames when a lot of the content is changed.  Revision ids are checksumed + hisotry.\n* Mercurial (hg) - released right after git.\n\nLightweight branches - work on multiple branches without copying the whole tree.  git supports it the best.  Add ons allow previous changes to be modified.\n\nEase of use: bzr and hg are good and git is very unixy although the newer versions have better docs.\n\nPortability: hg and bzr are portable.  Git is not although there are rewrites and it is available via mingw.\n\nRepository size: bzr = fair, hg is pretty good, git - very tight pack - 10x smaller than svn.\n</div>
<div tiddler="OSCON 2008 Notes" modifier="RyanGerry" modified="200807240024" created="200807211538" tags="oscon2008">!Monday 7/21\n[[Introduction To Python]]\n[[Programming Vim]]\n[[Introduction to Django]]\n!Tuesday 7/22\n[[Secrets of JavaScript Libraries]]\n[[Ubiquitous Multithreading for a Multicore World]]\n[[Practical Erlang Programming]]\n!Wednesday 7/23\n[[OSCON 2008 Opening Keynote]]\n[[OpenJDK]]\n[[Beautiful Concurrency with Erlang]]\n[[Perl 6 Upate|OSCON 2008 Perl 6 Update]]\n[[Web Frameworks of the Future: Flex, GWT, Grail, and Rails]]\n[[An Illustrated History of Failure]]</div>
<div tiddler="OSCON 2008 Opening Keynote" modifier="RyanGerry" modified="200807231746" created="200807231627" tags="oscon2008">!Tim O'Reilly\n* Talked about the dangers of cloud computing and Web 2.0\n** Programming with Collective Intelligence O'Reilly book\n** Web 2.0 presents the problem of data lockin\n* Amee - Carbon calculator from dopplr\n* The browser wars are back on the phone\n* Talked very positivly about Google and Open Source\n* openmoko.com - another open source phone platform\n!Christine Peterson\n* peterson@foresight.org\n* BOF tonight at 8:30\n* Foresight Vision Weekend Nov 15 -16, Silicon Valley\nSecurity and Privacy\n* &quot;The best weapon of a dictatorship is secrecy but the best weapon of a democracy is openness.&quot; from Niel Boars the Physicist.\n* Nanotech\n** Sewer monitoring has begun for horemones.  This could be used to detect drug use.\n* The US Government does not have good tools for WMD detection.  However, they use top down tools like secretive surveillance.\n** Does not work becuase terrorism is a bottom up problem which is being combated with top down tools.\n* No secret software for public sensing data!\n!Dirk Hohndel - Linux for Next Generation Mobile Inernet\n* Chief Linux and Open Source Technologist - Intel Corporation\n* Moblin.org - mobile Intel linux\n* He was pretty boring and was mostly talking about Moblin which has been delayed.\n!Tim O'Reilly's interview with Monty and Brian Aker from MySQL\n* Sun is arguably the first successful Open Source company by taking BSD closed.\n* Adobe is one of the last remaining great closed source companies</div>
<div tiddler="OSCON 2008 Perl 6 Update" modifier="RyanGerry" modified="200807232352" created="200807232059" tags="oscon2008 perl6">!Library Policy\n* Longer module names which require information like version and authority\n{{{Text::Autoformat:&lt; 2.0.1 cpan:DCONWAY&gt;}}}\n* Can load up different versions of the same module in the same program!\n* Modules must specify which version of Perl they will run under correctly\n{{{use Perl:ver(6.0.1 .. 6.1.5);}}}\n** put a star at the end of the range goes to whatever version\n* Later versions of Perl 6 will emulate previous versions of Perl (down to 6.0.0)\n* Operator precedence table was reorganized\n* talked about // (defined or) and orelse operator\n* String increment works on any string.  Looks for the last sequence of word characters and increments it.\n* Five types of variables: my, our (initialized at INIT), has (object member, initialized in instantiation), state, constant\n* Regex changes (I saw this at YAPC::NA 2008)</div>
<div tiddler="OSCON2007" modifier="RyanGerry" modified="200708070208" created="200707251822" tags="oscon2007">!Overview \n\nAll of the OSCON 2007 articles are linked off of this main tiddler.  The tiddlers are all tagged with oscon2007 .\n\n!Schedule\n''NOTE'': the sessions I attended will have a link to another tiddler with my notes from that session.\n\n~Concurrency-Oriented Programming With Erlang\nTrack: BoFs (Birds of a Feather)\nDate: Monday, July 23\nTime: 6:30pm - 7:30pm\nLocation: D135\nModerator: Patrick Logan\nI currently have paper notes for this BoF\n\nOSCON2007Wednesday\n\nOSCON2007Thursday\n\nOSCON2007Friday</div>
<div tiddler="OSCON2007Friday" modifier="RyanGerry" modified="200708011308" created="200708011308" tags="oscon2007">10:45 - 11:30 - [[Managing Your Manager]]\n\nAdventures in Copyright Reform, ZFS: Bringing Terabytes Under Control, Open Source Data … It’s Changing \n\nYour Life\n\nA Lexicon for Open Source\nRobert &quot;r0ml&quot; Lefkowitz, Vice President, Chief Information Architect, and Head of Risk Management \n\nTechnology, Asurion\nTrack: Emerging Topics\nDate: Friday, July 27\nTime: 11:35am - 12:20pm\nLocation: Portland 256 \n\nAlso interesting: Company Can Benefit from Open Sourcing Code</div>
<div tiddler="OSCON2007Thursday" modifier="RyanGerry" modified="200708011307" created="200708011307" tags="oscon2007">\n!Thursday\nOSCON2007ThursdayKeynotes\n\n[[Super-sizing YouTube]]\nMike Solomon, YouTube\nTrack: Python\nDate: Thursday, July 26\nTime: 10:45am - 11:30am\nLocation: Portland 256 \n\nThe lighning talks, wxPerl, dTrace, and Pimp My Build talks also sound interesting.\n\n[[Making Linux Work on Your Laptop]]\nMatthew Garrett\nTrack: Linux\nDate: Thursday, July 26\nTime: 11:35am - 12:20pm\nLocation: D136 \n\nAlso interesting: People Hacks, the GCC talk on automatic parallelism\n\n[[Next Generation Version Control Systems]]\nSam Vilain, Hacker, Catalyst IT (NZ) Ltd\nTrack: Programming\nDate: Thursday, July 26\nTime: 1:45pm - 2:30pm\nLocation: F151 \n\nAlso interesting: Databases Don't Matter\n\n[[Body Hacking]]\nQuinn Norton, Reporter, Wired News\nTrack: Emerging Topics\nDate: Thursday, July 26\nTime: 2:35pm - 3:20pm\nLocation: D133 \n\nAlso interesting: OSGeo: All About Maps, Accessibility for Web 2.0, Dispelling Legal Myths: Things OSS \n\nDevelopers Get Wrong About Law, Python 3000\n\n[[Keeping Your Workers In Line: Use TheSchwartz]]\nBrad Whitaker, Senior Software Engineer, Six Apart\nLisa Phillips, Six Apart\nTrack: Administration\nDate: Thursday, July 26\nTime: 4:30pm - 5:15pm\nLocation: D133 \n\nAlso intersting: Writing Big Apps with Google Web Toolkit, Current State of the Linux Kernel, Perl \n\nLighting Talks, The Absolute Minimum an Open Source Developer Needs to Know About Intellectual Property\n\nFrom Open Source to Open APIs\nJeremy D. Zawodny, Technical Yahoo, Yahoo! Inc.\nTrack: Emerging Topics\nDate: Thursday, July 26\nTime: 5:20pm - 6:05pm\nLocation: E145 \n\nPerl 5 Wikithon\nTime: 7:30PM - 8:30PM\nLocation: E145\nTrack:  BoFs (Birds of a Feather) </div>
<div tiddler="OSCON2007ThursdayKeynotes" modifier="RyanGerry" modified="200707261726" created="200707261605" tags="oscon2007 microsoft">There was an interesting visualization presentation from http://processing.org .  He showed a lot of interesting examples of which I put several on my http://del.icio.us/gerryster .\n\nNext was Robert Hanson who is an economic theorist who spoke about corporate decision making.  Brought up cognitive biases like overestimation of work which can be done on a project.  Book: &quot;The Myth of the Rational Voter&quot; which talks about problems in a Democracy with bias.  Managers of software managers who prefer the ones that underestimate because that manager will work harder to make up for the underestimate.  Betting markets are a good way to overcome bias.\n\nSurprisingly the next keynote was Microsoft - Bill Hilf who was leading their Open Source efforts.  Commented on how he was put between the biases talk and the copyright talk.  Microsoft Permissive Licence is what has been used for the DLR (Dynamic Runtime Language) and other projects.  Port 25, Codeplex, and Chanel9 are Open Source websites.  They have about 588 &quot;Shared Source&quot; projects.  Microsoft is working with the OSI on licensing.  Announced http://www.microsoft.com/opensource/ .  A question was asked about to his ideas on software patents.  He valued intellectual property but felt that the current patent system needs a lot of work.  Overall he was very apologetic for Microsoft.\n\nThe Pirate Party of Sweden by Rick Falkvinge was the next presentation.  The talk was titled Copyright vs. Civil Liberties.  It is illegal to send music in email which violated privacy.  Copyright is lobbying ISP's for monitoring email which violates the common carrier principle in which the postal service is not responsible for content being sent.  One of his major points was that the issue was about privacy and civil liberties and not weather or not file shared helped or hurt media profits.  http://www.piratpartiet.se/donate .\n\nSteve Yetti from Google was next and talked about branding.  Talked about the branding blunder of New Code.  A brand in geek terms is a pointer or a placeholder.  A brand is a proper noun which needs to own a word in a persons mind.  Talked about brands that do mean anything like Kraft.  Book: &quot;22 Immutable Laws of Branding.&quot;  Perl -&gt; scripting, Java -&gt; Enterprise, C++ -&gt; Link Errors.  Nabisco used to be &quot;National Biscuit Company.&quot;  The shocking names work well.  GTE was a really crappy brand which invested a bunch in service and tech and their brand still sucked.  GTE became Verizon because they learned that changing a brand around took a generation.  Mentioned how Eclipse should stick with Java.rather than dilute their brand.  Mentioned how there is not a brand leader in OpenSource licensing.  The biggest problem with OpenSource is the work OpenSource.</div>
<div tiddler="OSCON2007Wednesday" modifier="RyanGerry" modified="200708011307" created="200708011305" tags="oscon2007">10:00 - 11:30\nPerformance-Whack-a-Mole - Josh Berkus - Portland 251\n\n[[Care and Feeding of Large Web Applications]]\nTrack: Perl\nDate: Wednesday, July 25\nTime: 11:35am - 12:20pm\nLocation: Portland 256\n\n* Also interesting *\nBeyond the Padlock: Browser Security UI for the Distracted\nJohnathan Nightingale, Human Shield, Mozilla Corporation\nTrack: Security\nDate: Wednesday, July 25\nTime: 11:35am - 12:20pm\nLocation: D139-140 \n\n[[DBD::Gofer]]: A Stateless DBI Proxy. For SOA and more!\nTim Bunce, CTO, Data Plan Services\nTrack: Perl\nDate: Wednesday, July 25\nTime: 1:45pm - 2:30pm\nLocation: Portland 256 \n\n* Also interesting *\nMozilla Firefox and the Internet as an Open Platform\nMitchell Baker, CEO, Mozilla Corporation\nTrack: Web Applications (client-side and server-side)\nDate: Wednesday, July 25\nTime: 1:45pm - 2:30pm\nLocation: F150 \n\n2:35 - 3:20\n[[Perl 6 Update]] - Portland 256\n\n* Also interesting *\nThe Holistic Programmer\nAdam Keys\nTrack: Programming\nDate: Wednesday, July 25\nTime: 2:35pm - 3:20pm\nLocation: D139-140 \n\n* Also interesting from an environemtnal perspective *\nProgramming for Low Power Usage: It's Everyone's Responsibility\nArjan van de Ven, Intel\nTrack: Linux\nDate: Wednesday, July 25\nTime: 2:35pm - 3:20pm\nLocation: E143-144 \n\nWow, there are a lot of good session from 4:30 to 5:15 PM\n\nPerl 6 on Parrot\nPatrick Michaud, Consultant, pmichaud.com\nTrack: Perl\nDate: Wednesday, July 25\nTime: 4:30pm - 5:15pm\nLocation: Portland 256 \n\n* Also interesting *\n[[Applying Maslow's Hierarchy of Needs to Technology]]\nRolf Skyberg, Disruptive Innovator, eBay, Inc.\nTrack: People\nDate: Wednesday, July 25\nTime: 4:30pm - 5:15pm\nLocation: F151 \n\n* Also intersting - see how Google handles open source projects creatd by them *\nA Year of Open Source at Google\nChris DiBona, Open Source Programs Manager, Google, Inc.\nLeslie Hawthorn, Program Manager - Open Source, Google Inc.\nTrack: Emerging Topics\nDate: Wednesday, July 25\nTime: 4:30pm - 5:15pm\nLocation: F150\n\n* Also interesting - compares &quot;Web 2.0&quot; programming to mobile device programming rather than desktop \n\napplication development *\nHigh-performance JavaScript: Why Everything You’ve Been Taught is Wrong\nJoseph Smarr, Architect, Plaxo, Inc.\nTrack: Web Applications (client-side and server-side)\nDate: Wednesday, July 25\nTime: 4:30pm - 5:15pm\nLocation: D136  \n\n* Also interesting *\nOpenJDK: The First Eight Months\nMark Reinhold, Java SE Chief Engineer, Sun Microsystems\nTrack: Java\nDate: Wednesday, July 25\nTime: 4:30pm - 5:15pm\nLocation: Portland 252\n\n* Looks very good! *\nHigh Performance Web Pages - This talk was in a room that was too small so it filled up before I got in.\nSteve Souders, Yahoo!\nTrack: Web Applications (client-side and server-side)\nDate: Wednesday, July 25\nTime: 5:20pm - 6:05pm\nLocation: D136 \n\n* Also interesting *\n[[Generating Gorgeous Word Documents, PDFs, and Excel Spreadsheets]]\nMichael Koziarski, Software Consultant, Koziarski Software Limited\nTrack: Ruby\nDate: Wednesday, July 25\nTime: 5:20pm - 6:05pm\nLocation: D139-140\n\nGPLv3 for People Who Aren't Lawyers\nTime: 7:30PM - 8:30PM\nLocation: D135\nTrack:  BoFs (Birds of a Feather) \n\nUsing Amazon Webservices EC2/S3/SQS for computing on large data sets\nTime: 7:30PM - 8:30PM\nLocation: F150\nTrack:  BoFs (Birds of a Feather) \n\nFree Software Activism\nTime: 8:30PM - 9:30PM\nLocation: D135\nTrack:  BoFs (Birds of a Feather) \n</div>
<div tiddler="OpenJDK" modifier="RyanGerry" modified="200807231839" created="200807231759" tags="oscon2008 java">http://openjdk.java.net/\n* Speaker was recently hired by Sun and was on the Open Source side prior to that.\n* Timeline\n** 1996 - gcj started and Kaffe begins\n** Feb 1998 first GNU Classpath release\n** Dec 2008 - Eclipse running on GNU Classpath\n** Oct 2003 - GNU Classpath and Kaffe merge\n** Jan 2005 - OpenOffice.org starts using gcj\n** May 2006 - Sun announces Java will be open source\n** Jun 2008 - Fedora OpenJDK 6 built\n** Jul 2008 - Debian OpenJDK 5 built\n* Sun is using Mercurial for SCM for OpenJDK.\n* GNU Classpath and Friends\n** Created because VM's are fun to hack on\n** This is appealing for Java because you can borrow their class library\n** Covers different JVM niches and licencing niches\n* Role of distributions to get software out\n* OpenJDK\n** Released under GPLv2 (_ Classpath exception)\n** gradually replacing gcj as the default tuntime in distributions\n** Glassfish can now be packaged from source\n** Encumbrancies\n** IceTea project was intended to fill these in\n** Encumbrancies are now gone except for SNMP\n* IcedTea\n** Bootstrap OpenJDK using Free Software exclusively\n** Fill in encumbrancies\n** Allows bug fixes to be compiled into OpenJDK without waiting for Sun engineers to recompile\n** AMD 64 bit support\n** Collaboration point for getting OpenJDK into distributions\n* BrandWag is the inverse of OpenJDK for nice backwards compatibility\n* CACAO - small portable JIT, GPL'd  and can use three different class libraries\n* IKVM.net - VM written in C#, runs on top of Mono and .NET\n** cross-complies bytecode into something compatible with .NET\n* SoyLatte is a patchset for Mac based on the BSD porters work\n* there are tons of other OpenJDK projects\n* there is such a difference between OpenJDK and Java from Sun because they released it too late in the release cycle for Java 6 and because of the encumbrances.</div>
<div tiddler="Oracle" modifier="YourName" modified="201004071948" created="200705181707" tags="">! Show Oracle Version\n\n{{{select * from v$version;}}}\n\n! Export DDL\n\nThere is a command line utitliy called {{{ exp }}} which can be told to not export '''rows''' and only generate DDL.  A utility called {{{ imp }}} does a mass create.\n\n! Unicode\n\nSee OracleAndUnicode\n\n!Time Zones\n\nSee OracleTimeZones\n\n! See current locks\n\n{{{select * from v$lock;}}} although I am not sure what the columns mean.\n\n! Other Stuff\n\ntnsnames.ora has the database to host configuration\n\nops/oracle/tsnames.ora\n\nIn prod this file is readable:\n/opt/oracle/product/10.2.0/client1/netowrk/admin/tnsnames.ora\n\nCan createa ~/.tnsnames.ora\n\n! DDL Exploration\n\n!! Show Tables:\n\n{{{ select * from all_tables where owner = 'your schema name' }}}\n\n!! List stored procedures\n\n{{{\nselect * from all_objects\n\nselect * from all_source order by line number\n}}}\n\n! sqplus tricks\n\n/ reruns your query (like !! in unix shells)\n\nInside sqlplus use spool to save output\n\n! sqlplus alternatives\n- PL SQL Developer\n- Toad\n\nLimits\nselect * from table rownum between 2 and 6 (does't work with orderby)\nselect * from (select...order by x) where rownum between 2 and 5\n\nDescribe table\ndesc &lt;tablename&gt;\n\n!switch schemas:\n{{{exec util.switch_schema.reset_schema_synonyms('DSEU');}}}\ncreates synonyms in your user schema.  Only one set of synonyms are saved at a \n\nAn alternative:\n{{{alter session set current_schema = dseu}}}\n\ntime.  Schema changes are not updated automatically.\n\nCan also be explicit:\nselect count(*) from pfx.companydef;\n\nlooks in users tables, then local synonyms, then system synonyms.  Can create \n\ndata integrity problems.\n\nTo run a file with commands:\nsqlplus rgerry@develdb @filename param1 param2 ...\n\nIn filename:\nselect * from all_tables where owner = '&amp;1'\n\nOracleExplainPlans\n\n!Reference\n&quot;Developers Guide Reference Manual&quot; - good ref</div>
<div tiddler="OracleAndUnicode" modifier="RyanGerry" modified="200809092014" created="200809092014" tags="unicode oracle">!Helpful Functions\n\n!! unistr\n\nTakes a hexadecimal code point and return a unicode character.\n\n{{{select unistr('\s20AC') from dual;}}}\n\n!! Dump\n\nTakes a varchar column and some other arguments to see the byte length and actual byes of the string in various bases.  See [[this|http://www.techonthenet.com/oracle/functions/dump.php]] reference page.\n\n! Character Encoding\n\nThis is all determined by the NLS_LANG environment variable.</div>
<div tiddler="OracleExplainPlans" modifier="RyanGerry" modified="200705181718" created="200705181718" tags="">explain plan for &lt;query&gt;\n\nselect * form plan_table\n\nOR \n\nuse a GUI</div>
<div tiddler="OracleTimeZones" modifier="YourName" modified="201004072025" created="201004071953" tags="">* Get the current time stamp: {{{select current_timestamp from dual}}} .\n* There is a notion of the databases timezone {{{SELECT DBTIMEZONE FROM dual}}} which is an offset from UTC.\n* The time zone of the current session can be viewed with: {{{select sessiontimezone from dual}}} .  This can be altered by saying: {{{ALTER SESSION SET time_zone = '-7:00'}}} .\n* Current NLS parameters can be viewed with this query: {{{select * from V$NLS_PARAMETERS}}} .\n* From Unix using sqlplus, the current time zone will automatically be picked up from the setting the {{{$TZ}}} environment variable.\n* Timestamp data types:\n** TIMESTAMP - no timezone information\n** TIMESTAMP WITH TIME ZONE - includes the UTC offset\n** TIMESTAMP WITH LOCAL TIME ZONE - everything is stored in the server's local time zone and converted from the current session's timezone.\n\n!References:\n* [[Alter Session|http://download.oracle.com/docs/cd/B12037_01/server.101/b10759/statements_2012.htm]], Oracle Documentation.\n* [[Datetime Datatypes and Time Zone Support|http://download.oracle.com/docs/cd/B14117_01/server.101/b10749/ch4datetime.htm#i1005943]], Oracle Documentation.  Chapter 4.  Oracle® Database SQL Reference 10g Release 1 (10.1) Part Number B10759-01.</div>
<div tiddler="PageTemplate" modifier="YourName" modified="200701122313" created="200701122350" tags="KubrickTheme">&lt;!--{{{--&gt;\n&lt;div class='header'&gt;\n &lt;div class='titleLine'&gt;\n &lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n &lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n &lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='sidebar'&gt;\n &lt;div id='sidebarSearch' macro='search'&gt;&lt;/div&gt;\n &lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\n &lt;div id='sidebarOptions' refresh='content' tiddler='KubrickSidebar'&gt;&lt;/div&gt;\n &lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='displayArea'&gt;\n &lt;div id='messageArea'&gt;&lt;/div&gt;\n &lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='contentFooter'&gt;&lt;p&gt;TiddlyWiki was created by &lt;a href='http://tiddlywiki.com'&gt;Jeremy Ruston&lt;/a&gt; and TiddlyKubrick was created by &lt;a href='http://checkettsweb.com'&gt;Clint Checketts&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="Performance-Whack-a-Mole" modifier="RyanGerry" modified="200707301310" created="200707251826" tags="oscon2007 database">Speaker is a PostGreSQL core developer who works at sun.\n\nWhen clients say &quot;Our database is slow&quot; they don't know the problem.  Presented an application stack consisting fo the application, middleware, database, OS, hardware.  When any layer has a performance problem the entire system is harmed.  Presented a funnel of the stack where each high level layer maximizes the performance and scalability.  At any given time it is only possible to observe and troubleshoot the &quot;largest&quot; mole - produces a whack a mole effect.\n\n!!OS Tools\ncpu performance and utilization - mpstatus\nMemory utilization - free, vmstat\nIO: iostat\n\nBenchmarks vs. Microbenchmarks: micro tests performance in one area, benchmarks test performance in an overall system\n\nMicrobenchmarks: bonnie++ (OS), DB: pgbench, Wisconsin, TPCB, OSDB/PolePosition\nBenchmarks: DBT Benchmarks, DBT3 (DW), pgUnitTest, EAstress, DIY\n\nLess than 10% of Moles cause 90% of performance degradation.\n\n!!Common Types of Moles:\n\n* IO Mole\n* CPU Mole - actually a good place to be for an OLTP application so long as the performance does not suck.\n* Locking Mole - long running transactions, cursors held too long, pessimistic locking, poor transaction management, buffers are too low\n* Application Mole - app and web servers are completely maxed out - not enough application servers\n\nAuthors blog: http://blogs.ittoolbox.com/database/soup</div>
<div tiddler="Perl" modifier="RyanGerry" modified="200705291503" created="200603081333" tags="perl">PerlDebugger\n\nTemplateToolkit\n\nPerlClosures\n\nRecurseINC\n\nPerl5Bugs\n\nPerl5Exceptions\n\nPerlProfiling\n\nPerlTesting</div>
<div tiddler="Perl 6 Update" modifier="RyanGerry" modified="200707312243" created="200707252134" tags="oscon2007 perl6 perl">Last year 207 patches to the specs, this year 412 patches.\n\nThis talk is only about the language, not implementation.\n\n!New features\n* &quot;Adverbial typing&quot; - namespaces can be more complex to resolve namespace conflicts.\n* inline comments\n* &quot;Unspace&quot; - any whitespace can be escaped with \s\n* No more defaulting to {{{ $_ }}} (the goal is to try to get rid of arbitrary memorization\n** {{{ .=comp }}} (modyifies $_)\n** {{{ .print }}} prints $_\n* min and max are not only list operators but are now infix operators - can be used in {{{ =min }}} and {{{ [min] @value }}}\n* ranges are lazy loaded so you can do things like calculating the squares to infinity {{{ (1..) ** 2 }}}\n* New file test operators\n* a cross meta operator = {{{ X..X }}}\n* Perl 5 {{{ @ARGV }}} == Perl 6 {{{ @*ARGS }}} (globals nolonger pollute the package namespace as they have &lt;sigial&gt;*)\n* main subroutine support.  Argument list is whatever is left in {{{@*ARGS}}}.  CLI is defined as a normal subroutine as named flags come in as named parameters to main.\n** can overload main (called a multi method in Perl 6) to have other usages.\n* * if nothing matches any of the mains, USAGE is called.  If there is no USAGE method it is generated automatically from the mains!  Super cool!\n* Nested postfix control statements\n* {{{ each }}} replaces {{{ grep }}} in most places.  The mnemonic is that you perform the operation on each element of the list.\n* Explicit parallelism - eager and hyper operators\n* STM (software transactional memory)\n{{{\ncontend {\n  maybe { foo() }\n  maybe { bar() }\n  defer { baz() }\n}\n}}}\n* consistent meta syntax \n* Then Larry when on about regular expressions, and parsing which I don't understand.  He mentioned that Perl used NFA's instead of DFA's but I would have to look up what those mean again.\n* Match boundaries - new {{{&lt;(}}} and {{{)&gt;}}}\n* brackets are only valid on the regex side of a substitution\n{{{s[foo] = 'bar'}}}\n* can define fixed length arrays\n* negative indicies no longer count from the end but you can say @array[*-N] - whatever the length is minus N\n* User-defined indicies - pseudo hashes done right.  Backround: pseudo hashes were something added to Perl 5 to make objects use arrays while still preserving hash access to objects.  The idea seemed great as objects using pseudo hashes were 15% faster than objects using regular old hashes.  The problem was that hashes were 15% slower in that version of Perl and previous versions.\n\n! Documentation\n* lists ({{{=item}}} is a lot easier)\n* all of the markup is semantic and not layout\n* can allow certain formatting in verbatim blocks.  For example, {{{ =begin code:allow B }}} would allow for bolded code.\n* can {{{=use}}} modules from POD!\n* new standard format for methods\n</div>
<div tiddler="Perl5Bugs" modifier="RyanGerry" modified="200703132228" created="200611132054" tags="">An eval{}; called in a destructor clears the value of $@ .  Java handles this problem by ignoring exceptions thrown from the destructor, see http://www.janeg.ca/scjp/gc/finalize.html .\n\nThe bad:\nperl -e'eval { my $test = bless {}, &quot;main&quot;;  die &quot;I died&quot; }; print ($@ ? &quot;ok 1 - caught die: $@\sn&quot; : &quot;not ok 1 - no die\sn&quot;); sub DESTROY { eval {}; }'\n\nThe good:\nperl -e'use Error qw(:try); try { my $test = bless {}, &quot;main&quot;; throw Error::Simple(&quot;I died&quot;); } catch Error::Simple with { my $e = shift; print &quot;ok 1 - caught error: $e\sn&quot;; exit; }; print &quot;not ok 1 - no error caught\sn&quot;; sub DESTROY{ try { 1 } }'\n\n\nTODO: query the Perl bug database for DESTROY, destructor, or eval.  Fails in Perl 5.8.5 and 5.8.8.</div>
<div tiddler="Perl5Exceptions" modifier="RyanGerry" modified="200701182349" created="200701182331" tags="perl exceptions">It is nice that Java Exceptions take a java.lang.Throwable in their constructor in addition to a string.  When the top object is printed, the Throwable (the superclass of Exception) passed in is also printed so that it is possible to not only see where the top level object originated from but also to determine what exception caused the outer exception.\n\nThe Javadoc of java.lang.Throwable states:\n\n&quot;A throwable contains a snapshot of the execution stack of its thread at the time it was created. It can also contain a message string that gives more information about the error. Finally, it can contain a cause: another throwable that caused this throwable to get thrown. The cause facility is new in release 1.4. It is also known as the chained exception facility, as the cause can, itself, have a cause, and so on, leading to a &quot;chain&quot; of exceptions, each caused by another.&quot;\n\nAlso Java exceptions provide a getStackTrace methods which provides programmatic access to the call stack.</div>
<div tiddler="Perl6" modifier="RyanGerry" modified="200607291900" created="200607291724" tags="">''Methods can take types:''\n\n{{{\nsub takes_anything(Any $this)\nsub takes_strings(Str $my_string)\n}}}\n\n''New type operator''\n{{{\nif ($this ~~ Hash) # Perl 6\nif (ref $this eq 'HASH') # Perl 5\n}}}\n\n''Modified Ternary Operator''\n{{{ 1 == 2 ?? 'true' ?? 'false'}}}\nThe third Apocalypse explains why.</div>
<div tiddler="PerlClosures" modifier="RyanGerry" modified="200509131008" created="200509131008" tags="perl computer_science">More information can be found in perlfunc\n\nCall closures with the &amp; syntax.  IE:\n\n$var = 1;\nmy $closure = sub { $var + shift };\n&amp;$closure(4);  # returns 5</div>
<div tiddler="PerlDebugger" modifier="YourName" modified="200603011448" created="200603011448" tags="perl">Create a breakpoint wherever:\n\nIn the source code of interest add a:\n$DB::single = 1;\n\nStart up the debugger: \nperl -d program\n\nc throught the program until the break point is found.\n\nh lists common commands.\n\nT is the stacktrace command\n\nperldebtut and perldebug are helpful\n\n''Mod_perl Interactive Debugging''\n\nhttp://perl.apache.org/docs/1.0/guide/debug.html#Interactive_mod_perl_Debugging</div>
<div tiddler="PerlNeedsBetterTools" modifier="RyanGerry" modified="200509141455" created="200509141455" tags="perl vim refactoring">http://www.perl.com/lpt/a/2005/08/25/tools.htm\n\nMentions [[Martin Fowler's alphabetical list of refactorings|http://www.refactoring.com/catalog/]] which defines refactoring operations.\n\nGUI test running - Test::Unit::TestRunner or ''Test::Unit::TkTestRunner''\n\n&quot;Another interesting possibility is the development of new IDEs or adding to existing ones by using Adam Kennedy's PPI module, which provides the ability to parse Perl documents into a reasonable abstract syntax tree and to manipulate the elements and re-compose the document. There is a new Perl  editor project, VIP, that is in the design stages and is intended to be &quot;pluggable&quot; and to have special features to support pair programming.&quot;\n\nMentions Perl vim pluggins</div>
<div tiddler="PerlProfiling" modifier="RyanGerry" modified="200702201719" created="200702201719" tags="">DBI_PROFILE=6/DBI::ProfileDumper perl -d:Profile  script\n\nProduces two files:\n dbi.prof  and prof.out\n\ndbiprof(1) examines dbi.prof and prof.out is human readable.\n\n-d:Profile uses Devel::Profile\nanother profiling module is Devel::DProf\n</div>
<div tiddler="Practical Erlang Programming" modifier="RyanGerry" modified="200807230257" created="200807222106" tags="oscon2008 erlang">Francisco \nThe speaker started with Erland in 1994\n!Misc\n* {{{f().}}} wipes all variable definitions from the shell only\n* Comment character: {{{%}}}\n* atoms are never garbage collected (can cause DoS attacks).  list_to_existing_atom() builtin was created to solve this problem\n* Erlang programs are generally not defensive with data validation of internal functions\n** However, external data is heavily validated\n* There is a &quot;Let it crash&quot; approach because it is so distributed.\n* Testing\n** Quickcheck - auto generates random tests - sounds neat\n** eunit\n** Dializer\n\n!Operators\n* &quot;abc&quot; &quot;dev&quot; = &quot;abcdef&quot;\n* List catination: {{{[1,2,3] ++ [3,4,5] = [1,2,3,4,5,6]}}}\n* List subsets use {{{--}}}\n* {{{|}}} is the cons variable for list operations\n* {{{=:=}}} is exactly equal to.  Includes type information.  {{{1 =:= 1.0.}}} is false\n!Variables\n* Can only be bound once!\n* All types are determined at runtime\n* usually capitalized\n* {{{_}}} is the don't care variable.  It is like assigning to a list with undef in it in Perl.  {{{_}}} does not bind.\n!Complex Data Structures\n* Can be arbitrarily typed in like in Perl\n* Automatically garbage collected\n!Pattern Matching\n* Assignment\n** {{{ {E, E, foo} = {abc, abc, foo} }}}  E = abc and foo = foo\n** {{{ [H|T] = [1,2,3] }}} , H = 1, T = [2,3]\n* Testing\n** {{{ {A,A,B} = {abc, def, 123} }}}  This fails because A was rebound to def.\n** {{{ [A,B,C,D] = [1,2,3] }}} This fails because the list assinging to has more elements than the left hand side\n** {{{ [A,B|C] = [1,2,3,4,5,6,7] }}}  This succeeds because C gets assigned to the rest of the list\n!Functions\n* Pattern matching works with the signature of the function head.\n* functions can have multiple heads which are like signatures\n* The order of function heads matters\n* If a function head fails to match you get a runtime error\n* clauses are serporated by a semi colin and a full stop (.) is put at the end\n* Calling\n** Module:Function(Arg1,Arg2,...ArgN) but the Module part may be optional\n** It is not a convention to use single quotes in modules or function name (except for machine generated code)\n!Modules\n* Stored in file with .erl suffix.  The module name has to be the same as the file name\n* Named with {{{-moudle(name).}}} syntax\n* Functions can be exported with this syntax: {{{-export([Function/Arity, Function/Arity,...]).}}}\n\nI stopped taking as many notes at this point because I installed erlang on my machine.\n\n!If statements\n* else is implemented by putting true in as the last guard\n!Guards\n{{{\nfactorial(N) when N &gt; 0 -&gt;\n   N + factorial(N - 1);\nfactorial(0) -&gt; 1.\n}}}\n* The compiler optimizes this\n!Recursion\n* Has nice support for lists in the function heads\n{{{\nmember(H, [H|_]) -&gt; true;\nmember(H, [_|T]) -&gt; member(H,T);\nmember(_, []) -&gt; false.\n}}}\n* This example is tail recursive which erlang makes sure does not use too much memory.\n!Built in Functions\n* date(), time(), length(List), size(Tuple), atom_to_list(Atom), list_to_tuple(List), integer_to_list(2234), tupel_to_list(Tuple)\n* most are implemented in C\n* Types of bif's : process and port handlin, object access and examination, meta programming, type conversions, ...\n* Use BIF's with care as they sort of go around the scheduler\n* Dynamically execute functions by using apply: apply(Module,Function,[Arguments])\n!Parallel Programming\n* Pid2 = spawn(Module, Function, Args).\n* spawn never fails\n** a process either returns normally or abnormally\n* Message Passing\n* Sent using '''Pid! Msg'''\n** The send call with never failed\n* massage is stored in a process mailbox on the receivers side\n* Receive clauses receive messages\n{{{\nreceive\n  {reset,Board}     -&gt; reset(Board);\n  {shut_down,Board} -&gt; {error,unkown_msg}\nend\n}}}\n** If no messages are there we suspend\n* Erlang simply runs out of memory when mailboxes fill up\n** One solution to this is that asynchronous messages are changed to synchronous ones\n* Messages which are not recognized remain in the mailbox\n* Registered Processes\n{{{\nregister(Alias,Pid)\nAlias ! Message\n}}}\n* {{{flush().}}} is a special function which removes all messages from the shell's inbox\n* can apply a timeout to be executed when no messages have been received in x ammount of time {{{receive after 3000 -&gt; true end.}}}\n!Error Handling\n* link(Pid= spawn(Module,Function,Args)) creates a bidirectional link\n** there is also a swan_link function\n** If a process terminates it will send an exit signal to all of its linked processes which will then exit themselves. {'EXIT', &lt;process_name&gt;, Reason}\n* BIF process_flag(trap_exit, true) will convert exit signals to messages and put them in the mailbox\n** denoted with a double line around the circle when you draw out the process diagram\n* exit(Pid,Rason) - sends an exit signal along with a reason\n** If the reason is kill then the process will exit unconditionally\n</div>
<div tiddler="Programming Vim" modifier="RyanGerry" modified="200807211901" created="200807211741" tags="oscon2008 vim perl">OSCON 2008, Monday 7/21, Damian Conway\n\n* General\n** The string function is to vim as Data::Dumper is to Perl.\n** {{{.}}} is the catination operator\n* Lists\n{{{\nlet list = split(str)\n}}}\n** Many other list-related fuctionas are actually procedures which modify the list in place\n** {{{call insert(list, newval)}}}\n** there area aslo add, remove, and filter procedures\n*** the filter function actually modifies the list in place\n*** {{{v:val}}} is to vim as {{{$_}}} is to Perl\n** sort, reverse, and map also change the list in place\n** fortunately each of these functions return the new list, but keep in mind that each passed in list is modified!\n* Dictionaries\n** uses curley braces to declare\n** accessed using square brackets but give it a string instead of an integer\n** exceptions are thrown if you access a key which is not there unless you use the get function.\n** Can also access with the dot notation\n*** of course this is how vim does records or structs\n{{{\nlet user = {}\nlet user.name = 'Damian'\nlet user.acct = 123456\n\necho user\n}}}\n*** and (surprise surprise) you can assign funtion references to values to have a primitive object\n** pretty much everything is the same as lists\n*** can copy and deepcopy\n*** Operators {{{is}}}: same place in memory, {{{==}}} recursive equals check\n** two dictionaries can be merged with the extends function\n* Functions\n** use the function declarator\n** Example\n{{{\nfunction SaveBackup ()\n    blah blah blah\nendfunction\n}}}\n** scope\n*** start with upper case as built in functions use lower case\n*** you can also prefix the name with s: so that it is scoped to the current script\n*** Declaring with {{{function!}}} overwrites any other function with this name\n** If you don't want the return value you have to use keyword {{{call}}}\n** {{{:.,+9call Function()}}} - calls the function 10 times (one per line)\n** Can also write a function to anticipate being called with a rnage with keyword range.  This populates a:firstline and a:lastline\n** Helpful for the RHS of a mapping\n** when referring to a parameter you need to say a: for argument\n** {{{a:000}}} is to vim as {{{@_}}} is to Perl\n** {{{a:0}}} is the number of parameters which were passed in\n** {{{...}}} in the signature accepts any other arguments\n** can take a reference/pointer to a function using the {{{function()}}} function\n** vim does not have closures\n** the {{{call()}}} function is not the same as the {{{:call}}} keyword\n*** call() invokes a function reference\n*** :call calls a function and discards the results\n*** there are times when you need to say {{{call call(function)}}}, oh my!\n* Regexes\n** just strings\n** as powerful as Perl 5.8 regexes but not as powerful as 5.10\n** Example: {{{imap &lt;TAB&gt; &lt;C-N&gt;}}} which actually tabs in the first column\n{{{\nfunction! TabOrCompletion()\n  let col = col('.') - 1\n  if col=0 || getline('.')[col - 1] !~ '\sk'\n    return &quot;\s&lt;TAB&gt;&quot;\n  else\n    return &quot;\s&lt;C-N&gt;&quot;\n  endif\nendfunction\n\n:inoremap &lt;expr&gt; &lt;TAB&gt; TabOrCompletion()\n}}}\nUse inoremap so it does not call itself recursively.  &lt;expr&gt; evaluates what is returned\n*** Has an XML auto close method\n* Exceptions\n{{{\ntry\n  commands\ncatch /pattern to match expression/\n  hanle excetpion here\nfinal\n  always executed\nendtry\n}}}\n** all builtin exceptions start with Vim\n** v:exception has the exception and v:throwpoint has helpful stuff\n** catch without a pattern catches anything\n** :throw throws an exception (give it a string or a number)\n* Debugging\n** :help debug-scripts\n** More annoying that the Perl builtin debugger\n** invoke {{{:debug call MyFunc()}}}\n** {{{vim -D somefile}}} - used to debug your .vimrc\n** It usually defaults to the file you are editing not the one you are debugging\n** Colon commands: cont, step, next , interrupt and quit\n** breakpoints\n{{{\n:breakadd func MyFunc\n:breakadd func 10 MyFunc 'stop at the 10th line of MyFunc\n:breakadd file 42 ~/.vimrc\n:breaklist 'list all breakpoints\n:breakdel * ' deletes all breakpoints\n}}}\n** Damian wrote a pluggin to create better breaks\n*** He uses this to set breakpoints from within his scripts\n* Autocommands\n** Vim is event driven\n** {{{:autocmd &lt;eventtype&gt; &lt;pattern&gt; &lt;command&gt;}}}\n*** the pattern matches the file's extention\n** list with :autocmd\n** Can set up an autocmd so that when you leave insert mode it runs your pretty printer\n** Example for creating a new file\n{{{\nautocmd BuffNewFile *.pl @r ~/templates/skeleton.pl\nautocmd FufNewFile  *.p[lm] call BuildFileTemplate(&lt;a:newfile&gt;)\n}}}\n** Set a timeout to lock you out automatically\n{{{\nset updatetime=30000\n:autocmd CursorHold * !lock -p\n}}}\n*** autocmd! deletes all autocmd's\n*** {{{autocmd! * *.py}}} removes all .py file auto commands\n** be careful about autocmd duplication\n** augroup can declare grouped autocommands\n* Using embeded languages\n** :perl and the rest of the line is a tiny perl one liner\n*** you can add backslashes to make it not line line\n*** there is a multiline version with herediocs\n{{{\nperl &lt;&lt;END_PERL\n   blah\n   blah\nEND_PERL\n}}}\n*** Can next Perl from Vim from Perl by doing {{{Vim::Eval()}}}\n*** {{{:perldo}}} is a special command which accepts a range\n{{{\n:nmap ;r :,.$perldo $_ = reverse $_&lt;CR&gt;\n}}}\n** Python\n*** :python command and here docs\n*** :pyfile ~/pythong/script.pl - finds the script and executes it\n*** no python do but you can simulate it by putting a range in from of the :python command\n*** The python API is much cleaner but less convenient\n*** Python rebuilds standard out to go to the error message place\n** There are scheme, tcl, and ruby interfaces however they are not as far along as python and perl\n</div>
<div tiddler="ProjectManTools" modifier="RyanGerry" modified="200510191141" created="200510191141" tags="project_management evaluations">''Essential Project Mangement Features''\n\n * Granular Task ''Duration'' - The duration of a task should be as small as one hour.  The smaller the durations of the task, the more accurate the time estimate.\n * Task ''Notes'' - Tasks should have a notes field\s\n * Simple ''Reporting'' - Reports can be run on the project.  Examples would be total man hours for the project, and total incomplete man hours.\n * Cross ''Platform'' - Works on Windows and OSX.\n\n||Duration|Notes|Reporting|Platform|Price/Licence|Comments|\n|MS Project|Y|Y|Y|N|expensive||\n|SharedPlan Pro|N|N|Y|Y|$139|Limited Reporting|\n|GanntProject|N|Y|N|Y|open source|Has Perl support for reading data file.|</div>
<div tiddler="Python" modifier="RyanGerry" modified="200807211638" created="200806131255" tags="">PythonModules\n[[Introduction To Python]]\n\n* Has an interactive shell with a help functions.\n* pydoc is the documentation command.\n* Built in functions have __name__ format.\n* pyhon.org has good documentation\n* Python dictionary is implemented well and is talked about in the book &quot;Beautiful Code.&quot;\n\n!Type System\n* Does not have type coersion unline perl.  Cannot do {{{1 + 'hi'}}} .\n** You would cast like this {{{str(1) + 'hi'}}} or {{{'h1' * 3}}}\n** {{{type()}}} function provides types.\n** Types can change with assignment.\n* {{{dir()}}} function when passed an object will display all methods on that object.\n* everything is an object\n* Basic types: integers, floats, bools (True, False), strings, none (null)\n\n!Operators\n* is - identity\n* == - an object's values are equal but they live in two different places in memory\n\n!Strings\n* immutable like in Java\n* how to get substrings\n{{{\na = 'hello'\na[0] = 'h'\na[1:3] = 'el'\na[1:] = 'ello'\na[:] makes a copy\n}}}\n* Cannot assign with the above syntax because they are not mutable.\n* There is a printf function\n{{{ '%d doughnuts, %s' % (3, 'please')}}\n'3 doughnuts, please'\n\n!Comments\n* Multi line, {{{'''\sn\sn'''}}} - can be other characters but they have to match\n* inline: #\n\n!Lists and iteration\n* zero based\n* Arbitrarily nestable\n* {{{l = [1, 2, 3, 4]}}}\n* iteration\n{{{\nfor x in list:\n  print x\n}}}\n* x maintains its scope outside of the loop holding the last value.\n* {{{if 3 in list: print blah}}}\n** returns true if three is in the list\n* {{{l = range(100)}}} - returns a list of 0 - 99 .  xrange is more efficient.\n* List Comprehensions\n** {{{ [str{x) for x in l if 0 ==x % 2] - returns the list of evens as strings - like grep in Perl\n*** the if and str() are completely optional\n** there are dictionary comprehensions\n\n!Dictionaries\n* Like hashes in Perl\n* {{{ d = {} }}}\n* type = dict\n* {{{ d = {'1':1, '2': 'two', 3: ['hi', 'there']} }}}\n* retrieval: {{{ d['1'] }}}\n* functions keys, values, items are like what you would expect.\n{{{\nfor k,v in d.values():\n  print k, v # comma sticks a space between them\n}}}\n\n!Tuples\n* immutable lists\n* More commonly use as structs.\n* Declaration: {{{t = (1, 2, 3, 4)}}}\n* Use usually list retrieval and slices\n\n!Functions\n{{{\ndef Say(s):\n  print s\n}}}\n* type checking for functions is not usually done\n* Keyword arguments:\n{{{def Say(s, times=1)\n  print s * times}}}\n** must be after positional arguments\n* you have to put something in a block so you use pass (reserved word) as a no op\n* Recommended using {{{sorted}}}\n** don't have to use custom comparators.\n** key argument allows a passed in a function, you can do it inline with lambda\n*** {{{ sortedl, key=lambda x: x.lower())}}}\n\n!Misc\n* if __name__ == '__main__': main() - like Perl it executes statements in the file.  This is like the main namespace.\n* You can see what file on disk was used to declare pretty much everything.\n* else if is elif</div>
<div tiddler="PythonModules" modifier="RyanGerry" modified="200806132042" created="200806132042" tags="">* import is the keyword for using modules\n* Python stores the interpreted bytecode in .pyc files.  There are also .pyo files for opimized bytecode.\n* {{{from x.y import aa }}} will put aa in your namespace\n* Directory structure creates namespaces which are seporated by spaces with '.'\n\n!Classes\n{{{\nclass Foo(object): # object is the root of the inheritance hierarchy\n  def __init__(self, arg, kwarg=None): # constructor\n    self.arg = arg\n    self.kwarg = kwarg\n  def Say(self):\n    print self.arg\n}}}\n* &quot;We are all adults here.&quot; - there is no support for public, vs, private, protected.  Convention is public variables declared as normal, protected has a leading underscore, private has two leading underscores.\n* Allows for multiple inheritance\n* No interfaces\n* Inheritance example:\n{{{\nclass Bar(Foo):\n  def Say(self):\n    print self.kwarg\n}}}</div>
<div tiddler="Rails" modifier="RyanGerry" modified="201012021755" created="200509300731" tags="ruby rails">Documentation for all installed ruby gems can be found by starting 'gem_server' from the command line and then going to: http://localhost:8808/\n\nMore documentation is available in /usr/local/lib/ruby/gems/1.8/doc.  For example, here is [[actionpack|file:///usr/local/lib/ruby/gems/1.8/doc/actionpack-1.9.1/rdoc/index.html]].\n\nSee [[Ruby]] for Ruby language documentation.\n\n!2010-08 Notes\n\n{{{ruby script/generate --help}}}\n **metal - bare metal code minus ORM and view overhead.  Used by Sinatra.\n **observer - message passing and the like\n\n!Vim Rails plugin\n{{{\ngit clone git://github.com/tpope/vim-rails.git\ncd vim-rails/\nrake install\n\nIn VIM:\n:helptags ~/.vim/doc\n}}}</div>
<div tiddler="Reading" modifier="RyanGerry" modified="200509061742" created="200509061742" tags="">''Sept 2005''\nPerlNeedsBetterTools</div>
<div tiddler="RecurseINC" modifier="RyanGerry" modified="200705291503" created="200603081335" tags="perl OO">This script will recurse through INC of the package passed in:\n\n/*{{{*/\n#!/usr/bin/perl\n\n# recurse through ISA to generate the inheritance hierarchy of a class\n\neval &quot;require $ARGV[0]&quot; or die &quot;Cannot find package $ARGV[0]&quot;;\nisa($ARGV[0],0);\n\nsub isa {\n  my ($class, $depth) = @_;\n  print &quot;\st&quot; x $depth, &quot;$class\sn&quot;;\n  my @classes = eval &quot;\s@${class}::ISA&quot;;\n\n  return unless @classes;  # exit out of recursion\n\n  map { isa($_, $depth + 1) } @classes;\n}\n/*}}}*/</div>
<div tiddler="Refactoring" modifier="RyanGerry" modified="200509290851" created="200509290851" tags="">From [[wikipedia|http://en.wikipedia.org/wiki/Refactoring]]</div>
<div tiddler="Ruby" modifier="RyanGerry" modified="201012021442" created="200510071812" tags="ruby">[[Off line documentation|file:///Users/ryan/doc/ruby-doc-bundle/index.html]]\n\n!Command Line Documentation\n{{{ri}}}\n\nSee also, [[Rails]].</div>
<div tiddler="Ryan" modifier="YourName" modified="200607291737" created="200607291737" tags="">Ryan</div>
<div tiddler="RyanGerry" modifier="RyanGerry" modified="200707301633" created="200707301633" tags="">That is me!</div>
<div tiddler="SCJP" modifier="RyanGerry" modified="200702282329" created="200702282329" tags="book">Sun Certified Java Programmer</div>
<div tiddler="SCM's" modifier="RyanGerry" modified="200705231706" created="200705231706" tags="">Other &quot;next generation&quot; SCM's bzr/git/hg/darcs</div>
<div tiddler="ScalarSubSelects" modifier="RyanGerry" modified="200508300810" created="200508300810" tags="sql">[[Scalar Sub Selects|file:///Users/ryan/manual-split/manual_SQL_Syntax.html#Scalar_subqueries]] can be used anywhere a column or scalar value is used in a query.  One helpful application is to use a table's count in every row of a query result.  For exmpale, if a query calculated an aggregated occurance of a condition say in a group by, this total could be divided by all elements in the table to calculate the percentage of the occurance.\n\nExample:\n\nSELECT count(*) as total, total / (SELECT count(*) FROM t1) * 100 as percentage\nFROM t1\nGROUP by some_colum\nWHERE another_column = 'some condition'</div>
<div tiddler="Secrets of JavaScript Libraries" modifier="RyanGerry" modified="200807221641" created="200807221641" tags="oscon2008">!Misc\n* Yahoo has a grade sheet of supported browsers\n!Browser Bug Fixes\n* Don't assume that the browser always has the bug\n* A remedy to this problem is Feature Simulation\n** more advanced than object detection\n** basically write code to simulate the bug\n** An alternative to browser detection</div>
<div tiddler="SeleniumTesting" modifier="RyanGerry" modified="200511151405" created="200511151405" tags="">''Features Selenium Needs''\n\n * the ability to compare abitrary xpath results like assertEquals(count(//a[text() = 'edit'), 3)</div>
<div tiddler="SiteSubtitle" modifier="RyanGerry" modified="200708010224" created="200508300756" tags="systemTiddlers">my notebook for all things computer and internet\n[[About This Wiki]]</div>
<div tiddler="SiteTitle" modifier="RyanGerry" modified="200708070222" created="200508300756" tags="systemTiddlers">Ryan's Wiki</div>
<div tiddler="SqL" modifier="RyanGerry" modified="200510201220" created="200510201220" tags="sql">SubSelects\n\nSqlJoins</div>
<div tiddler="SqlJoins" modifier="RyanGerry" modified="200510201259" created="200510201259" tags="">AFIK, there are only three types of joins:\n\n1) ''INNER JOIN'' - returns all rows from both tables where there is a match\n2) ''LEFT JOIN'' - returns all the rows from the first table (the first one since English and SQL are written left to right), even if there are no matches in the second table.\n3) ''RIGHT JOIN'' - returns all the rows from the second table, even if there are no matches in the first table.\n\nIt is possible to write ''[LEFT|RIGHT] OUTER JOIN''.  This is the same as [LEFT|RIGHT] JOIN.  The OUTER is provided as syntactic sugur to differentiate it from an INNER JOIN.  This is confusing because there is no such thing as a [LEFT|RIGHT] INNER JOIN.\n\nMore information is available at http://www.w3schools.com/sql/sql_join.asp .\n\n[[MySQL JOIN Syntax|http://dev.mysql.com/doc/refman/5.0/en/join.html]]</div>
<div tiddler="StyleSheet" modifier="YourName" modified="200701122313" created="200701122350" tags="KubrickTheme">/***\nhttp://tiddlystyles.com/#theme:Kubrick\n\n!General Rules\n***/\n/*{{{*/\na,\n.button{\n color: #06c;\n text-decoration: none;\n background: transparent;\n}\n\na:hover,\n.button:hover{\n background: transparent;\n text-decoration: underline;\n color: #147;\n}\n\nbody {\n font-size: 62.5%; /* Resets 1em to 10px */\n font-family: 'Lucida Grande', Verdana, Arial, Sans-Serif;\n background-color: #d5d6d7;\n color: #666;\n background: #e7e7e7;\n margin: 0 auto;\n}\n\n#contentWrapper{\n background: transparent url(&quot;kubrickbg.jpg&quot;) repeat-y 0px 0px;\n border: 0;\n margin: 0 auto;\n width: 760px;\n}\n\n/*}}}*/\n/***\n!Header Rules\n***/\n/*{{{*/\n.titleLine{\n margin: 80px auto 0em;\n padding: 0;\n width: 745px;\n text-align: center;\n color: #fff;\n}\n\n.siteTitle{\n font-weight: bold;\n}\n\n.siteTitle a, .siteSubtitle a{\n color: #fff;\n}\n\n.siteTitle a:hover, .siteSubtitle a:hover{\n text-decoration: underline;\n}\n\n.siteSubtitle{\n display: block;\n margin: .5em auto 1em;\n}\n\n.header {\n background: url(&quot;kubrickheader.jpg&quot;) no-repeat bottom center; \n margin: 0;\n padding: 1px;\n height: 198px;\n width: 758px;\n\n}\n/*}}}*/\n/***\n!Footer Styles\n***/\n/*{{{*/\n#contentFooter {\n text-align: center;\n clear: both;\n background: url(&quot;kubrickfooter.jpg&quot;) no-repeat bottom;\n border: none;\n padding: 2em;\n height: 3em;\n}\n/*}}}*/\n\n\n/***\n!Sidebar styles /% ============================================== %/\n***/\n/*{{{*/\n#sidebar{\n margin: 1em 2em 0 0;\n position: static;\n float: right;\n}\n\n#sidebar a,\n#sidebar a:hover{\n border: 0;\n}\n\n#sidebar h1{\n font-size: 1.4em;\n font-weight: bold;\n margin: 0;\n background: transparent;\n color: #000;\n}\n\n#sidebar ul{\n padding: 0;\n margin: 0 0 0 1em;\n}\n\n#sidebar li{\n list-style: none;\n}\n\n#sidebar li:before{\n color: #000;\n content: &quot;\s00BB \s0020&quot;;\n}\n\n#sidebar, #mainMenu, #sideBarOptions{\n width: 200px;\n text-align: left;\n}\n\n#mainMenu{\n position: static;\n}\n/*}}}*/\n/***\n!Sidebar search styles /% ======================================== %/\n***/\n/*{{{*/\n#sidebarSearch{\n margin: 0 0 0 10px;\n width: 145px;\n}\n\n#sidebarSearch input{\n font-size: .9em;\n width: 100px;\n}\n\n#sidebarSearch .button{\n float: right;\n margin-top: 1px;\n}\n/*}}}*/\n/***\n!Sidebar option styles\n***/\n/*{{{*/\n#sidebarOptions{\n margin-left: .75em;\n}\n\n#sidebarOptions h1{\n font-size: 1.3em;\n}\n\n#sidebarOptions a{\n display: inline;\n border: 0;\n}\n\n#sidebarOptions .sliderPanel{\n background-color: transparent;\n font-size: 1em;\n margin: 0;\n}\n\n#sidebarOptions .sliderPanel a:before,\n#sidebarTabs li:before{\n content: &quot;&quot;;\n}\n/*}}}*/\n/***\n!Sidebar tab styles\n***/\n/*{{{*/\n\n#sidebarTabs .tab,\n#sidebarTabs .tab:hover{\n border: 1px solid #ccc;\n text-decoration: none;\n}\n\n#sidebarTabs .tabSelected{\n background: #ccc;\n color: #333;\n}\n\n#sidebarTabs .tabUnselected{\n background: #e6e6e6;\n color: #333;\n}\n\n#sidebarTabs .tabContents{\n background: #ccc;\n color: #333;\n border: 1px solid #ccc;\n width: 95%;\n}\n\n#sidebarTabs .tabContents a{\n color: #06c;\n}\n\n#sidebarTabs .tabContents a:hover{\n color: #147;\n\n}\n\n#sidebarTabs a.tabSelected:hover{\n cursor: default;\n}\n\n#sidebarTabs .txtMoreTab .tab{\n border: 1px solid #aaa;\n color: #333;\n}\n\n#sidebarTabs .txtMoreTab .tabSelected{\n background: #aaa;\n color: #333;\n}\n\n#sidebarTabs .txtMoreTab .tabSelected:hover{\n background: #aaa;\n color: #333\n}\n\n#sidebarTabs .txtMoreTab .tabUnselected{\n background: #ccc;\n color: #333;\n}\n\n#contentWrapper #sidebar .txtMoreTab .tabUnselected:hover,#contentWrapper #displayArea .txtMoreTab .tabUnselected:hover{\n color: #333;\n}\n\n#contentWrapper .txtMoreTab .tabContents{\n background: #aaa;\n color: #333;\n border: 1px solid #aaa;\n}\n/*}}}*/\n/***\n!Message area styles /% ========================================== %/\n***/\n/*{{{*/\n#messageArea {\nbackground-color: #eee;\n border: 1px solid #ccc;\n color: #bbb;\n margin: 0 1em;\n font-size: .8em;\n}\n\n#messageArea a:link{\n color: #aaa;\n}\n#messageArea a:hover{\n color: #06c;\n}\n\n#messageArea .messageToolbar .button{\n border: 1px solid #ccc;\n color: #aaa;\n text-decoration: none;\n}\n#messageArea .messageToolbar .button:hover{\n border: 1px solid #777;\n color: #777;\n}\n/*}}}*/\n/***\n!Popup styles /% ================================================ %/\n***/\n/*{{{*/\n#popup{\n padding: 0;\n background: #eee;\n border: 1px solid #ccc;\n color: #333;\n}\n\n#popup a{\n color: #06c;\n font-weight: normal;\n}\n\n#popup a:hover{\n color: #fff;\n background: #aaa;\n text-decoration: none;\n}\n/*}}}*/\n/***\n!Tiddler display styles /% ====================================== %/\n***/\n/*{{{*/\n#displayArea{\n margin: 1em 18em 1em 1em;\n text-align: left;\n font-size: 1.2em;\n}\n\nh1, h2, h3, h4, h5, .title{\n font-family: 'Trebuchet MS', 'Lucida Grande', Verdana, Arial, Sans-Serif;\ncolor: #333;\npadding: 0;\n}\n\n.viewer h1,.viewer h2,.viewer h3,.viewer h4,.viewer h5,.viewer h6{\n background: transparent;\n border-bottom: 1px dotted #ccc;\n}\n\n.title{\n font-size: 1.6em; \n}\n\n.subtitle{\n color: #777;\n font-size: .9em;\n}\n\n.toolbar{\n font-size: .8em;\n}\n\n.toolbar a:link,.toolbar a:visited{\n background: #e6e6e6;\n border: 1px solid #ccc;\n color: #aaa;\n padding: 1px 3px;\n margin: 0 .5em 0 0;\n}\n\n.toolbar a.button:hover{\n background: #ccc;\n border-color: #bbb;\n color: #06c;\n text-decoration: none;\n}\n\n.viewer a.tiddlyLinkNonExisting:link{\n color: #b85b5a;\n font-style: normal;\n}\n\n.viewer a.tiddlyLinkNonExisting:hover{\n text-decoration: underline; \n}\n\n.viewer a.tiddlyLinkExisting:link,#displayArea .viewer a.externalLink{\n font-weight: normal;\n color: #06c;\n}\n\n.viewer a.tiddlyLinkExisting:hover,.viewer a.externalLink:hover{\n color: #147;\n text-decoration: underline; \n}\n\n.viewer .button{\n border: 0;\n}\n\n.editor {\n font-size: 8pt;\n color: #402c74;\n font-weight: normal;\n}\n\n.editor input, .editor textarea {\n display: block;\n font: 11px/110% &quot;Andale Mono&quot;, &quot;Monaco&quot;, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace;\n margin: 0 0 10px 0;\n border: 1px inset #333;\n padding: 2px 0;\n}\n\n.footer, .footer a.button,.editorFooter, .footer a.button{\n color: #aaa;\n}\n\n.selected .footer,.selected .footer a{\n color: #777;\n}\n\n.selected .footer a.button,.selected .editorFooter a.button{\n color: #06c;\n}\n\n.footer a.button:hover,.editorFooter a.button:hover{\n color: #147;\n background: transparent;\n} \n\n.tagClear{\n clear: none; \n}\n/*}}}*/</div>
<div tiddler="SubSelects" modifier="RyanGerry" modified="200508300806" created="200508300806" tags="sql">[[MySQL manual reference|file:///Users/ryan/manual-split/manual_SQL_Syntax.html#Subqueries]]\n\nScalarSubSelects</div>
<div tiddler="Super-sizing YouTube" modifier="RyanGerry" modified="200708032306" created="200707261831" tags="oscon2007 youtube">~YouTube's early days: web boxes do everything.  Written in Python.\n\n~YouTube consisted of about two back end engineers and two front end engineers up until Google bought them. Day on day growth could be 50%!  General advice is to minimize dependencies by focusing only on data in and data out.  Accept some latency so you can continue to expand.  ''Localize failures - your site is only down if people think you are down.''  They would do maintenance on the master DB and it only really effects 1 - 2 % of the application.  Disjoint tasks should run on different machines to get the most out of each machine.\n\nMoved from mod_phython to mod_fastcgi to save RAM.  With mod_python - each child was also about 60 MB.  They used about 250 apache processes but only 8 fastcgi processes.  Made search a remote service running on separate machines.  This way the index can be stored in memory - they are using a modified Lucence.  Encode a portion of the call stack as a SQL query comment to track down where the queries are coming from.  YouTube is using memcached as well.  Item lookups are the easiest to cache.  They modified the Python bindings to be able to determine the cached rate.\n\n!Software Optimization\n\nFast vs. fast enough.  Strive for machine efficiency - don't obsess.  The largest processing time is waiting on network sockets.  Be scientific - collect data and understand it.  He mentioned HotShot (http://www.onlamp.com/pub/a/python/2005/12/15/profiling.html) as a tool for profiling.  Redid pure python HMAC (encryption) by writing a few lines of C.  psyco is a specializing compiler for Python.  It has problem with context switching and therefor closures.\n\n!Reasonable Efficiency\n\nEventually you can't optimize one master database server.  Pretty much have to go horizontal (at least with MySQL).  Need to observe the data access patterns.  What queries do you run most often?  Do you have joins?  Do you need transaction consistency?  Why?  Does an entity emerge (in YouTubes case this was a user)?\n\nThey partitioned by entity and support transactions within an entity.  Allows joins across properties of an entity.  Entities are migratory.  Cross entity is more complicated - change the way the website works to avoid this!  A lot of the YouTube staff used to work at PayPall.\n\nUsed an database layer called EMD which is not an ORM.  Connection and transaction management.  Lookup service.  Query factory.  Minimalist table abstractions.  Believes that ORMs are evil because you should be able to have transparency into your DB in order to scale.  Use multiple inheritance and decorators.  All of the scale aware code is nicely opaque to application developers.  Base use cases are painless.\n\n!!Bulk Entity Migration\n\n* hijacked mysql binlog to partition on the fly while the live site was running.  All DML gets tagged with an entity id!  Read the master binlog and selectivly replay it into a new set of mini-masters.  Have a small downtime to flush the lookup service while putting the site in read only mode.  This conversion was actually done on 4/21.\n\n!Recurring Themes\n* the elegance of simplicity\n* take reliable open software and customize it - a site like YouTube can crush it\n* DIY - filling a ticket for a bugfix doesn't guarantee a fix - fix it yourself!\n\nThe first nine developers all knew each other for about 5 years coming from PayPal.\n\nLitey was mentioned as a replacement for Squid.  I am not sure how it is actually spelled.\n</div>
<div tiddler="TemplateToolkit" modifier="RyanGerry" modified="200510251011" created="200510251011" tags="perl webdev">''Data::Dumper from within a template''\n\n''Update''\n\nAn easier way is to use: [[Template::Plugin::Stash|http://search.cpan.org/~podmaster/Template-Plugin-Stash-1.006/lib/Template/Plugin/Stash.pm]]\n\nIn template:\n\n[% PERL %]\nuse Data::Dumper;\nprint '&lt;pre&gt;', Dumper($context-&gt;stash()-&gt;get('variable_name')), '&lt;/pre&gt;';\n[% END %]\n\nAnything executing in a [% PERL %] block resides in the Template::Context module.  Variable $context is available for all access to the templatge environment.  In the above example, the template variable ''variable_name' is Dumped.\n\nThis only works when { EVAL_PERL =&gt; 1 } is passed to the Template constructor.</div>
<div tiddler="TiddlyWikiSyntax" modifier="RyanGerry" modified="200707301211" created="200510251011" tags="tiddlywiki">!!Links\n* [[google|http://www.google.com]] - [[ ]] surround link.  First comes link text, |, and URL.\n* ~WikiWords are escaped with a ~\n\n!!Formatting\n\n''Bold'' - double single quotes\n//Italics// - double forward slashes\n\n!!Tables\nHeaders are denoted by a !\n|!header|!header2|\n|a|b|row 1|\n|c|d|row 2|\n\n!!Bullets\n* One asterisk per bullet\n** two asterisks for a sub point\n*** three asterisks for a sub sub point and so on...\n\n!!Reference\nsee function setupRegexp()</div>
<div tiddler="Ubiquitous Multithreading for a Multicore World" modifier="RyanGerry" modified="200807221904" created="200807221719" tags="oscon2008">Presenters - two guys from Intel\n\n* P = the number of cores\n* Defined speedup\n* Often a waste of time to linearlize a linear problem because the processor will out pace the IO\n* Amdal's law basically states that the best speedup is about five\n* Gustafson/Barsis Formulae - said that parallelism is worth it essentially\n* sublinear speedup is normal - the square root of P is break even\n* PRAM = Parallel Random Access Machine - can access any location in the same amount of time - silly like a frictionless plain\n* Thread startup and shutdown can be expensive. It is best to be using a thread pool\n* Some OS's have nonscaling memory allocators (actually lock around malloc and free)\n* Stressed that any serial operation should be minimized\n** Code should be used to create threads from other threads\n** Example packages are OpenMP, Intel Threading Building Blocks and Silk\n* Grain Size - chunk of work to execute serially\n** Too fine = schedule overhead dominates\n** too course = loose potential parallelism\n* Contention\n** the author has found that the memory bandwidth is usually a problem when programs don't speed up\n*** A quick and dirty way to test this is to increase the size of the basic data type and see how that effects things.  IE, changing and into to a char or long\n* Shared memory is really message passing (if shared memory is done correctly)\n* Don't blame the lock (mutex) if the program does not scale!\n** Workarounds\n*** keep private copies of writable data and merge later\n*** Another option is finer grain locking\n* Locality\n** Compute on data that is near, not far\n** structure computation to avoid cached misses\n** Consider blocking algorithm to improve cache locality (break up an algorithm to threads work on only a portion of the data)\n*** Example: Sieve of Eratosthenes for Finding Primes\n**** Break array into blocks of size sqrt(N)\n* Intel Threading Building Blocks (TBB) Overview\n** Lambda expressions have been added to some C++ implementations, including the Intel compiler.  This is also on gcc's roadmap.\n** TBB is really intended for processor parallelism which is much different than IO parallelism.\n** Available in GPL and commercial licenses\n</div>
<div tiddler="Unix" modifier="YourName" modified="201004071936" created="200510101544" tags="unix">*Finding information about process and files:\n** What files and sockets are used by a process - use ''lsof''.  Running as root gives all process information.\n** What process have a file open - use ''fuser'' (not sure about Darwin equivelent).\n* time\n** To automatically update the date from a time server: ''rdate -s'' time.nist.gov\n** {{{tzset}}} is a program to correct set the TZ shell variable for your local time zone.\n* Semephores\n** {{{ipcs}}} command\n* Versions\n** Redhat: {{{/etc/redhat-relase}}}\n** Ubuntu: {{{/etc/issue}}}\n\n!Package Management\n* [[apt]]\n* [[yum and rpm]]</div>
<div tiddler="Unix2Dos" modifier="RyanGerry" modified="200810021441" created="200711292334" tags="unix shell windows">''Unix Command -&gt; DOS command''\nThis is assuming the Bourne shell on Unix.\n{{{\nclear -&gt; cls\ncat -&gt; type\nexport VAR=value -&gt; set VAR=value\necho $VAR -&gt; echo %VAR%\n}}}</div>
<div tiddler="UsefullVimFolds" modifier="RyanGerry" modified="200509071319" created="200509071319" tags="vim">Automatically fold based on indent:\n\n:set foldmethod=indent\n\nThen unfold under cursor by 'zo' or 'zO' for recursive.</div>
<div tiddler="VimBuffers" modifier="RyanGerry" modified="200810271355" created="200810271354" tags="">{{{bufdo %s/foo/foo/gec}}} does a substitution in all buffers\n{{{:ls}}} lists all buffers\n\n\n</div>
<div tiddler="VimRecording" modifier="RyanGerry" modified="200510061447" created="200510061447" tags="">Record a series of repetative commands into a register:\n\nqa # records into register a\ndo some stuff in vim\nq   # stop the recording\n\n@a # redo the commands just recorded in register a</div>
<div tiddler="Web Frameworks of the Future: Flex, GWT, Grail, and Rails" modifier="RyanGerry" modified="200807240015" created="200807240014" tags="oscon2008 java ruby">Note: I got to this talk later\n* Slides - http://static.raibledesigns.com/repository/presentations/WebFrameworksOfTheFuture-FlexGWTRailsAndGrails.pdf\n* Author was from linked in\n* Linked in's main web app is in Java but then there are side things in Grails\n* Da Vinci Project is Sun's name for the project to make the JVM faster\n!Flex\n* Flex rails integration\n** Flex Scaffold: http://www.railslodge.com/plugins/717-flex-scaffold\n** Flex e-Genial Scaffold: http://rubyforge.org/projects/flexscaffold\n* There is now back button support in Flex but it is now ignored\n* Flex supports REST easily and also supports cross domain communication (unlike GWT)\n* No zero turnaround w/o IDE\n!GWT\n* http;//grails.org/GWT+Plugin\n* JSONRequest can do GETs outside your domain\n* Uses Server-side RPC\n* Pros\n** writes Java =&gt; Produces JavaScript\n** Uses standard Java tools\n** There is another framework called Wicked which is more like Spring programming\n* Cons\n** Hard to attache GWT on top of existing code\n* !Flex vs. GWT - really AJAX vs. Flex\n* had lots of interesting charts and graphs from indeed.com and Google trends</div>
<div tiddler="WhatsNew" modifier="RyanGerry" modified="200807222300" created="200705181715" tags="perl oscon2008">!2008-07-21 OSCON 2008\n[[OSCON 2008 Notes]]\n\n!2008-06-17 YAPC::NA 2008\n[[YAPC::NA2008 Session Notes]]\n\n!2008-06-13 - Python\nI attended my first Python training today.  Today is a good day to add a [[Python]] link under the Languages section of the main navigation :)\n\nWhatsOld</div>
<div tiddler="WhatsOld" modifier="RyanGerry" modified="200806182148" created="200806131253" tags="">!2008-04-29 - YAPC::NA 2008 Call for Voluneteers\n\n[img[YAPC::NA 2008 - &quot;I'm Volunteering&quot;|http://conferences.mongueurs.net/yn2008/banners/yapcna_2008_im_volunteering.gif][http://conferences.mongueurs.net/yn2008/]]\n\nIf you would like to volunteer for YAPC (Yet Another Perl Conference) in Chicago please let me know as I am coordinating the volunteers this year.  My contact information is on the [[About This Wiki]] page.\n\nMore banners are available from http://conferences.mongueurs.net/yn2008/banners.html .  A special thanks to Kelly Knight for creating the badge banners!\n\n!2008-03-07 - Java\n\nI am doing more Java Development than usual.  The following tiddlers will be Java related for a while.</div>
<div tiddler="YAPC::NA2008 Session Notes" modifier="RyanGerry" modified="200806182149" created="200806181421" tags="yapcna2008 perl">Here are some of my notes from talks I attended.\n\n[[YAPC::NA2008_Moose]]\n[[YAPC::NA2008_TimeZones]]\n[[YAPC::NA2008_Sub::Exporter]]\n[[YAPC::NA2008_MovableType for Open Source Developers]]</div>
<div tiddler="YAPC::NA2008_Moose" modifier="RyanGerry" modified="200806171551" created="200806171516" tags="yapcna2008 perl">Stevan Little\n* Stable - used in production for two years\n* Not a toy - it has been built for production\n* Post Modern Object System\n* Moose is an amplifier for the Perl 5 00\n** still uses blessed hashes\n* {{{Class::Accessor}}} annoyances\n** requires inheritance\n** a simple accessors without defaults\n* Usage {{{use Moose}}}\n** populates current namespace with ''keywords''\n** use base is done with {{{class_type}}}\n* Moose Provides:\n** read/write information and defaults\n** introspection\n** can enforce that attributes are set in a constructor\n** lazy initialization\n** type coercion\n** type enforcement\n** overriding attributes\n** methods in one class can automatically delegate to a method of another class\n* There is a module called Mouse which does the simple stuff and is faster.\n* Moose Performance - Isn't Moose slow?\n** mostly compile time overhead\n** The immutable attribute helps speed.  This generates code and then evals it into your package.\n** have sped things up with XS\n** A lot fo the time is spent in Class::MOP\n** Can compile Moose down to a .pmc object\n** Moose on 5.10 was 25% faster than Perl 5.8.  Probably due to method call overhead reduction.\n** But it is really designed for developer velocity\n* Use the New York times profiler!\n* Extensions:\n** MooseX::AttributeHelpers\n*** can perform named standard array operations on an array attribute\n*** after attributes get called after an attribute is modified.  This can help with referential integrity.  This was stolen from the language CLOS.  There are also before, after, and around attributes.\n** MooseX::AttributeChecking\n* Moose::Role\n** One usage: an interface:\n{{{\npackage Salaried;\nuse Moose::Role;\nrequires 'paycheck_ammount';\n}}}\n(assuming you created a Salaried::Yearly class which divided out the paycheck amount) in the using class:\n{{{\npackage Employee;\nextends 'Person';\nwith 'Salaried::Yearly';\n...\n}}}\n** Roles are like Ruby mixins but safer.\n** Horizontal reuse\n* Benefits of Moose\n** Lack of tedium\n** shorter\n** less code means less bugs\n** less low level testing\n** code is more descriptive\n* Downsides\n** performance\n*** compile time costs\n*** coercion is slow\n** a lot of Kool-aid (it changes a lot)\n** sometimes it does not play well with others - like AUTOLOAD\n*** used not not work with globref objects like the IO;: objects.  This has been fixid with the Moose globref module</div>
<div tiddler="YAPC::NA2008_MovableType for Open Source Developers" modifier="RyanGerry" modified="200806181420" created="200806181417" tags="">Timothy Appnel\n\n* Timothy owns a consultancy which helps companies with MT\n* MT is used by some high profile sites like Huffington Post\n* History\n** Was released in Oct. of 2001 and was an early blogging tool\n** At that time blogger was having uptime issues and it was hosted\n** Shared hosting was more expensive with less options.  For that reason, the first versions were only CGI and BerklyDB\n** There was a business blunder when 3.0 was released.  They didn't release the license and pricing model until after it was released.\n** However, the professionals market continued to grow.\n* Biggest competitor is WordPress\n* Is currently GPL'd\n* CMS and asset management featers have been added.  (not just a blogging tool)\n* MT Myths\n** &quot;MY may be open source but Six Apart may take it back ''again''.&quot; - people don't really understand the GPL.  And it was always closed source before it was GPL'd.\n** &quot;MT is only free if I'm not doing anything commercial.&quot;  Again, it is GPL'd.  You can buy a support contract from Six Apart.</div>
<div tiddler="YAPC::NA2008_Sub::Exporter" modifier="RyanGerry" modified="200806171640" created="200806171640" tags="">Ricardo Signes\n\n* Explained dark magic in Exporter.pm\n* String::Truncate is helpful - I can't believe I wrote these myself :)\n* Sub::Exporter\n** replacement for Exporter\n** provides common use cases like {{{use MyExportingModule qw(-all)}}}\n** allows for the user to rename subs which would be exported.  This helps with collisions.\n*** less ugly than Exporter::Renaming and does not rely on the client\n** allows for exported routines to be easily overridden\n** parameters can be passed into exported routines\n\n</div>
<div tiddler="YAPC::NA2008_TimeZones" modifier="RyanGerry" modified="200806171616" created="200806171614" tags="">Kevin Falzone - Best Practical\n\n* The Olsen file is a database a timezones\n** contains crazy things like the days which did not exists in Alaska in the 19th century when it was sold to the US from Russia which used the Julian callendar.\n* there are half and quarter hour time zones.\n* China is in all of one timezeone\n* DateTime is your friend!\n* Databases:\n** keep datetimes in GMT!\n* The floating timezone is a meta timezone in which 11 AM is at 11 AM in any timezone.\n* DateTime::Format::Natural is a good module\n* Be ware of DateTime dieing with invalid dates.  You can also convert your code to UTC, do the calculation and then convert back to the local time.</div>
<div tiddler="YourName" modifier="YourName" modified="200611132057" created="200611132057" tags="">Ryan Gerry</div>
<div tiddler="apt" modifier="RyanGerry" modified="200802112341" created="200802111455" tags="">* {{{apt-show-versions}}} will display all installed packages and their current versions.\n* {{{dpkg-query}}} - query packages like {{{rpm -q}}}\n** Example {{{dpkg-query --listfiles vim-rails}}} - list all files not including generated config files which are part of the package.</div>
<div tiddler="badname" modifier="RyanGerry" modified="200508300758" created="200508300758" tags="">Type the text for 'New Tiddler'</div>
<div tiddler="find" modifier="RyanGerry" modified="200707301633" created="200707301621" tags="">{{{find}}} allows for complex logical expressions.  The following example prunes .svn directories and prints out the names of regular files.  The parenthesis are redundant but make things more readable.\n\n{{{ \nfind . \s( -name '.svn' -prune \s) -or \s( -type f -and -print \s)\n}}}</div>
<div tiddler="irc" modifier="RyanGerry" modified="200611141800" created="200610181827" tags="">Commands\n \n* /invite &lt;username&gt;  - how to invite someone to a room\n* /join &lt;channel&gt; - join the channel name\n* /list - shows the cannels on the server, this can take a long time on large servers\n* /scan - shows who is in a channel\n* /who - more user info\n* /me &lt;something&gt; - refer to yourself in the third person\n* /part &lt;channel&gt; [leaving message] - leave the cannel with an optional message\n* /query &lt;nick&gt; - start a conversation with just that person, use /query with nothing after it to leave</div>
<div tiddler="netcat" modifier="RyanGerry" modified="200509071622" created="200509071622" tags="">Quickly and easily transfer a file.  Much more can also be done with this utility.\n\nServer sends file ntv001.mp4:\nnc -v -w 3000 -p 5600 -l &lt; ntv001.mp4\n\n-v = verbose\n-w wait 3000 seconds for a connection\n-p listen on port 5600\n-l listen on all available interfaces\n\nclient does something like:\nnc -v -w 2 192.168.2.192 5600 &gt; ntv001.mp4\nwhere 192.168.2.192 is the address of the server</div>
<div tiddler="rsync" modifier="YourName" modified="200611102051" created="200601020018" tags="">\nUsefull rsync options\n\n-a = archive mode\n-P = show progress\n\nOver ssh: http://hacks.oreilly.com/pub/h/38</div>
<div tiddler="svn" modifier="RyanGerry" modified="200808011759" created="200808011759" tags="">!Commit a file as a different user\n{{{svn --username &lt;username&gt; --no-auth-cache ci &lt;filename&gt;}}}</div>
<div tiddler="vim" modifier="RyanGerry" modified="200810271352" created="200510061445" tags="vim">UsefullVimFolds\n\nVimRecording (q to record)\n\nVimBuffers</div>
<div tiddler="yum and rpm" modifier="RyanGerry" modified="200803121958" created="200802282303" tags="">!rpm\n* {{{rpm -qa}}} - shows all installed packages\n\n!yum\n* {{{yum clean all}}} - clear out local cache\n* {{{yum grouplist}}} - see what is available\n* {{{yum -y groupupdate &lt;some package&gt;}}} - upgrades the chosen package\n* {{{/etc/yum.conf}}} - global configuration file.  Lists what repositories to get rpm's from.</div>
</div>
<!--POST-BODY-START-->

<!--POST-BODY-END-->
	</body>
</html>
